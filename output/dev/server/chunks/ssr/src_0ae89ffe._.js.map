{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/components/dialog-modal.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useState, type ReactNode } from 'react'\r\nimport { createPortal } from 'react-dom'\r\nimport { AnimatePresence, motion } from 'motion/react'\r\nimport { cn } from '@/lib/utils'\r\n\r\ninterface DialogModalProps {\r\n\topen: boolean\r\n\tonClose: () => void\r\n\tchildren: ReactNode\r\n\tclassName?: string\r\n\toverlayClassName?: string\r\n\tdisableCloseOnOverlay?: boolean\r\n\tlockScroll?: boolean\r\n\tcloseOnEsc?: boolean\r\n}\r\n\r\nexport function DialogModal({ open, onClose, children, className, disableCloseOnOverlay = false, lockScroll = true, closeOnEsc = true }: DialogModalProps) {\r\n\tconst [mounted, setMounted] = useState(false)\r\n\r\n\tuseEffect(() => {\r\n\t\tsetMounted(true)\r\n\t}, [])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!lockScroll || !open) return\r\n\t\tconst previous = document.body.style.overflow\r\n\t\tdocument.body.style.overflow = 'hidden'\r\n\t\treturn () => {\r\n\t\t\tdocument.body.style.overflow = previous\r\n\t\t}\r\n\t}, [lockScroll, open])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!closeOnEsc || !open) return\r\n\t\tconst handler = (event: KeyboardEvent) => {\r\n\t\t\tif (event.key === 'Escape') {\r\n\t\t\t\tonClose()\r\n\t\t\t}\r\n\t\t}\r\n\t\twindow.addEventListener('keydown', handler)\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener('keydown', handler)\r\n\t\t}\r\n\t}, [closeOnEsc, onClose, open])\r\n\r\n\tif (!mounted) return null\r\n\r\n\treturn createPortal(\r\n\t\t<AnimatePresence>\r\n\t\t\t{open && (\r\n\t\t\t\t<motion.div\r\n\t\t\t\t\tinitial={{ opacity: 0 }}\r\n\t\t\t\t\tanimate={{ opacity: 1 }}\r\n\t\t\t\t\texit={{ opacity: 0 }}\r\n\t\t\t\t\tclassName={'fixed inset-0 z-50 flex items-center justify-center bg-card p-4 backdrop-blur-xl'}\r\n\t\t\t\t\tonClick={disableCloseOnOverlay ? undefined : onClose}>\r\n\t\t\t\t\t<motion.div\r\n\t\t\t\t\t\tinitial={{ opacity: 0, scale: 0.8, y: 20 }}\r\n\t\t\t\t\t\tanimate={{ opacity: 1, scale: 1, y: 0 }}\r\n\t\t\t\t\t\texit={{ opacity: 0, scale: 0.8, y: 20 }}\r\n\t\t\t\t\t\tclassName={cn('static', className)}\r\n\t\t\t\t\t\tonClick={e => e.stopPropagation()}>\r\n\t\t\t\t\t\t{children}\r\n\t\t\t\t\t</motion.div>\r\n\t\t\t\t</motion.div>\r\n\t\t\t)}\r\n\t\t</AnimatePresence>,\r\n\t\tdocument.body\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AACA;AALA;;;;;;AAkBO,SAAS,YAAY,EAAE,IAAI,EAAE,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,wBAAwB,KAAK,EAAE,aAAa,IAAI,EAAE,aAAa,IAAI,EAAoB;IACxJ,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gUAAQ,EAAC;IAEvC,IAAA,iUAAS,EAAC;QACT,WAAW;IACZ,GAAG,EAAE;IAEL,IAAA,iUAAS,EAAC;QACT,IAAI,CAAC,cAAc,CAAC,MAAM;QAC1B,MAAM,WAAW,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ;QAC7C,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QAC/B,OAAO;YACN,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QAChC;IACD,GAAG;QAAC;QAAY;KAAK;IAErB,IAAA,iUAAS,EAAC;QACT,IAAI,CAAC,cAAc,CAAC,MAAM;QAC1B,MAAM,UAAU,CAAC;YAChB,IAAI,MAAM,GAAG,KAAK,UAAU;gBAC3B;YACD;QACD;QACA,OAAO,gBAAgB,CAAC,WAAW;QACnC,OAAO;YACN,OAAO,mBAAmB,CAAC,WAAW;QACvC;IACD,GAAG;QAAC;QAAY;QAAS;KAAK;IAE9B,IAAI,CAAC,SAAS,OAAO;IAErB,qBAAO,IAAA,2UAAY,gBAClB,6VAAC,kTAAe;kBACd,sBACA,6VAAC,0SAAM,CAAC,GAAG;YACV,SAAS;gBAAE,SAAS;YAAE;YACtB,SAAS;gBAAE,SAAS;YAAE;YACtB,MAAM;gBAAE,SAAS;YAAE;YACnB,WAAW;YACX,SAAS,wBAAwB,YAAY;sBAC7C,cAAA,6VAAC,0SAAM,CAAC,GAAG;gBACV,SAAS;oBAAE,SAAS;oBAAG,OAAO;oBAAK,GAAG;gBAAG;gBACzC,SAAS;oBAAE,SAAS;oBAAG,OAAO;oBAAG,GAAG;gBAAE;gBACtC,MAAM;oBAAE,SAAS;oBAAG,OAAO;oBAAK,GAAG;gBAAG;gBACtC,WAAW,IAAA,yHAAE,EAAC,UAAU;gBACxB,SAAS,CAAA,IAAK,EAAE,eAAe;0BAC9B;;;;;;;;;;;;;;;cAKL,SAAS,IAAI;AAEf","debugId":null}},
    {"offset": {"line": 105, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/projects/components/image-upload-dialog.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useRef } from 'react'\r\nimport { toast } from 'sonner'\r\nimport { Plus } from 'lucide-react'\r\nimport { DialogModal } from '@/components/dialog-modal'\r\n\r\nexport type ImageItem = { type: 'url'; url: string } | { type: 'file'; file: File; previewUrl: string; hash?: string }\r\n\r\ninterface ImageUploadDialogProps {\r\n\tcurrentImage?: string\r\n\tonClose: () => void\r\n\tonSubmit: (image: ImageItem) => void\r\n}\r\n\r\nexport default function ImageUploadDialog({ currentImage, onClose, onSubmit }: ImageUploadDialogProps) {\r\n\tconst [urlInput, setUrlInput] = useState(currentImage || '')\r\n\tconst [previewFile, setPreviewFile] = useState<{ file: File; previewUrl: string } | null>(null)\r\n\tconst fileInputRef = useRef<HTMLInputElement>(null)\r\n\r\n\tconst handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tconst file = e.target.files?.[0]\r\n\t\tif (!file) return\r\n\r\n\t\tif (!file.type.startsWith('image/')) {\r\n\t\t\ttoast.error('请选择图片文件')\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst previewUrl = URL.createObjectURL(file)\r\n\t\tsetPreviewFile({ file, previewUrl })\r\n\t\tsetUrlInput('')\r\n\t}\r\n\r\n\tconst handleSubmit = (e: React.FormEvent) => {\r\n\t\te.preventDefault()\r\n\r\n\t\tif (previewFile) {\r\n\t\t\tonSubmit({\r\n\t\t\t\ttype: 'file',\r\n\t\t\t\tfile: previewFile.file,\r\n\t\t\t\tpreviewUrl: previewFile.previewUrl\r\n\t\t\t})\r\n\t\t} else if (urlInput.trim()) {\r\n\t\t\tonSubmit({\r\n\t\t\t\ttype: 'url',\r\n\t\t\t\turl: urlInput.trim()\r\n\t\t\t})\r\n\t\t} else {\r\n\t\t\ttoast.error('请上传图片或输入 URL')\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tsetPreviewFile(null)\r\n\t\tsetUrlInput(currentImage || '')\r\n\t\tonClose()\r\n\t}\r\n\r\n\tconst handleClose = () => {\r\n\t\tif (previewFile) {\r\n\t\t\tURL.revokeObjectURL(previewFile.previewUrl)\r\n\t\t}\r\n\t\tsetPreviewFile(null)\r\n\t\tsetUrlInput(currentImage || '')\r\n\t\tonClose()\r\n\t}\r\n\r\n\treturn (\r\n\t\t<DialogModal open onClose={handleClose} className='card w-md'>\r\n\t\t\t<h2 className='mb-4 text-xl font-bold'>选择图片</h2>\r\n\t\t\t<form onSubmit={handleSubmit} className='space-y-4'>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<label className='text-secondary mb-2 block text-sm font-medium'>上传图片</label>\r\n\t\t\t\t\t<input ref={fileInputRef} type='file' accept='image/*' className='hidden' onChange={handleFileSelect} />\r\n\t\t\t\t\t<div\r\n\t\t\t\t\t\tonClick={() => fileInputRef.current?.click()}\r\n\t\t\t\t\t\tclassName='mx-auto flex h-32 w-32 cursor-pointer items-center justify-center rounded-xl border border-gray-300 bg-secondary/10 transition-colors hover:bg-gray-200'>\r\n\t\t\t\t\t\t{previewFile ? (\r\n\t\t\t\t\t\t\t<img src={previewFile.previewUrl} alt='preview' className='h-full w-full rounded-xl object-cover' />\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<div className='text-center'>\r\n\t\t\t\t\t\t\t\t<Plus className='text-secondary mx-auto mb-1 h-8 w-8' />\r\n\t\t\t\t\t\t\t\t<p className='text-secondary text-xs'>点击上传图片</p>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className='relative'>\r\n\t\t\t\t\t<div className='absolute inset-0 flex items-center'>\r\n\t\t\t\t\t\t<div className='w-full border-t border-gray-300'></div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className='relative flex justify-center text-sm'>\r\n\t\t\t\t\t\t<span className='text-secondary rounded-lg bg-white px-4 py-1'>或</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<label className='text-secondary mb-2 block text-sm font-medium'>图片 URL</label>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype='url'\r\n\t\t\t\t\t\tvalue={urlInput}\r\n\t\t\t\t\t\tonChange={e => {\r\n\t\t\t\t\t\t\tsetUrlInput(e.target.value)\r\n\t\t\t\t\t\t\tif (previewFile) {\r\n\t\t\t\t\t\t\t\tURL.revokeObjectURL(previewFile.previewUrl)\r\n\t\t\t\t\t\t\t\tsetPreviewFile(null)\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tplaceholder='https://example.com/image.png'\r\n\t\t\t\t\t\tclassName='focus:ring-brand w-full rounded-lg border border-gray-300 bg-gray-200 px-4 py-2 focus:ring-2 focus:outline-none'\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className='flex gap-3 pt-2'>\r\n\t\t\t\t\t<button type='submit' className='brand-btn flex-1 justify-center rounded-lg px-6 py-2.5'>\r\n\t\t\t\t\t\t确认\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\ttype='button'\r\n\t\t\t\t\t\tonClick={handleClose}\r\n\t\t\t\t\t\tclassName='flex-1 rounded-lg border border-gray-300 bg-white px-6 py-2.5 transition-colors hover:bg-gray-50'>\r\n\t\t\t\t\t\t取消\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</form>\r\n\t\t</DialogModal>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAee,SAAS,kBAAkB,EAAE,YAAY,EAAE,OAAO,EAAE,QAAQ,EAA0B;IACpG,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,gUAAQ,EAAC,gBAAgB;IACzD,MAAM,CAAC,aAAa,eAAe,GAAG,IAAA,gUAAQ,EAA4C;IAC1F,MAAM,eAAe,IAAA,8TAAM,EAAmB;IAE9C,MAAM,mBAAmB,CAAC;QACzB,MAAM,OAAO,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;QAChC,IAAI,CAAC,MAAM;QAEX,IAAI,CAAC,KAAK,IAAI,CAAC,UAAU,CAAC,WAAW;YACpC,iRAAK,CAAC,KAAK,CAAC;YACZ;QACD;QAEA,MAAM,aAAa,IAAI,eAAe,CAAC;QACvC,eAAe;YAAE;YAAM;QAAW;QAClC,YAAY;IACb;IAEA,MAAM,eAAe,CAAC;QACrB,EAAE,cAAc;QAEhB,IAAI,aAAa;YAChB,SAAS;gBACR,MAAM;gBACN,MAAM,YAAY,IAAI;gBACtB,YAAY,YAAY,UAAU;YACnC;QACD,OAAO,IAAI,SAAS,IAAI,IAAI;YAC3B,SAAS;gBACR,MAAM;gBACN,KAAK,SAAS,IAAI;YACnB;QACD,OAAO;YACN,iRAAK,CAAC,KAAK,CAAC;YACZ;QACD;QAEA,eAAe;QACf,YAAY,gBAAgB;QAC5B;IACD;IAEA,MAAM,cAAc;QACnB,IAAI,aAAa;YAChB,IAAI,eAAe,CAAC,YAAY,UAAU;QAC3C;QACA,eAAe;QACf,YAAY,gBAAgB;QAC5B;IACD;IAEA,qBACC,6VAAC,oJAAW;QAAC,IAAI;QAAC,SAAS;QAAa,WAAU;;0BACjD,6VAAC;gBAAG,WAAU;0BAAyB;;;;;;0BACvC,6VAAC;gBAAK,UAAU;gBAAc,WAAU;;kCACvC,6VAAC;;0CACA,6VAAC;gCAAM,WAAU;0CAAgD;;;;;;0CACjE,6VAAC;gCAAM,KAAK;gCAAc,MAAK;gCAAO,QAAO;gCAAU,WAAU;gCAAS,UAAU;;;;;;0CACpF,6VAAC;gCACA,SAAS,IAAM,aAAa,OAAO,EAAE;gCACrC,WAAU;0CACT,4BACA,6VAAC;oCAAI,KAAK,YAAY,UAAU;oCAAE,KAAI;oCAAU,WAAU;;;;;yDAE1D,6VAAC;oCAAI,WAAU;;sDACd,6VAAC,8RAAI;4CAAC,WAAU;;;;;;sDAChB,6VAAC;4CAAE,WAAU;sDAAyB;;;;;;;;;;;;;;;;;;;;;;;kCAM1C,6VAAC;wBAAI,WAAU;;0CACd,6VAAC;gCAAI,WAAU;0CACd,cAAA,6VAAC;oCAAI,WAAU;;;;;;;;;;;0CAEhB,6VAAC;gCAAI,WAAU;0CACd,cAAA,6VAAC;oCAAK,WAAU;8CAA+C;;;;;;;;;;;;;;;;;kCAIjE,6VAAC;;0CACA,6VAAC;gCAAM,WAAU;0CAAgD;;;;;;0CACjE,6VAAC;gCACA,MAAK;gCACL,OAAO;gCACP,UAAU,CAAA;oCACT,YAAY,EAAE,MAAM,CAAC,KAAK;oCAC1B,IAAI,aAAa;wCAChB,IAAI,eAAe,CAAC,YAAY,UAAU;wCAC1C,eAAe;oCAChB;gCACD;gCACA,aAAY;gCACZ,WAAU;;;;;;;;;;;;kCAIZ,6VAAC;wBAAI,WAAU;;0CACd,6VAAC;gCAAO,MAAK;gCAAS,WAAU;0CAAyD;;;;;;0CAGzF,6VAAC;gCACA,MAAK;gCACL,SAAS;gCACT,WAAU;0CAAmG;;;;;;;;;;;;;;;;;;;;;;;;AAOnH","debugId":null}},
    {"offset": {"line": 367, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/projects/components/project-card.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { motion } from 'motion/react'\r\nimport Link from 'next/link'\r\nimport { cn } from '@/lib/utils'\r\nimport { useSize } from '@/hooks/use-size'\r\nimport ImageUploadDialog, { type ImageItem } from './image-upload-dialog'\r\n\r\nexport interface Project {\r\n\tname: string\r\n\tyear: number\r\n\tdescription: string\r\n\timage: string\r\n\turl: string\r\n\ttags: string[]\r\n\tgithub?: string\r\n\tnpm?: string\r\n}\r\n\r\ninterface ProjectCardProps {\r\n\tproject: Project\r\n\tisEditMode?: boolean\r\n\tonUpdate?: (project: Project, oldProject: Project, imageItem?: ImageItem) => void\r\n\tonDelete?: () => void\r\n}\r\n\r\nexport function ProjectCard({ project, isEditMode = false, onUpdate, onDelete }: ProjectCardProps) {\r\n\tconst [isEditing, setIsEditing] = useState(false)\r\n\tconst { maxSM } = useSize()\r\n\tconst [localProject, setLocalProject] = useState(project)\r\n\tconst [showImageDialog, setShowImageDialog] = useState(false)\r\n\tconst [imageItem, setImageItem] = useState<ImageItem | null>(null)\r\n\r\n\tconst handleFieldChange = (field: keyof Project, value: any) => {\r\n\t\tconst updated = { ...localProject, [field]: value }\r\n\t\tsetLocalProject(updated)\r\n\t\tonUpdate?.(updated, project, imageItem || undefined)\r\n\t}\r\n\r\n\tconst handleImageSubmit = (image: ImageItem) => {\r\n\t\tsetImageItem(image)\r\n\t\tconst imageUrl = image.type === 'url' ? image.url : image.previewUrl\r\n\t\tconst updated = { ...localProject, image: imageUrl }\r\n\t\tsetLocalProject(updated)\r\n\t\tonUpdate?.(updated, project, image)\r\n\t}\r\n\r\n\tconst handleTagsChange = (tagsStr: string) => {\r\n\t\tconst tags = tagsStr\r\n\t\t\t.split(',')\r\n\t\t\t.map(t => t.trim())\r\n\t\t\t.filter(t => t)\r\n\t\thandleFieldChange('tags', tags)\r\n\t}\r\n\r\n\tconst handleCancel = () => {\r\n\t\tsetLocalProject(project)\r\n\t\tsetIsEditing(false)\r\n\t\tsetImageItem(null)\r\n\t}\r\n\r\n\tconst canEdit = isEditMode && isEditing\r\n\r\n\treturn (\r\n\t\t<motion.div\r\n\t\t\tinitial={{ opacity: 0, scale: 0.9 }}\r\n\t\t\t{...(maxSM ? { animate: { opacity: 1, scale: 1 } } : { whileInView: { opacity: 1, scale: 1 } })}\r\n\t\t\tclassName='card relative flex flex-col gap-4'>\r\n\t\t\t{isEditMode && (\r\n\t\t\t\t<div className='absolute top-3 right-3 z-10 flex gap-2'>\r\n\t\t\t\t\t{isEditing ? (\r\n\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t<button onClick={handleCancel} className='rounded-lg px-2 py-1.5 text-xs text-gray-400 transition-colors hover:text-gray-600'>\r\n\t\t\t\t\t\t\t\t取消\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t<button onClick={() => setIsEditing(false)} className='rounded-lg px-2 py-1.5 text-xs text-blue-400 transition-colors hover:text-blue-600'>\r\n\t\t\t\t\t\t\t\t完成\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t<button onClick={() => setIsEditing(true)} className='rounded-lg px-2 py-1.5 text-xs text-blue-400 transition-colors hover:text-blue-600'>\r\n\t\t\t\t\t\t\t\t编辑\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t<button onClick={onDelete} className='rounded-lg px-2 py-1.5 text-xs text-red-400 transition-colors hover:text-red-600'>\r\n\t\t\t\t\t\t\t\t删除\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\r\n\t\t\t<div className='flex items-start gap-4'>\r\n\t\t\t\t<div className='group relative'>\r\n\t\t\t\t\t<img\r\n\t\t\t\t\t\tsrc={localProject.image}\r\n\t\t\t\t\t\talt={localProject.name}\r\n\t\t\t\t\t\tclassName={cn('h-16 w-16 shrink-0 rounded-xl object-cover', canEdit && 'cursor-pointer')}\r\n\t\t\t\t\t\tonClick={() => canEdit && setShowImageDialog(true)}\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t{canEdit && (\r\n\t\t\t\t\t\t<div className='pointer-events-none absolute inset-0 flex items-center justify-center rounded-xl bg-black/40 opacity-0 transition-opacity group-hover:opacity-100'>\r\n\t\t\t\t\t\t\t<span className='text-xs text-white'>更换</span>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className='flex-1'>\r\n\t\t\t\t\t<div className='flex items-center gap-2'>\r\n\t\t\t\t\t\t<h3\r\n\t\t\t\t\t\t\tcontentEditable={canEdit}\r\n\t\t\t\t\t\t\tsuppressContentEditableWarning\r\n\t\t\t\t\t\t\tonBlur={e => handleFieldChange('name', e.currentTarget.textContent || '')}\r\n\t\t\t\t\t\t\tclassName={cn('text-lg font-semibold', canEdit && 'cursor-text focus:outline-none')}>\r\n\t\t\t\t\t\t\t{localProject.name}\r\n\t\t\t\t\t\t</h3>\r\n\t\t\t\t\t\t{canEdit ? (\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype='number'\r\n\t\t\t\t\t\t\t\tvalue={localProject.year}\r\n\t\t\t\t\t\t\t\tonChange={e => handleFieldChange('year', parseInt(e.target.value) || 0)}\r\n\t\t\t\t\t\t\t\tclassName='text-secondary w-18 rounded border border-gray-300 px-2 py-1 text-sm focus:outline-none'\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<span className='text-secondary text-sm'>{localProject.year}</span>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className='mt-2 flex flex-wrap gap-2'>\r\n\t\t\t\t\t\t{canEdit ? (\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype='text'\r\n\t\t\t\t\t\t\t\tvalue={localProject.tags.join(', ')}\r\n\t\t\t\t\t\t\t\tonChange={e => handleTagsChange(e.target.value)}\r\n\t\t\t\t\t\t\t\tplaceholder='标签，用逗号分隔'\r\n\t\t\t\t\t\t\t\tclassName='w-full rounded-lg border border-gray-300 bg-gray-50 px-2 py-1 text-xs focus:outline-none'\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\tlocalProject.tags.map(tag => (\r\n\t\t\t\t\t\t\t\t<span key={tag} className='text-secondary rounded-lg bg-white/50 px-2 py-1 text-xs'>\r\n\t\t\t\t\t\t\t\t\t{tag}\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t))\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<p\r\n\t\t\t\tcontentEditable={canEdit}\r\n\t\t\t\tsuppressContentEditableWarning\r\n\t\t\t\tonBlur={e => handleFieldChange('description', e.currentTarget.textContent || '')}\r\n\t\t\t\tclassName={cn('text-secondary text-sm leading-relaxed', canEdit && 'cursor-text focus:outline-none')}>\r\n\t\t\t\t{localProject.description}\r\n\t\t\t</p>\r\n\r\n\t\t\t<div className='flex flex-wrap gap-2'>\r\n\t\t\t\t{canEdit ? (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype='url'\r\n\t\t\t\t\t\t\tvalue={localProject.url}\r\n\t\t\t\t\t\t\tonChange={e => handleFieldChange('url', e.target.value)}\r\n\t\t\t\t\t\t\tplaceholder='网站 URL'\r\n\t\t\t\t\t\t\tclassName='flex-1 rounded-lg border border-gray-300 bg-gray-50 px-3 py-1.5 text-sm focus:outline-none'\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype='url'\r\n\t\t\t\t\t\t\tvalue={localProject.github || ''}\r\n\t\t\t\t\t\t\tonChange={e => handleFieldChange('github', e.target.value || undefined)}\r\n\t\t\t\t\t\t\tplaceholder='GitHub URL（可选）'\r\n\t\t\t\t\t\t\tclassName='flex-1 rounded-lg border border-gray-300 bg-gray-50 px-3 py-1.5 text-sm focus:outline-none'\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype='url'\r\n\t\t\t\t\t\t\tvalue={localProject.npm || ''}\r\n\t\t\t\t\t\t\tonChange={e => handleFieldChange('npm', e.target.value || undefined)}\r\n\t\t\t\t\t\t\tplaceholder='NPM URL（可选）'\r\n\t\t\t\t\t\t\tclassName='flex-1 rounded-lg border border-gray-300 bg-gray-50 px-3 py-1.5 text-sm focus:outline-none'\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\thref={localProject.url}\r\n\t\t\t\t\t\t\ttarget='_blank'\r\n\t\t\t\t\t\t\trel='noopener noreferrer'\r\n\t\t\t\t\t\t\tclassName='rounded-lg border bg-white/50 px-3 py-1.5 text-sm font-medium transition-colors hover:bg-white/80'>\r\n\t\t\t\t\t\t\tWebsite\r\n\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t{localProject.github && (\r\n\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\thref={localProject.github}\r\n\t\t\t\t\t\t\t\ttarget='_blank'\r\n\t\t\t\t\t\t\t\trel='noopener noreferrer'\r\n\t\t\t\t\t\t\t\tclassName='rounded-lg border bg-white/50 px-3 py-1.5 text-sm font-medium transition-colors hover:bg-white/80'>\r\n\t\t\t\t\t\t\t\tGitHub\r\n\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t{localProject.npm && (\r\n\t\t\t\t\t\t\t<Link\r\n\t\t\t\t\t\t\t\thref={localProject.npm}\r\n\t\t\t\t\t\t\t\ttarget='_blank'\r\n\t\t\t\t\t\t\t\trel='noopener noreferrer'\r\n\t\t\t\t\t\t\t\tclassName='rounded-lg border bg-white/50 px-3 py-1.5 text-sm font-medium transition-colors hover:bg-white/80'>\r\n\t\t\t\t\t\t\t\tNPM\r\n\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\r\n\t\t\t{canEdit && showImageDialog && (\r\n\t\t\t\t<ImageUploadDialog currentImage={localProject.image} onClose={() => setShowImageDialog(false)} onSubmit={handleImageSubmit} />\r\n\t\t\t)}\r\n\t\t</motion.div>\r\n\t)\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 713, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/projects/components/create-dialog.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useEffect } from 'react'\r\nimport { toast } from 'sonner'\r\nimport { Plus } from 'lucide-react'\r\nimport ImageUploadDialog, { type ImageItem } from './image-upload-dialog'\r\nimport type { Project } from './project-card'\r\nimport { DialogModal } from '@/components/dialog-modal'\r\n\r\ninterface CreateDialogProps {\r\n\tproject: Project | null\r\n\tonClose: () => void\r\n\tonSave: (project: Project) => void\r\n}\r\n\r\nexport default function CreateDialog({ project, onClose, onSave }: CreateDialogProps) {\r\n\tconst [formData, setFormData] = useState<Project>({\r\n\t\tname: '',\r\n\t\tyear: new Date().getFullYear(),\r\n\t\timage: '',\r\n\t\turl: '',\r\n\t\tdescription: '',\r\n\t\ttags: [],\r\n\t\tgithub: undefined,\r\n\t\tnpm: undefined\r\n\t})\r\n\tconst [showImageDialog, setShowImageDialog] = useState(false)\r\n\tconst [tagsInput, setTagsInput] = useState('')\r\n\r\n\tuseEffect(() => {\r\n\t\tif (project) {\r\n\t\t\tsetFormData(project)\r\n\t\t\tsetTagsInput(project.tags.join(', '))\r\n\t\t} else {\r\n\t\t\tsetFormData({\r\n\t\t\t\tname: '',\r\n\t\t\t\tyear: new Date().getFullYear(),\r\n\t\t\t\timage: '',\r\n\t\t\t\turl: '',\r\n\t\t\t\tdescription: '',\r\n\t\t\t\ttags: [],\r\n\t\t\t\tgithub: undefined,\r\n\t\t\t\tnpm: undefined\r\n\t\t\t})\r\n\t\t\tsetTagsInput('')\r\n\t\t}\r\n\t}, [project])\r\n\r\n\tconst handleImageSubmit = (image: ImageItem) => {\r\n\t\tconst imageUrl = image.type === 'url' ? image.url : image.previewUrl\r\n\t\tsetFormData({ ...formData, image: imageUrl })\r\n\t}\r\n\r\n\tconst handleTagsChange = (value: string) => {\r\n\t\tsetTagsInput(value)\r\n\t\tconst tags = value\r\n\t\t\t.split(',')\r\n\t\t\t.map(t => t.trim())\r\n\t\t\t.filter(t => t)\r\n\t\tsetFormData({ ...formData, tags })\r\n\t}\r\n\r\n\tconst handleSubmit = () => {\r\n\t\tif (!formData.name.trim() || !formData.image.trim() || !formData.url.trim() || !formData.description.trim()) {\r\n\t\t\ttoast.error('请填写所有必填项')\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tif (formData.tags.length === 0) {\r\n\t\t\ttoast.error('请至少添加一个标签')\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tonSave(formData)\r\n\t\tonClose()\r\n\t\ttoast.success(project ? '更新成功' : '添加成功')\r\n\t}\r\n\r\n\treturn (\r\n\t\t<DialogModal open onClose={onClose} className='card static w-md max-sm:w-full'>\r\n\t\t\t<div>\r\n\t\t\t\t<div className='mb-4 flex items-center gap-4'>\r\n\t\t\t\t\t<div className='group relative cursor-pointer' onClick={() => setShowImageDialog(true)}>\r\n\t\t\t\t\t\t{formData.image ? (\r\n\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t<img src={formData.image} alt={formData.name} className='h-16 w-16 rounded-xl object-cover' />\r\n\t\t\t\t\t\t\t\t<div className='pointer-events-none absolute inset-0 flex items-center justify-center rounded-xl bg-black/40 opacity-0 transition-opacity group-hover:opacity-100'>\r\n\t\t\t\t\t\t\t\t\t<span className='text-xs text-white'>更换</span>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t<div className='flex h-16 w-16 items-center justify-center rounded-xl bg-gray-200'>\r\n\t\t\t\t\t\t\t\t<Plus className='h-6 w-6 text-gray-500' />\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t)}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className='flex-1'>\r\n\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\ttype='text'\r\n\t\t\t\t\t\t\tvalue={formData.name}\r\n\t\t\t\t\t\t\tonChange={e => setFormData({ ...formData, name: e.target.value })}\r\n\t\t\t\t\t\t\tplaceholder='项目名称'\r\n\t\t\t\t\t\t\tclassName='w-full text-lg font-bold focus:outline-none'\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t<div className='mt-1 flex items-center gap-2'>\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype='number'\r\n\t\t\t\t\t\t\t\tvalue={formData.year}\r\n\t\t\t\t\t\t\t\tonChange={e => setFormData({ ...formData, year: parseInt(e.target.value) || 0 })}\r\n\t\t\t\t\t\t\t\tplaceholder='年份'\r\n\t\t\t\t\t\t\t\tclassName='text-secondary w-20 rounded border border-gray-300 px-2 py-1 text-xs focus:outline-none'\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t<input\r\n\t\t\t\t\t\t\t\ttype='url'\r\n\t\t\t\t\t\t\t\tvalue={formData.url}\r\n\t\t\t\t\t\t\t\tonChange={e => setFormData({ ...formData, url: e.target.value })}\r\n\t\t\t\t\t\t\t\tplaceholder='https://example.com'\r\n\t\t\t\t\t\t\t\tclassName='text-secondary flex-1 truncate text-xs focus:outline-none'\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className='mt-3'>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype='text'\r\n\t\t\t\t\t\tvalue={tagsInput}\r\n\t\t\t\t\t\tonChange={e => handleTagsChange(e.target.value)}\r\n\t\t\t\t\t\tplaceholder='标签，用逗号分隔（如：React, Vue）'\r\n\t\t\t\t\t\tclassName='w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 text-sm focus:outline-none'\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<div className='mt-2 flex flex-wrap gap-1.5'>\r\n\t\t\t\t\t\t{formData.tags.map(tag => (\r\n\t\t\t\t\t\t\t<span key={tag} className='rounded-full bg-secondary/10 px-2.5 py-0.5 text-xs text-gray-600'>\r\n\t\t\t\t\t\t\t\t{tag}\r\n\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tvalue={formData.description}\r\n\t\t\t\t\tonChange={e => setFormData({ ...formData, description: e.target.value })}\r\n\t\t\t\t\tplaceholder='项目介绍...'\r\n\t\t\t\t\tclassName='mt-3 w-full resize-none text-sm leading-relaxed focus:outline-none'\r\n\t\t\t\t\trows={4}\r\n\t\t\t\t/>\r\n\r\n\t\t\t\t<div className='mt-3 space-y-2'>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype='url'\r\n\t\t\t\t\t\tvalue={formData.github || ''}\r\n\t\t\t\t\t\tonChange={e => setFormData({ ...formData, github: e.target.value || undefined })}\r\n\t\t\t\t\t\tplaceholder='GitHub URL（可选）'\r\n\t\t\t\t\t\tclassName='w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 text-sm focus:outline-none'\r\n\t\t\t\t\t/>\r\n\t\t\t\t\t<input\r\n\t\t\t\t\t\ttype='url'\r\n\t\t\t\t\t\tvalue={formData.npm || ''}\r\n\t\t\t\t\t\tonChange={e => setFormData({ ...formData, npm: e.target.value || undefined })}\r\n\t\t\t\t\t\tplaceholder='NPM URL（可选）'\r\n\t\t\t\t\t\tclassName='w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 text-sm focus:outline-none'\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className='mt-6 flex gap-3'>\r\n\t\t\t\t<button onClick={onClose} className='flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm transition-colors hover:bg-gray-50'>\r\n\t\t\t\t\t取消\r\n\t\t\t\t</button>\r\n\t\t\t\t<button onClick={handleSubmit} className='brand-btn flex-1 justify-center px-4'>\r\n\t\t\t\t\t{project ? '保存' : '添加'}\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\r\n\t\t\t{showImageDialog && <ImageUploadDialog currentImage={formData.image} onClose={() => setShowImageDialog(false)} onSubmit={handleImageSubmit} />}\r\n\t\t</DialogModal>\r\n\t)\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1055, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/lib/auth.ts"],"sourcesContent":["import { createInstallationToken, getInstallationId, signAppJwt } from './github-client'\r\nimport { GITHUB_CONFIG } from '@/consts'\r\nimport { useAuthStore } from '@/hooks/use-auth'\r\nimport { toast } from 'sonner'\r\n\r\nconst GITHUB_TOKEN_CACHE_KEY = 'github_token'\r\n\r\nfunction getTokenFromCache(): string | null {\r\n\tif (typeof sessionStorage === 'undefined') return null\r\n\ttry {\r\n\t\treturn sessionStorage.getItem(GITHUB_TOKEN_CACHE_KEY)\r\n\t} catch {\r\n\t\treturn null\r\n\t}\r\n}\r\n\r\nfunction saveTokenToCache(token: string): void {\r\n\tif (typeof sessionStorage === 'undefined') return\r\n\ttry {\r\n\t\tsessionStorage.setItem(GITHUB_TOKEN_CACHE_KEY, token)\r\n\t} catch (error) {\r\n\t\tconsole.error('Failed to save token to cache:', error)\r\n\t}\r\n}\r\n\r\nfunction clearTokenCache(): void {\r\n\tif (typeof sessionStorage === 'undefined') return\r\n\ttry {\r\n\t\tsessionStorage.removeItem(GITHUB_TOKEN_CACHE_KEY)\r\n\t} catch (error) {\r\n\t\tconsole.error('Failed to clear token cache:', error)\r\n\t}\r\n}\r\n\r\nexport function clearAllAuthCache(): void {\r\n\tclearTokenCache()\r\n}\r\n\r\nexport function hasAuth(): boolean {\r\n\treturn !!getTokenFromCache()\r\n}\r\n\r\n/**\r\n * 统一的认证 Token 获取\r\n * 自动处理缓存、签发等逻辑\r\n * @returns GitHub Installation Token\r\n */\r\nexport async function getAuthToken(): Promise<string> {\r\n\t// 1. 先尝试从缓存获取 token\r\n\tconst cachedToken = getTokenFromCache()\r\n\tif (cachedToken) {\r\n\t\ttoast.info('使用缓存的令牌...')\r\n\t\treturn cachedToken\r\n\t}\r\n\r\n\t// 2. 获取私钥（从缓存）\r\n\tconst privateKey = useAuthStore.getState().privateKey\r\n\tif (!privateKey) {\r\n\t\tthrow new Error('需要先设置私钥。请使用 useAuth().setPrivateKey()')\r\n\t}\r\n\r\n\ttoast.info('正在签发 JWT...')\r\n\tconst jwt = signAppJwt(GITHUB_CONFIG.APP_ID, privateKey)\r\n\r\n\ttoast.info('正在获取安装信息...')\r\n\tconst installationId = await getInstallationId(jwt, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO)\r\n\r\n\ttoast.info('正在创建安装令牌...')\r\n\tconst token = await createInstallationToken(jwt, installationId)\r\n\r\n\tsaveTokenToCache(token)\r\n\r\n\treturn token\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,yBAAyB;AAE/B,SAAS;IACR,IAAI,OAAO,mBAAmB,aAAa,OAAO;IAClD,IAAI;QACH,OAAO,eAAe,OAAO,CAAC;IAC/B,EAAE,OAAM;QACP,OAAO;IACR;AACD;AAEA,SAAS,iBAAiB,KAAa;IACtC,IAAI,OAAO,mBAAmB,aAAa;IAC3C,IAAI;QACH,eAAe,OAAO,CAAC,wBAAwB;IAChD,EAAE,OAAO,OAAO;QACf,QAAQ,KAAK,CAAC,kCAAkC;IACjD;AACD;AAEA,SAAS;IACR,IAAI,OAAO,mBAAmB,aAAa;IAC3C,IAAI;QACH,eAAe,UAAU,CAAC;IAC3B,EAAE,OAAO,OAAO;QACf,QAAQ,KAAK,CAAC,gCAAgC;IAC/C;AACD;AAEO,SAAS;IACf;AACD;AAEO,SAAS;IACf,OAAO,CAAC,CAAC;AACV;AAOO,eAAe;IACrB,oBAAoB;IACpB,MAAM,cAAc;IACpB,IAAI,aAAa;QAChB,iRAAK,CAAC,IAAI,CAAC;QACX,OAAO;IACR;IAEA,eAAe;IACf,MAAM,aAAa,2IAAY,CAAC,QAAQ,GAAG,UAAU;IACrD,IAAI,CAAC,YAAY;QAChB,MAAM,IAAI,MAAM;IACjB;IAEA,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,MAAM,IAAA,4IAAU,EAAC,8HAAa,CAAC,MAAM,EAAE;IAE7C,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,iBAAiB,MAAM,IAAA,mJAAiB,EAAC,KAAK,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI;IAE3F,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,QAAQ,MAAM,IAAA,yJAAuB,EAAC,KAAK;IAEjD,iBAAiB;IAEjB,OAAO;AACR","debugId":null}},
    {"offset": {"line": 1127, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/hooks/use-auth.ts"],"sourcesContent":["import { create } from 'zustand'\r\nimport { clearAllAuthCache, getAuthToken as getToken, hasAuth as checkAuth } from '@/lib/auth'\r\n\r\ninterface AuthStore {\r\n\t// State\r\n\tisAuth: boolean\r\n\tprivateKey: string | null\r\n\r\n\t// Actions\r\n\tsetPrivateKey: (key: string) => void\r\n\tclearAuth: () => void\r\n\trefreshAuthState: () => void\r\n\tgetAuthToken: () => Promise<string>\r\n}\r\n\r\nexport const useAuthStore = create<AuthStore>((set, get) => ({\r\n\tisAuth: checkAuth(),\r\n\tprivateKey: null,\r\n\r\n\tsetPrivateKey: (key: string) => {\r\n\t\tset({ isAuth: true, privateKey: key })\r\n\t},\r\n\r\n\tclearAuth: () => {\r\n\t\tclearAllAuthCache()\r\n\t\tset({ isAuth: false })\r\n\t},\r\n\r\n\trefreshAuthState: () => {\r\n\t\tset({ isAuth: checkAuth() })\r\n\t},\r\n\r\n\tgetAuthToken: async () => {\r\n\t\tconst token = await getToken()\r\n\t\tget().refreshAuthState()\r\n\t\treturn token\r\n\t}\r\n}))\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAcO,MAAM,eAAe,IAAA,8PAAM,EAAY,CAAC,KAAK,MAAQ,CAAC;QAC5D,QAAQ,IAAA,6HAAS;QACjB,YAAY;QAEZ,eAAe,CAAC;YACf,IAAI;gBAAE,QAAQ;gBAAM,YAAY;YAAI;QACrC;QAEA,WAAW;YACV,IAAA,uIAAiB;YACjB,IAAI;gBAAE,QAAQ;YAAM;QACrB;QAEA,kBAAkB;YACjB,IAAI;gBAAE,QAAQ,IAAA,6HAAS;YAAG;QAC3B;QAEA,cAAc;YACb,MAAM,QAAQ,MAAM,IAAA,kIAAQ;YAC5B,MAAM,gBAAgB;YACtB,OAAO;QACR;IACD,CAAC","debugId":null}},
    {"offset": {"line": 1165, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/lib/github-client.ts"],"sourcesContent":["'use client'\r\n\r\nimport { useAuthStore } from '@/hooks/use-auth'\r\nimport { KJUR, KEYUTIL } from 'jsrsasign'\r\n\r\nexport const GH_API = 'https://api.github.com'\r\n\r\nfunction handle401Error(): void {\r\n\tif (typeof sessionStorage === 'undefined') return\r\n\ttry {\r\n\t\tuseAuthStore.getState().clearAuth()\r\n\t} catch (error) {\r\n\t\tconsole.error('Failed to clear auth cache:', error)\r\n\t}\r\n}\r\n\r\nexport function toBase64Utf8(input: string): string {\r\n\treturn btoa(unescape(encodeURIComponent(input)))\r\n}\r\n\r\nexport function signAppJwt(appId: string, privateKeyPem: string): string {\r\n\tconst now = Math.floor(Date.now() / 1000)\r\n\tconst header = { alg: 'RS256', typ: 'JWT' }\r\n\tconst payload = { iat: now - 60, exp: now + 8 * 60, iss: appId }\r\n\tconst prv = KEYUTIL.getKey(privateKeyPem) as unknown as string\r\n\treturn KJUR.jws.JWS.sign('RS256', JSON.stringify(header), JSON.stringify(payload), prv)\r\n}\r\n\r\nexport async function getInstallationId(jwt: string, owner: string, repo: string): Promise<number> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/installation`, {\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${jwt}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`installation lookup failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn data.id\r\n}\r\n\r\nexport async function createInstallationToken(jwt: string, installationId: number): Promise<string> {\r\n\tconst res = await fetch(`${GH_API}/app/installations/${installationId}/access_tokens`, {\r\n\t\tmethod: 'POST',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${jwt}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`create token failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn data.token as string\r\n}\r\n\r\nexport async function getFileSha(token: string, owner: string, repo: string, path: string, branch: string): Promise<string | undefined> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(branch)}`, {\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (res.status === 404) return undefined\r\n\tif (!res.ok) throw new Error(`get file sha failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn (data && data.sha) || undefined\r\n}\r\n\r\nexport async function putFile(token: string, owner: string, repo: string, path: string, contentBase64: string, message: string, branch: string) {\r\n\tconst sha = await getFileSha(token, owner, repo, path, branch)\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`, {\r\n\t\tmethod: 'PUT',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ message, content: contentBase64, branch, ...(sha ? { sha } : {}) })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`put file failed: ${res.status}`)\r\n\treturn res.json()\r\n}\r\n\r\n// Batch commit APIs\r\n\r\nexport async function getRef(token: string, owner: string, repo: string, ref: string): Promise<{ sha: string }> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/ref/${encodeURIComponent(ref)}`, {\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`get ref failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn { sha: data.object.sha }\r\n}\r\n\r\nexport type TreeItem = {\r\n\tpath: string\r\n\tmode: '100644' | '100755' | '040000' | '160000' | '120000'\r\n\ttype: 'blob' | 'tree' | 'commit'\r\n\tcontent?: string\r\n\tsha?: string | null\r\n}\r\n\r\nexport async function createTree(token: string, owner: string, repo: string, tree: TreeItem[], baseTree?: string): Promise<{ sha: string }> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/trees`, {\r\n\t\tmethod: 'POST',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ tree, base_tree: baseTree })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`create tree failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn { sha: data.sha }\r\n}\r\n\r\nexport async function createCommit(token: string, owner: string, repo: string, message: string, tree: string, parents: string[]): Promise<{ sha: string }> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/commits`, {\r\n\t\tmethod: 'POST',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ message, tree, parents })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`create commit failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn { sha: data.sha }\r\n}\r\n\r\nexport async function updateRef(token: string, owner: string, repo: string, ref: string, sha: string, force = false): Promise<void> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/refs/${encodeURIComponent(ref)}`, {\r\n\t\tmethod: 'PATCH',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ sha, force })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`update ref failed: ${res.status}`)\r\n}\r\n\r\nexport async function readTextFileFromRepo(token: string, owner: string, repo: string, path: string, ref: string): Promise<string | null> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(ref)}`, {\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (res.status === 404) return null\r\n\tif (!res.ok) throw new Error(`read file failed: ${res.status}`)\r\n\tconst data: any = await res.json()\r\n\tif (Array.isArray(data) || !data.content) return null\r\n\ttry {\r\n\t\treturn decodeURIComponent(escape(atob(data.content)))\r\n\t} catch {\r\n\t\treturn atob(data.content)\r\n\t}\r\n}\r\n\r\nexport async function listRepoFilesRecursive(token: string, owner: string, repo: string, path: string, ref: string): Promise<string[]> {\r\n\tasync function fetchPath(targetPath: string): Promise<string[]> {\r\n\t\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/contents/${encodeURIComponent(targetPath)}?ref=${encodeURIComponent(ref)}`, {\r\n\t\t\theaders: {\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t\t}\r\n\t\t})\r\n\t\tif (res.status === 401) handle401Error()\r\n\t\tif (res.status === 404) return []\r\n\t\tif (!res.ok) throw new Error(`read directory failed: ${res.status}`)\r\n\t\tconst data: any = await res.json()\r\n\t\tif (Array.isArray(data)) {\r\n\t\t\tconst files: string[] = []\r\n\t\t\tfor (const item of data) {\r\n\t\t\t\tif (item.type === 'file') {\r\n\t\t\t\t\tfiles.push(item.path)\r\n\t\t\t\t} else if (item.type === 'dir') {\r\n\t\t\t\t\tconst nested = await fetchPath(item.path)\r\n\t\t\t\t\tfiles.push(...nested)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn files\r\n\t\t}\r\n\t\tif (data?.type === 'file') return [data.path]\r\n\t\tif (data?.type === 'dir') return fetchPath(data.path)\r\n\t\treturn []\r\n\t}\r\n\r\n\treturn fetchPath(path)\r\n}\r\n\r\nexport async function createBlob(\r\n\ttoken: string,\r\n\towner: string,\r\n\trepo: string,\r\n\tcontent: string,\r\n\tencoding: 'utf-8' | 'base64' = 'base64'\r\n): Promise<{ sha: string }> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/blobs`, {\r\n\t\tmethod: 'POST',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ content, encoding })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`create blob failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn { sha: data.sha }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1442, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/lib/file-utils.ts"],"sourcesContent":["'use client'\r\n\r\nexport function readFileAsText(file: File): Promise<string> {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst reader = new FileReader()\r\n\t\treader.onload = () => resolve(String(reader.result || ''))\r\n\t\treader.onerror = reject\r\n\t\treader.readAsText(file)\r\n\t})\r\n}\r\n\r\nexport function fileToBase64NoPrefix(file: File): Promise<string> {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst reader = new FileReader()\r\n\t\treader.onload = () => {\r\n\t\t\tconst dataUrl = String(reader.result || '')\r\n\t\t\tresolve(dataUrl.replace(/^data:[^;]+;base64,/, ''))\r\n\t\t}\r\n\t\treader.onerror = reject\r\n\t\treader.readAsDataURL(file)\r\n\t})\r\n}\r\n\r\nexport async function hashFileSHA256(file: File): Promise<string> {\r\n\tconst buf = await file.arrayBuffer()\r\n\tconst digest = await crypto.subtle.digest('SHA-256', buf)\r\n\tconst bytes = new Uint8Array(digest)\r\n\tlet hex = ''\r\n\tfor (let i = 0; i < bytes.length; i++) {\r\n\t\tconst h = bytes[i].toString(16).padStart(2, '0')\r\n\t\thex += h\r\n\t}\r\n\treturn hex.slice(0, 16)\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AAEO,SAAS,eAAe,IAAU;IACxC,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC5B,MAAM,SAAS,IAAI;QACnB,OAAO,MAAM,GAAG,IAAM,QAAQ,OAAO,OAAO,MAAM,IAAI;QACtD,OAAO,OAAO,GAAG;QACjB,OAAO,UAAU,CAAC;IACnB;AACD;AAEO,SAAS,qBAAqB,IAAU;IAC9C,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC5B,MAAM,SAAS,IAAI;QACnB,OAAO,MAAM,GAAG;YACf,MAAM,UAAU,OAAO,OAAO,MAAM,IAAI;YACxC,QAAQ,QAAQ,OAAO,CAAC,uBAAuB;QAChD;QACA,OAAO,OAAO,GAAG;QACjB,OAAO,aAAa,CAAC;IACtB;AACD;AAEO,eAAe,eAAe,IAAU;IAC9C,MAAM,MAAM,MAAM,KAAK,WAAW;IAClC,MAAM,SAAS,MAAM,OAAO,MAAM,CAAC,MAAM,CAAC,WAAW;IACrD,MAAM,QAAQ,IAAI,WAAW;IAC7B,IAAI,MAAM;IACV,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,MAAM,EAAE,IAAK;QACtC,MAAM,IAAI,KAAK,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG;QAC5C,OAAO;IACR;IACA,OAAO,IAAI,KAAK,CAAC,GAAG;AACrB","debugId":null}},
    {"offset": {"line": 1485, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/projects/services/push-projects.ts"],"sourcesContent":["import { toBase64Utf8, getRef, createTree, createCommit, updateRef, createBlob, type TreeItem } from '@/lib/github-client'\r\nimport { fileToBase64NoPrefix, hashFileSHA256 } from '@/lib/file-utils'\r\nimport { getAuthToken } from '@/lib/auth'\r\nimport { GITHUB_CONFIG } from '@/consts'\r\nimport type { Project } from '../components/project-card'\r\nimport type { ImageItem } from '../components/image-upload-dialog'\r\nimport { getFileExt } from '@/lib/utils'\r\nimport { toast } from 'sonner'\r\n\r\nexport type PushProjectsParams = {\r\n\tprojects: Project[]\r\n\timageItems?: Map<string, ImageItem>\r\n}\r\n\r\nexport async function pushProjects(params: PushProjectsParams): Promise<void> {\r\n\tconst { projects, imageItems } = params\r\n\r\n\tconst token = await getAuthToken()\r\n\r\n\ttoast.info('正在获取分支信息...')\r\n\tconst refData = await getRef(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, `heads/${GITHUB_CONFIG.BRANCH}`)\r\n\tconst latestCommitSha = refData.sha\r\n\r\n\tconst commitMessage = `更新项目列表`\r\n\r\n\ttoast.info('正在准备文件...')\r\n\r\n\tconst treeItems: TreeItem[] = []\r\n\tconst uploadedHashes = new Set<string>()\r\n\tlet updatedProjects = [...projects]\r\n\r\n\tif (imageItems && imageItems.size > 0) {\r\n\t\ttoast.info('正在上传图片...')\r\n\t\tfor (const [url, imageItem] of imageItems.entries()) {\r\n\t\t\tif (imageItem.type === 'file') {\r\n\t\t\t\tconst hash = imageItem.hash || (await hashFileSHA256(imageItem.file))\r\n\t\t\t\tconst ext = getFileExt(imageItem.file.name)\r\n\t\t\t\tconst filename = `${hash}${ext}`\r\n\t\t\t\tconst publicPath = `/images/project/${filename}`\r\n\r\n\t\t\t\tif (!uploadedHashes.has(hash)) {\r\n\t\t\t\t\tconst path = `public/images/project/${filename}`\r\n\t\t\t\t\tconst contentBase64 = await fileToBase64NoPrefix(imageItem.file)\r\n\t\t\t\t\tconst blobData = await createBlob(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, contentBase64, 'base64')\r\n\t\t\t\t\ttreeItems.push({\r\n\t\t\t\t\t\tpath,\r\n\t\t\t\t\t\tmode: '100644',\r\n\t\t\t\t\t\ttype: 'blob',\r\n\t\t\t\t\t\tsha: blobData.sha\r\n\t\t\t\t\t})\r\n\t\t\t\t\tuploadedHashes.add(hash)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tupdatedProjects = updatedProjects.map(p => (p.url === url ? { ...p, image: publicPath } : p))\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tconst projectsJson = JSON.stringify(updatedProjects, null, '\\t')\r\n\tconst projectsBlob = await createBlob(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, toBase64Utf8(projectsJson), 'base64')\r\n\ttreeItems.push({\r\n\t\tpath: 'src/app/projects/list.json',\r\n\t\tmode: '100644',\r\n\t\ttype: 'blob',\r\n\t\tsha: projectsBlob.sha\r\n\t})\r\n\r\n\ttoast.info('正在创建文件树...')\r\n\tconst treeData = await createTree(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, treeItems, latestCommitSha)\r\n\r\n\ttoast.info('正在创建提交...')\r\n\tconst commitData = await createCommit(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, commitMessage, treeData.sha, [latestCommitSha])\r\n\r\n\ttoast.info('正在更新分支...')\r\n\tawait updateRef(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, `heads/${GITHUB_CONFIG.BRANCH}`, commitData.sha)\r\n\r\n\ttoast.success('发布成功！')\r\n}\r\n\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AAGA;AACA;;;;;;;AAOO,eAAe,aAAa,MAA0B;IAC5D,MAAM,EAAE,QAAQ,EAAE,UAAU,EAAE,GAAG;IAEjC,MAAM,QAAQ,MAAM,IAAA,kIAAY;IAEhC,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,UAAU,MAAM,IAAA,wIAAM,EAAC,OAAO,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI,EAAE,CAAC,MAAM,EAAE,8HAAa,CAAC,MAAM,EAAE;IAC5G,MAAM,kBAAkB,QAAQ,GAAG;IAEnC,MAAM,gBAAgB,CAAC,MAAM,CAAC;IAE9B,iRAAK,CAAC,IAAI,CAAC;IAEX,MAAM,YAAwB,EAAE;IAChC,MAAM,iBAAiB,IAAI;IAC3B,IAAI,kBAAkB;WAAI;KAAS;IAEnC,IAAI,cAAc,WAAW,IAAI,GAAG,GAAG;QACtC,iRAAK,CAAC,IAAI,CAAC;QACX,KAAK,MAAM,CAAC,KAAK,UAAU,IAAI,WAAW,OAAO,GAAI;YACpD,IAAI,UAAU,IAAI,KAAK,QAAQ;gBAC9B,MAAM,OAAO,UAAU,IAAI,IAAK,MAAM,IAAA,6IAAc,EAAC,UAAU,IAAI;gBACnE,MAAM,MAAM,IAAA,iIAAU,EAAC,UAAU,IAAI,CAAC,IAAI;gBAC1C,MAAM,WAAW,GAAG,OAAO,KAAK;gBAChC,MAAM,aAAa,CAAC,gBAAgB,EAAE,UAAU;gBAEhD,IAAI,CAAC,eAAe,GAAG,CAAC,OAAO;oBAC9B,MAAM,OAAO,CAAC,sBAAsB,EAAE,UAAU;oBAChD,MAAM,gBAAgB,MAAM,IAAA,mJAAoB,EAAC,UAAU,IAAI;oBAC/D,MAAM,WAAW,MAAM,IAAA,4IAAU,EAAC,OAAO,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI,EAAE,eAAe;oBACjG,UAAU,IAAI,CAAC;wBACd;wBACA,MAAM;wBACN,MAAM;wBACN,KAAK,SAAS,GAAG;oBAClB;oBACA,eAAe,GAAG,CAAC;gBACpB;gBAEA,kBAAkB,gBAAgB,GAAG,CAAC,CAAA,IAAM,EAAE,GAAG,KAAK,MAAM;wBAAE,GAAG,CAAC;wBAAE,OAAO;oBAAW,IAAI;YAC3F;QACD;IACD;IAEA,MAAM,eAAe,KAAK,SAAS,CAAC,iBAAiB,MAAM;IAC3D,MAAM,eAAe,MAAM,IAAA,4IAAU,EAAC,OAAO,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI,EAAE,IAAA,8IAAY,EAAC,eAAe;IAClH,UAAU,IAAI,CAAC;QACd,MAAM;QACN,MAAM;QACN,MAAM;QACN,KAAK,aAAa,GAAG;IACtB;IAEA,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,WAAW,MAAM,IAAA,4IAAU,EAAC,OAAO,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI,EAAE,WAAW;IAE7F,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,aAAa,MAAM,IAAA,8IAAY,EAAC,OAAO,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI,EAAE,eAAe,SAAS,GAAG,EAAE;QAAC;KAAgB;IAEpI,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,IAAA,2IAAS,EAAC,OAAO,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI,EAAE,CAAC,MAAM,EAAE,8HAAa,CAAC,MAAM,EAAE,EAAE,WAAW,GAAG;IAE/G,iRAAK,CAAC,OAAO,CAAC;AACf","debugId":null}},
    {"offset": {"line": 1562, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/app/projects/list.json"],"sourcesContent":["[{\"name\":\"Pixel Motion\",\"year\":2025,\"description\":\"网页端像素绘画工具，支持组件化画布，多画布同时绘画，色彩变量\",\"image\":\"https://pixel-motion.yysuni.com/favicon.svg\",\"url\":\"https://pixel-motion.yysuni.com/\",\"tags\":[\"像素画\",\"React\",\"Figma\",\"阮周刊\"]},{\"name\":\"Path Motion\",\"year\":2025,\"description\":\"在线 svg path 工具，针对 path 绘制、压缩、运动等功能\",\"image\":\"https://path-motion.yysuni.com/favicon.svg\",\"url\":\"https://path-motion.yysuni.com/canvas\",\"tags\":[\"SVG\",\"Path\",\"Motion\",\"阮周刊\"],\"github\":\"https://github.com/YYsuni/path-motion\"},{\"name\":\"JSON Viewer\",\"year\":2023,\"description\":\"React 的 JSON 查看/编辑组件，组件的实现方式依赖于 html 原生逻辑，比较轻量化。第二个用心的组件，学习了前辈的包装方式，介绍方式，网站样式。用户也慢慢多了起来。\",\"image\":\"https://jv.yysuni.com/favicon.svg\",\"url\":\"https://jv.yysuni.com/\",\"tags\":[\"React\",\"JSON\",\"Viewer\",\"阮周刊\"],\"github\":\"https://github.com/YYsuni/react18-json-view\",\"npm\":\"https://www.npmjs.com/package/react18-json-view\"},{\"name\":\"第一版 Blog 网站\",\"year\":2023,\"description\":\"最开始是觉得掘金这种网站写文章挺好的。后面还是想写一个自己网站，体现自己的风格。MDX 还可以自己写组件到 blog，直接交互，多好。。。没想到为以后埋下了坑。\",\"image\":\"https://blog-archive.yysuni.com/favicons/android-chrome-512x512.png\",\"url\":\"https://blog-archive.yysuni.com/\",\"tags\":[\"Next.js\",\"MDX\"]},{\"name\":\"Blockies\",\"year\":2023,\"description\":\" Blockies React组件，SVG 实现，用于生成区块链地址的图标。这是我的第一个有人用的组件，虽然人不多\",\"image\":\"/images/blockies.svg\",\"url\":\"https://blockies-react-svg.vercel.app/\",\"tags\":[\"React\",\"SVG\",\"Blockies\"],\"github\":\"https://github.com/YYsuni/blockies-react-svg\",\"npm\":\"https://www.npmjs.com/package/blockies-react-svg\"},{\"name\":\"Vue3 组件库\",\"year\":2021,\"description\":\"比较让人怀念的一个组件库了，那个时候每个前端程序员都想做一套自己的组件库，我也是。写出来的时候特别让自己开心，觉得好看，舒服。那时也第一次学会免费的 github/gitee pages 部署页面，但也倒腾半天，现在用 vercel 重新上线放着吧。\",\"image\":\"/images/vue-kit.webp\",\"url\":\"http://archive-suni.vercel.app/#/\",\"tags\":[\"Vue\",\"Library\"],\"github\":\"https://github.com/YYsuni/archive-suni\"}]"],"names":[],"mappings":"AAAA"}},
    {"offset": {"line": 1562, "column": 1807}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1566, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/projects/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useRef } from 'react'\r\nimport { motion } from 'motion/react'\r\nimport { toast } from 'sonner'\r\nimport { ProjectCard, type Project } from './components/project-card'\r\nimport CreateDialog from './components/create-dialog'\r\nimport { pushProjects } from './services/push-projects'\r\nimport { useAuthStore } from '@/hooks/use-auth'\r\nimport initialList from './list.json'\r\nimport type { ImageItem } from './components/image-upload-dialog'\r\n\r\nexport default function Page() {\r\n\tconst [projects, setProjects] = useState<Project[]>(initialList as Project[])\r\n\tconst [originalProjects, setOriginalProjects] = useState<Project[]>(initialList as Project[])\r\n\tconst [isEditMode, setIsEditMode] = useState(false)\r\n\tconst [isSaving, setIsSaving] = useState(false)\r\n\tconst [editingProject, setEditingProject] = useState<Project | null>(null)\r\n\tconst [isCreateDialogOpen, setIsCreateDialogOpen] = useState(false)\r\n\tconst [imageItems, setImageItems] = useState<Map<string, ImageItem>>(new Map())\r\n\tconst keyInputRef = useRef<HTMLInputElement>(null)\r\n\r\n\tconst { isAuth, setPrivateKey } = useAuthStore()\r\n\r\n\tconst handleUpdate = (updatedProject: Project, oldProject: Project, imageItem?: ImageItem) => {\r\n\t\tsetProjects(prev => prev.map(p => (p.url === oldProject.url ? updatedProject : p)))\r\n\t\tif (imageItem) {\r\n\t\t\tsetImageItems(prev => {\r\n\t\t\t\tconst newMap = new Map(prev)\r\n\t\t\t\tnewMap.set(updatedProject.url, imageItem)\r\n\t\t\t\treturn newMap\r\n\t\t\t})\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleAdd = () => {\r\n\t\tsetEditingProject(null)\r\n\t\tsetIsCreateDialogOpen(true)\r\n\t}\r\n\r\n\tconst handleSaveProject = (updatedProject: Project) => {\r\n\t\tif (editingProject) {\r\n\t\t\tconst updated = projects.map(p => (p.url === editingProject.url ? updatedProject : p))\r\n\t\t\tsetProjects(updated)\r\n\t\t} else {\r\n\t\t\tsetProjects([...projects, updatedProject])\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleDelete = (project: Project) => {\r\n\t\tif (confirm(`确定要删除 ${project.name} 吗？`)) {\r\n\t\t\tsetProjects(projects.filter(p => p.url !== project.url))\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleChoosePrivateKey = async (file: File) => {\r\n\t\ttry {\r\n\t\t\tconst text = await file.text()\r\n\t\t\tsetPrivateKey(text)\r\n\t\t\tawait handleSave()\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Failed to read private key:', error)\r\n\t\t\ttoast.error('读取密钥文件失败')\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleSaveClick = () => {\r\n\t\tif (!isAuth) {\r\n\t\t\tkeyInputRef.current?.click()\r\n\t\t} else {\r\n\t\t\thandleSave()\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleSave = async () => {\r\n\t\tsetIsSaving(true)\r\n\r\n\t\ttry {\r\n\t\t\tawait pushProjects({\r\n\t\t\t\tprojects,\r\n\t\t\t\timageItems\r\n\t\t\t})\r\n\r\n\t\t\tsetOriginalProjects(projects)\r\n\t\t\tsetImageItems(new Map())\r\n\t\t\tsetIsEditMode(false)\r\n\t\t\ttoast.success('保存成功！')\r\n\t\t} catch (error: any) {\r\n\t\t\tconsole.error('Failed to save:', error)\r\n\t\t\ttoast.error(`保存失败: ${error?.message || '未知错误'}`)\r\n\t\t} finally {\r\n\t\t\tsetIsSaving(false)\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleCancel = () => {\r\n\t\tsetProjects(originalProjects)\r\n\t\tsetImageItems(new Map())\r\n\t\tsetIsEditMode(false)\r\n\t}\r\n\r\n\tconst buttonText = isAuth ? '保存' : '导入密钥'\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<input\r\n\t\t\t\tref={keyInputRef}\r\n\t\t\t\ttype='file'\r\n\t\t\t\taccept='.pem'\r\n\t\t\t\tclassName='hidden'\r\n\t\t\t\tonChange={async e => {\r\n\t\t\t\t\tconst f = e.target.files?.[0]\r\n\t\t\t\t\tif (f) await handleChoosePrivateKey(f)\r\n\t\t\t\t\tif (e.currentTarget) e.currentTarget.value = ''\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\r\n\t\t\t<div className='flex flex-col items-center justify-center px-6 pt-32 pb-12'>\r\n\t\t\t\t<div className='grid w-full max-w-[1200px] grid-cols-2 gap-6 max-md:grid-cols-1'>\r\n\t\t\t\t\t{projects.map((project, index) => (\r\n\t\t\t\t\t\t<ProjectCard\r\n\t\t\t\t\t\t\tkey={project.url}\r\n\t\t\t\t\t\t\tproject={project}\r\n\t\t\t\t\t\t\tisEditMode={isEditMode}\r\n\t\t\t\t\t\t\tonUpdate={handleUpdate}\r\n\t\t\t\t\t\t\tonDelete={() => handleDelete(project)}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\r\n\t\t\t<motion.div\r\n\t\t\t\tinitial={{ opacity: 0, scale: 0.6 }}\r\n\t\t\t\tanimate={{ opacity: 1, scale: 1 }}\r\n\t\t\t\tclassName='absolute top-4 right-6 flex gap-3 max-sm:hidden'>\r\n\t\t\t\t{isEditMode ? (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<motion.button\r\n\t\t\t\t\t\t\twhileHover={{ scale: 1.05 }}\r\n\t\t\t\t\t\t\twhileTap={{ scale: 0.95 }}\r\n\t\t\t\t\t\t\tonClick={handleCancel}\r\n\t\t\t\t\t\t\tdisabled={isSaving}\r\n\t\t\t\t\t\t\tclassName='rounded-xl border bg-white/60 px-6 py-2 text-sm'>\r\n\t\t\t\t\t\t\t取消\r\n\t\t\t\t\t\t</motion.button>\r\n\t\t\t\t\t\t<motion.button\r\n\t\t\t\t\t\t\twhileHover={{ scale: 1.05 }}\r\n\t\t\t\t\t\t\twhileTap={{ scale: 0.95 }}\r\n\t\t\t\t\t\t\tonClick={handleAdd}\r\n\t\t\t\t\t\t\tclassName='rounded-xl border bg-white/60 px-6 py-2 text-sm'>\r\n\t\t\t\t\t\t\t添加\r\n\t\t\t\t\t\t</motion.button>\r\n\t\t\t\t\t\t<motion.button\r\n\t\t\t\t\t\t\twhileHover={{ scale: 1.05 }}\r\n\t\t\t\t\t\t\twhileTap={{ scale: 0.95 }}\r\n\t\t\t\t\t\t\tonClick={handleSaveClick}\r\n\t\t\t\t\t\t\tdisabled={isSaving}\r\n\t\t\t\t\t\t\tclassName='brand-btn px-6'>\r\n\t\t\t\t\t\t\t{isSaving ? '保存中...' : buttonText}\r\n\t\t\t\t\t\t</motion.button>\r\n\t\t\t\t\t</>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<motion.button\r\n\t\t\t\t\t\twhileHover={{ scale: 1.05 }}\r\n\t\t\t\t\t\twhileTap={{ scale: 0.95 }}\r\n\t\t\t\t\t\tonClick={() => setIsEditMode(true)}\r\n\t\t\t\t\t\tclassName='rounded-xl border bg-white/60 px-6 py-2 text-sm backdrop-blur-sm transition-colors hover:bg-white/80'>\r\n\t\t\t\t\t\t编辑\r\n\t\t\t\t\t</motion.button>\r\n\t\t\t\t)}\r\n\t\t\t</motion.div>\r\n\r\n\t\t\t{isCreateDialogOpen && (\r\n\t\t\t\t<CreateDialog project={editingProject} onClose={() => setIsCreateDialogOpen(false)} onSave={handleSaveProject} />\r\n\t\t\t)}\r\n\t\t</>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AATA;;;;;;;;;;AAYe,SAAS;IACvB,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,gUAAQ,EAAY,iHAAW;IAC/D,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,IAAA,gUAAQ,EAAY,iHAAW;IAC/E,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,gUAAQ,EAAC;IAC7C,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,gUAAQ,EAAC;IACzC,MAAM,CAAC,gBAAgB,kBAAkB,GAAG,IAAA,gUAAQ,EAAiB;IACrE,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,IAAA,gUAAQ,EAAC;IAC7D,MAAM,CAAC,YAAY,cAAc,GAAG,IAAA,gUAAQ,EAAyB,IAAI;IACzE,MAAM,cAAc,IAAA,8TAAM,EAAmB;IAE7C,MAAM,EAAE,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,2IAAY;IAE9C,MAAM,eAAe,CAAC,gBAAyB,YAAqB;QACnE,YAAY,CAAA,OAAQ,KAAK,GAAG,CAAC,CAAA,IAAM,EAAE,GAAG,KAAK,WAAW,GAAG,GAAG,iBAAiB;QAC/E,IAAI,WAAW;YACd,cAAc,CAAA;gBACb,MAAM,SAAS,IAAI,IAAI;gBACvB,OAAO,GAAG,CAAC,eAAe,GAAG,EAAE;gBAC/B,OAAO;YACR;QACD;IACD;IAEA,MAAM,YAAY;QACjB,kBAAkB;QAClB,sBAAsB;IACvB;IAEA,MAAM,oBAAoB,CAAC;QAC1B,IAAI,gBAAgB;YACnB,MAAM,UAAU,SAAS,GAAG,CAAC,CAAA,IAAM,EAAE,GAAG,KAAK,eAAe,GAAG,GAAG,iBAAiB;YACnF,YAAY;QACb,OAAO;YACN,YAAY;mBAAI;gBAAU;aAAe;QAC1C;IACD;IAEA,MAAM,eAAe,CAAC;QACrB,IAAI,QAAQ,CAAC,MAAM,EAAE,QAAQ,IAAI,CAAC,GAAG,CAAC,GAAG;YACxC,YAAY,SAAS,MAAM,CAAC,CAAA,IAAK,EAAE,GAAG,KAAK,QAAQ,GAAG;QACvD;IACD;IAEA,MAAM,yBAAyB,OAAO;QACrC,IAAI;YACH,MAAM,OAAO,MAAM,KAAK,IAAI;YAC5B,cAAc;YACd,MAAM;QACP,EAAE,OAAO,OAAO;YACf,QAAQ,KAAK,CAAC,+BAA+B;YAC7C,iRAAK,CAAC,KAAK,CAAC;QACb;IACD;IAEA,MAAM,kBAAkB;QACvB,IAAI,CAAC,QAAQ;YACZ,YAAY,OAAO,EAAE;QACtB,OAAO;YACN;QACD;IACD;IAEA,MAAM,aAAa;QAClB,YAAY;QAEZ,IAAI;YACH,MAAM,IAAA,sKAAY,EAAC;gBAClB;gBACA;YACD;YAEA,oBAAoB;YACpB,cAAc,IAAI;YAClB,cAAc;YACd,iRAAK,CAAC,OAAO,CAAC;QACf,EAAE,OAAO,OAAY;YACpB,QAAQ,KAAK,CAAC,mBAAmB;YACjC,iRAAK,CAAC,KAAK,CAAC,CAAC,MAAM,EAAE,OAAO,WAAW,QAAQ;QAChD,SAAU;YACT,YAAY;QACb;IACD;IAEA,MAAM,eAAe;QACpB,YAAY;QACZ,cAAc,IAAI;QAClB,cAAc;IACf;IAEA,MAAM,aAAa,SAAS,OAAO;IAEnC,qBACC;;0BACC,6VAAC;gBACA,KAAK;gBACL,MAAK;gBACL,QAAO;gBACP,WAAU;gBACV,UAAU,OAAM;oBACf,MAAM,IAAI,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;oBAC7B,IAAI,GAAG,MAAM,uBAAuB;oBACpC,IAAI,EAAE,aAAa,EAAE,EAAE,aAAa,CAAC,KAAK,GAAG;gBAC9C;;;;;;0BAGD,6VAAC;gBAAI,WAAU;0BACd,cAAA,6VAAC;oBAAI,WAAU;8BACb,SAAS,GAAG,CAAC,CAAC,SAAS,sBACvB,6VAAC,uKAAW;4BAEX,SAAS;4BACT,YAAY;4BACZ,UAAU;4BACV,UAAU,IAAM,aAAa;2BAJxB,QAAQ,GAAG;;;;;;;;;;;;;;;0BAUpB,6VAAC,0SAAM,CAAC,GAAG;gBACV,SAAS;oBAAE,SAAS;oBAAG,OAAO;gBAAI;gBAClC,SAAS;oBAAE,SAAS;oBAAG,OAAO;gBAAE;gBAChC,WAAU;0BACT,2BACA;;sCACC,6VAAC,0SAAM,CAAC,MAAM;4BACb,YAAY;gCAAE,OAAO;4BAAK;4BAC1B,UAAU;gCAAE,OAAO;4BAAK;4BACxB,SAAS;4BACT,UAAU;4BACV,WAAU;sCAAkD;;;;;;sCAG7D,6VAAC,0SAAM,CAAC,MAAM;4BACb,YAAY;gCAAE,OAAO;4BAAK;4BAC1B,UAAU;gCAAE,OAAO;4BAAK;4BACxB,SAAS;4BACT,WAAU;sCAAkD;;;;;;sCAG7D,6VAAC,0SAAM,CAAC,MAAM;4BACb,YAAY;gCAAE,OAAO;4BAAK;4BAC1B,UAAU;gCAAE,OAAO;4BAAK;4BACxB,SAAS;4BACT,UAAU;4BACV,WAAU;sCACT,WAAW,WAAW;;;;;;;iDAIzB,6VAAC,0SAAM,CAAC,MAAM;oBACb,YAAY;wBAAE,OAAO;oBAAK;oBAC1B,UAAU;wBAAE,OAAO;oBAAK;oBACxB,SAAS,IAAM,cAAc;oBAC7B,WAAU;8BAAuG;;;;;;;;;;;YAMnH,oCACA,6VAAC,oKAAY;gBAAC,SAAS;gBAAgB,SAAS,IAAM,sBAAsB;gBAAQ,QAAQ;;;;;;;;AAIhG","debugId":null}}]
}