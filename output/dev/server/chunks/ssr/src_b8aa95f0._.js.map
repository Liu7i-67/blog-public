{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 3, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/src/app/pictures/list.json"],"sourcesContent":["[{\"id\":\"1764336067650-188e7e4bf33f88\",\"uploadedAt\":\"2025-11-28T13:21:07.650Z\",\"description\":\"我自己第一张图片，我自己的头像\",\"images\":[\"/images/pictures/b346636da687740b.webp\"]},{\"id\":\"1764396655400-4c7115746f45f\",\"uploadedAt\":\"2025-11-29T06:10:55.400Z\",\"description\":\"IOS 26 时候，专门生成的壁纸\",\"images\":[\"/images/pictures/25e9f3a783d6002d.webp\",\"/images/pictures/900c05fc5ffbd0cd.webp\",\"/images/pictures/818e2f72bfcd58c4.webp\",\"/images/pictures/e87a7e59c7a06eea.webp\",\"/images/pictures/6c11232a0c6b6dad.webp\"]}]"],"names":[],"mappings":"AAAA"}},
    {"offset": {"line": 3, "column": 516}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/pictures/components/picture-card.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { motion } from 'motion/react'\r\n\r\nexport interface Picture {\r\n\tid: string\r\n\tuploadedAt: string\r\n\tdescription?: string\r\n\timage?: string\r\n\timages?: string[]\r\n}\r\n\r\ninterface PictureCardProps {\r\n\tpicture: Picture\r\n\tonDelete?: () => void\r\n\tisEditMode?: boolean\r\n}\r\n\r\nexport function PictureCard({ picture, onDelete, isEditMode }: PictureCardProps) {\r\n\tconst imageList = picture.images && picture.images.length > 0 ? picture.images : picture.image ? [picture.image] : []\r\n\r\n\tif (imageList.length === 0) {\r\n\t\treturn null\r\n\t}\r\n\r\n\treturn (\r\n\t\t<motion.div initial={{ opacity: 0, scale: 0.9 }} whileInView={{ opacity: 1, scale: 1 }} className='card relative flex flex-col gap-3'>\r\n\t\t\t{isEditMode && (\r\n\t\t\t\t<button onClick={onDelete} className='absolute top-3 right-3 rounded-lg px-2 py-1.5 text-xs text-red-400 transition-colors hover:text-red-600'>\r\n\t\t\t\t\t删除\r\n\t\t\t\t</button>\r\n\t\t\t)}\r\n\r\n\t\t\t<div className='relative flex h-56 items-center justify-center overflow-visible rounded-xl'>\r\n\t\t\t\t{imageList.length === 1 && (\r\n\t\t\t\t\t<div className='flex max-h-48 max-w-full items-center justify-center rounded-xl border-4 border-white bg-white shadow-xl'>\r\n\t\t\t\t\t\t<img src={imageList[0]} alt={picture.id} className='max-h-48 max-w-full rounded-lg object-contain' />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t{imageList.length > 1 &&\r\n\t\t\t\t\timageList.slice(0, 3).map((src, index) => (\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\tclassName={`absolute flex max-h-48 max-w-full items-center justify-center overflow-hidden rounded-xl border-4 border-white bg-white shadow-xl transition-transform ${\r\n\t\t\t\t\t\t\t\tindex === 0 ? '-left-4 -translate-y-2 -rotate-6' : index === 1 ? 'z-20 rotate-1' : 'right-0 translate-y-2 rotate-6'\r\n\t\t\t\t\t\t\t}`}>\r\n\t\t\t\t\t\t\t<img src={src} alt={`${picture.id}-${index}`} className='max-h-48 max-w-full rounded-lg object-contain' />\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t))}\r\n\r\n\t\t\t\t{imageList.length > 3 && (\r\n\t\t\t\t\t<div className='absolute right-4 -bottom-2 rounded-full bg-black/70 px-3 py-1 text-xs text-white shadow-lg'>共 {imageList.length} 张</div>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t</motion.div>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAkBO,SAAS,YAAY,EAAE,OAAO,EAAE,QAAQ,EAAE,UAAU,EAAoB;IAC9E,MAAM,YAAY,QAAQ,MAAM,IAAI,QAAQ,MAAM,CAAC,MAAM,GAAG,IAAI,QAAQ,MAAM,GAAG,QAAQ,KAAK,GAAG;QAAC,QAAQ,KAAK;KAAC,GAAG,EAAE;IAErH,IAAI,UAAU,MAAM,KAAK,GAAG;QAC3B,OAAO;IACR;IAEA,qBACC,6VAAC,0SAAM,CAAC,GAAG;QAAC,SAAS;YAAE,SAAS;YAAG,OAAO;QAAI;QAAG,aAAa;YAAE,SAAS;YAAG,OAAO;QAAE;QAAG,WAAU;;YAChG,4BACA,6VAAC;gBAAO,SAAS;gBAAU,WAAU;0BAA0G;;;;;;0BAKhJ,6VAAC;gBAAI,WAAU;;oBACb,UAAU,MAAM,KAAK,mBACrB,6VAAC;wBAAI,WAAU;kCACd,cAAA,6VAAC;4BAAI,KAAK,SAAS,CAAC,EAAE;4BAAE,KAAK,QAAQ,EAAE;4BAAE,WAAU;;;;;;;;;;;oBAIpD,UAAU,MAAM,GAAG,KACnB,UAAU,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC,CAAC,KAAK,sBAC/B,6VAAC;4BAEA,WAAW,CAAC,uJAAuJ,EAClK,UAAU,IAAI,qCAAqC,UAAU,IAAI,kBAAkB,kCAClF;sCACF,cAAA,6VAAC;gCAAI,KAAK;gCAAK,KAAK,GAAG,QAAQ,EAAE,CAAC,CAAC,EAAE,OAAO;gCAAE,WAAU;;;;;;2BAJnD;;;;;oBAQP,UAAU,MAAM,GAAG,mBACnB,6VAAC;wBAAI,WAAU;;4BAA6F;4BAAG,UAAU,MAAM;4BAAC;;;;;;;;;;;;;;;;;;;AAKrI","debugId":null}},
    {"offset": {"line": 107, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/components/dialog-modal.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useState, type ReactNode } from 'react'\r\nimport { createPortal } from 'react-dom'\r\nimport { AnimatePresence, motion } from 'motion/react'\r\nimport { cn } from '@/lib/utils'\r\n\r\ninterface DialogModalProps {\r\n\topen: boolean\r\n\tonClose: () => void\r\n\tchildren: ReactNode\r\n\tclassName?: string\r\n\toverlayClassName?: string\r\n\tdisableCloseOnOverlay?: boolean\r\n\tlockScroll?: boolean\r\n\tcloseOnEsc?: boolean\r\n}\r\n\r\nexport function DialogModal({ open, onClose, children, className, disableCloseOnOverlay = false, lockScroll = true, closeOnEsc = true }: DialogModalProps) {\r\n\tconst [mounted, setMounted] = useState(false)\r\n\r\n\tuseEffect(() => {\r\n\t\tsetMounted(true)\r\n\t}, [])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!lockScroll || !open) return\r\n\t\tconst previous = document.body.style.overflow\r\n\t\tdocument.body.style.overflow = 'hidden'\r\n\t\treturn () => {\r\n\t\t\tdocument.body.style.overflow = previous\r\n\t\t}\r\n\t}, [lockScroll, open])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!closeOnEsc || !open) return\r\n\t\tconst handler = (event: KeyboardEvent) => {\r\n\t\t\tif (event.key === 'Escape') {\r\n\t\t\t\tonClose()\r\n\t\t\t}\r\n\t\t}\r\n\t\twindow.addEventListener('keydown', handler)\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener('keydown', handler)\r\n\t\t}\r\n\t}, [closeOnEsc, onClose, open])\r\n\r\n\tif (!mounted) return null\r\n\r\n\treturn createPortal(\r\n\t\t<AnimatePresence>\r\n\t\t\t{open && (\r\n\t\t\t\t<motion.div\r\n\t\t\t\t\tinitial={{ opacity: 0 }}\r\n\t\t\t\t\tanimate={{ opacity: 1 }}\r\n\t\t\t\t\texit={{ opacity: 0 }}\r\n\t\t\t\t\tclassName={'fixed inset-0 z-50 flex items-center justify-center bg-card p-4 backdrop-blur-xl'}\r\n\t\t\t\t\tonClick={disableCloseOnOverlay ? undefined : onClose}>\r\n\t\t\t\t\t<motion.div\r\n\t\t\t\t\t\tinitial={{ opacity: 0, scale: 0.8, y: 20 }}\r\n\t\t\t\t\t\tanimate={{ opacity: 1, scale: 1, y: 0 }}\r\n\t\t\t\t\t\texit={{ opacity: 0, scale: 0.8, y: 20 }}\r\n\t\t\t\t\t\tclassName={cn('static', className)}\r\n\t\t\t\t\t\tonClick={e => e.stopPropagation()}>\r\n\t\t\t\t\t\t{children}\r\n\t\t\t\t\t</motion.div>\r\n\t\t\t\t</motion.div>\r\n\t\t\t)}\r\n\t\t</AnimatePresence>,\r\n\t\tdocument.body\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AACA;AALA;;;;;;AAkBO,SAAS,YAAY,EAAE,IAAI,EAAE,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,wBAAwB,KAAK,EAAE,aAAa,IAAI,EAAE,aAAa,IAAI,EAAoB;IACxJ,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gUAAQ,EAAC;IAEvC,IAAA,iUAAS,EAAC;QACT,WAAW;IACZ,GAAG,EAAE;IAEL,IAAA,iUAAS,EAAC;QACT,IAAI,CAAC,cAAc,CAAC,MAAM;QAC1B,MAAM,WAAW,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ;QAC7C,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QAC/B,OAAO;YACN,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QAChC;IACD,GAAG;QAAC;QAAY;KAAK;IAErB,IAAA,iUAAS,EAAC;QACT,IAAI,CAAC,cAAc,CAAC,MAAM;QAC1B,MAAM,UAAU,CAAC;YAChB,IAAI,MAAM,GAAG,KAAK,UAAU;gBAC3B;YACD;QACD;QACA,OAAO,gBAAgB,CAAC,WAAW;QACnC,OAAO;YACN,OAAO,mBAAmB,CAAC,WAAW;QACvC;IACD,GAAG;QAAC;QAAY;QAAS;KAAK;IAE9B,IAAI,CAAC,SAAS,OAAO;IAErB,qBAAO,IAAA,2UAAY,gBAClB,6VAAC,kTAAe;kBACd,sBACA,6VAAC,0SAAM,CAAC,GAAG;YACV,SAAS;gBAAE,SAAS;YAAE;YACtB,SAAS;gBAAE,SAAS;YAAE;YACtB,MAAM;gBAAE,SAAS;YAAE;YACnB,WAAW;YACX,SAAS,wBAAwB,YAAY;sBAC7C,cAAA,6VAAC,0SAAM,CAAC,GAAG;gBACV,SAAS;oBAAE,SAAS;oBAAG,OAAO;oBAAK,GAAG;gBAAG;gBACzC,SAAS;oBAAE,SAAS;oBAAG,OAAO;oBAAG,GAAG;gBAAE;gBACtC,MAAM;oBAAE,SAAS;oBAAG,OAAO;oBAAK,GAAG;gBAAG;gBACtC,WAAW,IAAA,yHAAE,EAAC,UAAU;gBACxB,SAAS,CAAA,IAAK,EAAE,eAAe;0BAC9B;;;;;;;;;;;;;;;cAKL,SAAS,IAAI;AAEf","debugId":null}},
    {"offset": {"line": 208, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/pictures/components/upload-dialog.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useRef } from 'react'\r\nimport { toast } from 'sonner'\r\nimport { Plus } from 'lucide-react'\r\nimport { DialogModal } from '@/components/dialog-modal'\r\nimport type { ImageItem } from '../../projects/components/image-upload-dialog'\r\n\r\ninterface UploadDialogProps {\r\n\tonClose: () => void\r\n\tonSubmit: (payload: { images: ImageItem[]; description: string }) => void\r\n}\r\n\r\nexport default function UploadDialog({ onClose, onSubmit }: UploadDialogProps) {\r\n\tconst [description, setDescription] = useState('')\r\n\tconst [images, setImages] = useState<ImageItem[]>([])\r\n\tconst fileInputRef = useRef<HTMLInputElement>(null)\r\n\r\n\tconst handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tconst files = Array.from(e.target.files || [])\r\n\t\tif (files.length === 0) return\r\n\r\n\t\tconst nextImages: ImageItem[] = []\r\n\r\n\t\tfor (const file of files) {\r\n\t\t\tif (!file.type.startsWith('image/')) {\r\n\t\t\t\ttoast.error('请选择图片文件')\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tconst previewUrl = URL.createObjectURL(file)\r\n\t\t\tnextImages.push({\r\n\t\t\t\ttype: 'file',\r\n\t\t\t\tfile,\r\n\t\t\t\tpreviewUrl\r\n\t\t\t})\r\n\t\t}\r\n\r\n\t\tsetImages(nextImages)\r\n\t}\r\n\r\n\tconst handleSubmit = () => {\r\n\t\tif (images.length === 0) {\r\n\t\t\ttoast.error('请至少选择一张图片')\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tonSubmit({\r\n\t\t\timages,\r\n\t\t\tdescription\r\n\t\t})\r\n\r\n\t\tsetImages([])\r\n\t\tsetDescription('')\r\n\t\tonClose()\r\n\t}\r\n\r\n\tconst handleClose = () => {\r\n\t\timages.forEach(image => {\r\n\t\t\tif (image.type === 'file') {\r\n\t\t\t\tURL.revokeObjectURL(image.previewUrl)\r\n\t\t\t}\r\n\t\t})\r\n\t\tsetImages([])\r\n\t\tsetDescription('')\r\n\t\tonClose()\r\n\t}\r\n\r\n\treturn (\r\n\t\t<DialogModal open onClose={handleClose} className='card w-md max-sm:w-full'>\r\n\t\t\t<div className='space-y-4'>\r\n\t\t\t\t<h2 className='text-xl font-bold'>上传图片</h2>\r\n\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<label className='text-secondary mb-2 block text-sm font-medium'>选择图片（可多选）</label>\r\n\t\t\t\t\t<input ref={fileInputRef} type='file' accept='image/*' multiple className='hidden' onChange={handleFileSelect} />\r\n\r\n\t\t\t\t\t{images.length === 0 ? (\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tonClick={() => fileInputRef.current?.click()}\r\n\t\t\t\t\t\t\tclassName='flex h-32 cursor-pointer items-center justify-center rounded-xl border border-dashed border-gray-300 bg-gray-50 transition-colors hover:bg-secondary/10'>\r\n\t\t\t\t\t\t\t<div className='text-center'>\r\n\t\t\t\t\t\t\t\t<Plus className='mx-auto mb-1 h-8 w-8 text-gray-500' />\r\n\t\t\t\t\t\t\t\t<p className='text-secondary text-xs'>点击选择图片</p>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t<div className='relative flex h-40 items-center justify-center overflow-visible rounded-xl bg-linear-to-br from-gray-50 to-gray-100'>\r\n\t\t\t\t\t\t\t\t{images.slice(0, 3).map((image, index) =>\r\n\t\t\t\t\t\t\t\t\timage.type === 'file' ? (\r\n\t\t\t\t\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\t\t\tclassName={`absolute h-32 w-44 overflow-hidden rounded-xl border-4 border-white bg-white shadow-xl transition-transform ${\r\n\t\t\t\t\t\t\t\t\t\t\t\tindex === 0 ? '-left-4 -translate-y-2 -rotate-6' : index === 1 ? 'z-20 rotate-1' : 'right-0 translate-y-2 rotate-6'\r\n\t\t\t\t\t\t\t\t\t\t\t}`}>\r\n\t\t\t\t\t\t\t\t\t\t\t<img src={image.previewUrl} alt={`preview-${index}`} className='h-full w-full object-cover' />\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t) : null\r\n\t\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t\t\t\t\t\t{images.length > 3 && (\r\n\t\t\t\t\t\t\t\t\t<div className='absolute right-4 -bottom-2 rounded-full bg-black/70 px-3 py-1 text-xs text-white shadow-lg'>共 {images.length} 张</div>\r\n\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t\t\t<div className='mt-3 flex items-center justify-between'>\r\n\t\t\t\t\t\t\t\t<span className='text-secondary text-xs'>已选择 {images.length} 张图片</span>\r\n\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\ttype='button'\r\n\t\t\t\t\t\t\t\t\tonClick={() => fileInputRef.current?.click()}\r\n\t\t\t\t\t\t\t\t\tclassName='rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-xs text-gray-700 transition-colors hover:bg-gray-50'>\r\n\t\t\t\t\t\t\t\t\t继续添加\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</>\r\n\t\t\t\t\t)}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<label className='text-secondary mb-2 block text-sm font-medium'>描述（可选，应用于本次所有图片）</label>\r\n\t\t\t\t\t<textarea\r\n\t\t\t\t\t\tvalue={description}\r\n\t\t\t\t\t\tonChange={e => setDescription(e.target.value)}\r\n\t\t\t\t\t\tplaceholder='这组图片的说明...'\r\n\t\t\t\t\t\tclassName='w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 text-sm focus:outline-none'\r\n\t\t\t\t\t\trows={3}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t<div className='mt-4 flex gap-3'>\r\n\t\t\t\t\t<button\r\n\t\t\t\t\t\ttype='button'\r\n\t\t\t\t\t\tonClick={handleClose}\r\n\t\t\t\t\t\tclassName='flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm transition-colors hover:bg-gray-50'>\r\n\t\t\t\t\t\t取消\r\n\t\t\t\t\t</button>\r\n\t\t\t\t\t<button type='button' onClick={handleSubmit} className='brand-btn flex-1 justify-center px-4'>\r\n\t\t\t\t\t\t确认上传\r\n\t\t\t\t\t</button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</DialogModal>\r\n\t)\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 486, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/lib/auth.ts"],"sourcesContent":["import { createInstallationToken, getInstallationId, signAppJwt } from './github-client'\r\nimport { GITHUB_CONFIG } from '@/consts'\r\nimport { useAuthStore } from '@/hooks/use-auth'\r\nimport { toast } from 'sonner'\r\n\r\nconst GITHUB_TOKEN_CACHE_KEY = 'github_token'\r\n\r\nfunction getTokenFromCache(): string | null {\r\n\tif (typeof sessionStorage === 'undefined') return null\r\n\ttry {\r\n\t\treturn sessionStorage.getItem(GITHUB_TOKEN_CACHE_KEY)\r\n\t} catch {\r\n\t\treturn null\r\n\t}\r\n}\r\n\r\nfunction saveTokenToCache(token: string): void {\r\n\tif (typeof sessionStorage === 'undefined') return\r\n\ttry {\r\n\t\tsessionStorage.setItem(GITHUB_TOKEN_CACHE_KEY, token)\r\n\t} catch (error) {\r\n\t\tconsole.error('Failed to save token to cache:', error)\r\n\t}\r\n}\r\n\r\nfunction clearTokenCache(): void {\r\n\tif (typeof sessionStorage === 'undefined') return\r\n\ttry {\r\n\t\tsessionStorage.removeItem(GITHUB_TOKEN_CACHE_KEY)\r\n\t} catch (error) {\r\n\t\tconsole.error('Failed to clear token cache:', error)\r\n\t}\r\n}\r\n\r\nexport function clearAllAuthCache(): void {\r\n\tclearTokenCache()\r\n}\r\n\r\nexport function hasAuth(): boolean {\r\n\treturn !!getTokenFromCache()\r\n}\r\n\r\n/**\r\n * 统一的认证 Token 获取\r\n * 自动处理缓存、签发等逻辑\r\n * @returns GitHub Installation Token\r\n */\r\nexport async function getAuthToken(): Promise<string> {\r\n\t// 1. 先尝试从缓存获取 token\r\n\tconst cachedToken = getTokenFromCache()\r\n\tif (cachedToken) {\r\n\t\ttoast.info('使用缓存的令牌...')\r\n\t\treturn cachedToken\r\n\t}\r\n\r\n\t// 2. 获取私钥（从缓存）\r\n\tconst privateKey = useAuthStore.getState().privateKey\r\n\tif (!privateKey) {\r\n\t\tthrow new Error('需要先设置私钥。请使用 useAuth().setPrivateKey()')\r\n\t}\r\n\r\n\ttoast.info('正在签发 JWT...')\r\n\tconst jwt = signAppJwt(GITHUB_CONFIG.APP_ID, privateKey)\r\n\r\n\ttoast.info('正在获取安装信息...')\r\n\tconst installationId = await getInstallationId(jwt, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO)\r\n\r\n\ttoast.info('正在创建安装令牌...')\r\n\tconst token = await createInstallationToken(jwt, installationId)\r\n\r\n\tsaveTokenToCache(token)\r\n\r\n\treturn token\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,yBAAyB;AAE/B,SAAS;IACR,IAAI,OAAO,mBAAmB,aAAa,OAAO;IAClD,IAAI;QACH,OAAO,eAAe,OAAO,CAAC;IAC/B,EAAE,OAAM;QACP,OAAO;IACR;AACD;AAEA,SAAS,iBAAiB,KAAa;IACtC,IAAI,OAAO,mBAAmB,aAAa;IAC3C,IAAI;QACH,eAAe,OAAO,CAAC,wBAAwB;IAChD,EAAE,OAAO,OAAO;QACf,QAAQ,KAAK,CAAC,kCAAkC;IACjD;AACD;AAEA,SAAS;IACR,IAAI,OAAO,mBAAmB,aAAa;IAC3C,IAAI;QACH,eAAe,UAAU,CAAC;IAC3B,EAAE,OAAO,OAAO;QACf,QAAQ,KAAK,CAAC,gCAAgC;IAC/C;AACD;AAEO,SAAS;IACf;AACD;AAEO,SAAS;IACf,OAAO,CAAC,CAAC;AACV;AAOO,eAAe;IACrB,oBAAoB;IACpB,MAAM,cAAc;IACpB,IAAI,aAAa;QAChB,iRAAK,CAAC,IAAI,CAAC;QACX,OAAO;IACR;IAEA,eAAe;IACf,MAAM,aAAa,2IAAY,CAAC,QAAQ,GAAG,UAAU;IACrD,IAAI,CAAC,YAAY;QAChB,MAAM,IAAI,MAAM;IACjB;IAEA,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,MAAM,IAAA,4IAAU,EAAC,8HAAa,CAAC,MAAM,EAAE;IAE7C,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,iBAAiB,MAAM,IAAA,mJAAiB,EAAC,KAAK,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI;IAE3F,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,QAAQ,MAAM,IAAA,yJAAuB,EAAC,KAAK;IAEjD,iBAAiB;IAEjB,OAAO;AACR","debugId":null}},
    {"offset": {"line": 558, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/hooks/use-auth.ts"],"sourcesContent":["import { create } from 'zustand'\r\nimport { clearAllAuthCache, getAuthToken as getToken, hasAuth as checkAuth } from '@/lib/auth'\r\n\r\ninterface AuthStore {\r\n\t// State\r\n\tisAuth: boolean\r\n\tprivateKey: string | null\r\n\r\n\t// Actions\r\n\tsetPrivateKey: (key: string) => void\r\n\tclearAuth: () => void\r\n\trefreshAuthState: () => void\r\n\tgetAuthToken: () => Promise<string>\r\n}\r\n\r\nexport const useAuthStore = create<AuthStore>((set, get) => ({\r\n\tisAuth: checkAuth(),\r\n\tprivateKey: null,\r\n\r\n\tsetPrivateKey: (key: string) => {\r\n\t\tset({ isAuth: true, privateKey: key })\r\n\t},\r\n\r\n\tclearAuth: () => {\r\n\t\tclearAllAuthCache()\r\n\t\tset({ isAuth: false })\r\n\t},\r\n\r\n\trefreshAuthState: () => {\r\n\t\tset({ isAuth: checkAuth() })\r\n\t},\r\n\r\n\tgetAuthToken: async () => {\r\n\t\tconst token = await getToken()\r\n\t\tget().refreshAuthState()\r\n\t\treturn token\r\n\t}\r\n}))\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAcO,MAAM,eAAe,IAAA,8PAAM,EAAY,CAAC,KAAK,MAAQ,CAAC;QAC5D,QAAQ,IAAA,6HAAS;QACjB,YAAY;QAEZ,eAAe,CAAC;YACf,IAAI;gBAAE,QAAQ;gBAAM,YAAY;YAAI;QACrC;QAEA,WAAW;YACV,IAAA,uIAAiB;YACjB,IAAI;gBAAE,QAAQ;YAAM;QACrB;QAEA,kBAAkB;YACjB,IAAI;gBAAE,QAAQ,IAAA,6HAAS;YAAG;QAC3B;QAEA,cAAc;YACb,MAAM,QAAQ,MAAM,IAAA,kIAAQ;YAC5B,MAAM,gBAAgB;YACtB,OAAO;QACR;IACD,CAAC","debugId":null}},
    {"offset": {"line": 596, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/lib/github-client.ts"],"sourcesContent":["'use client'\r\n\r\nimport { useAuthStore } from '@/hooks/use-auth'\r\nimport { KJUR, KEYUTIL } from 'jsrsasign'\r\n\r\nexport const GH_API = 'https://api.github.com'\r\n\r\nfunction handle401Error(): void {\r\n\tif (typeof sessionStorage === 'undefined') return\r\n\ttry {\r\n\t\tuseAuthStore.getState().clearAuth()\r\n\t} catch (error) {\r\n\t\tconsole.error('Failed to clear auth cache:', error)\r\n\t}\r\n}\r\n\r\nexport function toBase64Utf8(input: string): string {\r\n\treturn btoa(unescape(encodeURIComponent(input)))\r\n}\r\n\r\nexport function signAppJwt(appId: string, privateKeyPem: string): string {\r\n\tconst now = Math.floor(Date.now() / 1000)\r\n\tconst header = { alg: 'RS256', typ: 'JWT' }\r\n\tconst payload = { iat: now - 60, exp: now + 8 * 60, iss: appId }\r\n\tconst prv = KEYUTIL.getKey(privateKeyPem) as unknown as string\r\n\treturn KJUR.jws.JWS.sign('RS256', JSON.stringify(header), JSON.stringify(payload), prv)\r\n}\r\n\r\nexport async function getInstallationId(jwt: string, owner: string, repo: string): Promise<number> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/installation`, {\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${jwt}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`installation lookup failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn data.id\r\n}\r\n\r\nexport async function createInstallationToken(jwt: string, installationId: number): Promise<string> {\r\n\tconst res = await fetch(`${GH_API}/app/installations/${installationId}/access_tokens`, {\r\n\t\tmethod: 'POST',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${jwt}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`create token failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn data.token as string\r\n}\r\n\r\nexport async function getFileSha(token: string, owner: string, repo: string, path: string, branch: string): Promise<string | undefined> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(branch)}`, {\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (res.status === 404) return undefined\r\n\tif (!res.ok) throw new Error(`get file sha failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn (data && data.sha) || undefined\r\n}\r\n\r\nexport async function putFile(token: string, owner: string, repo: string, path: string, contentBase64: string, message: string, branch: string) {\r\n\tconst sha = await getFileSha(token, owner, repo, path, branch)\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`, {\r\n\t\tmethod: 'PUT',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ message, content: contentBase64, branch, ...(sha ? { sha } : {}) })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`put file failed: ${res.status}`)\r\n\treturn res.json()\r\n}\r\n\r\n// Batch commit APIs\r\n\r\nexport async function getRef(token: string, owner: string, repo: string, ref: string): Promise<{ sha: string }> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/ref/${encodeURIComponent(ref)}`, {\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`get ref failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn { sha: data.object.sha }\r\n}\r\n\r\nexport type TreeItem = {\r\n\tpath: string\r\n\tmode: '100644' | '100755' | '040000' | '160000' | '120000'\r\n\ttype: 'blob' | 'tree' | 'commit'\r\n\tcontent?: string\r\n\tsha?: string | null\r\n}\r\n\r\nexport async function createTree(token: string, owner: string, repo: string, tree: TreeItem[], baseTree?: string): Promise<{ sha: string }> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/trees`, {\r\n\t\tmethod: 'POST',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ tree, base_tree: baseTree })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`create tree failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn { sha: data.sha }\r\n}\r\n\r\nexport async function createCommit(token: string, owner: string, repo: string, message: string, tree: string, parents: string[]): Promise<{ sha: string }> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/commits`, {\r\n\t\tmethod: 'POST',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ message, tree, parents })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`create commit failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn { sha: data.sha }\r\n}\r\n\r\nexport async function updateRef(token: string, owner: string, repo: string, ref: string, sha: string, force = false): Promise<void> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/refs/${encodeURIComponent(ref)}`, {\r\n\t\tmethod: 'PATCH',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ sha, force })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`update ref failed: ${res.status}`)\r\n}\r\n\r\nexport async function readTextFileFromRepo(token: string, owner: string, repo: string, path: string, ref: string): Promise<string | null> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(ref)}`, {\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (res.status === 404) return null\r\n\tif (!res.ok) throw new Error(`read file failed: ${res.status}`)\r\n\tconst data: any = await res.json()\r\n\tif (Array.isArray(data) || !data.content) return null\r\n\ttry {\r\n\t\treturn decodeURIComponent(escape(atob(data.content)))\r\n\t} catch {\r\n\t\treturn atob(data.content)\r\n\t}\r\n}\r\n\r\nexport async function listRepoFilesRecursive(token: string, owner: string, repo: string, path: string, ref: string): Promise<string[]> {\r\n\tasync function fetchPath(targetPath: string): Promise<string[]> {\r\n\t\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/contents/${encodeURIComponent(targetPath)}?ref=${encodeURIComponent(ref)}`, {\r\n\t\t\theaders: {\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t\t}\r\n\t\t})\r\n\t\tif (res.status === 401) handle401Error()\r\n\t\tif (res.status === 404) return []\r\n\t\tif (!res.ok) throw new Error(`read directory failed: ${res.status}`)\r\n\t\tconst data: any = await res.json()\r\n\t\tif (Array.isArray(data)) {\r\n\t\t\tconst files: string[] = []\r\n\t\t\tfor (const item of data) {\r\n\t\t\t\tif (item.type === 'file') {\r\n\t\t\t\t\tfiles.push(item.path)\r\n\t\t\t\t} else if (item.type === 'dir') {\r\n\t\t\t\t\tconst nested = await fetchPath(item.path)\r\n\t\t\t\t\tfiles.push(...nested)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn files\r\n\t\t}\r\n\t\tif (data?.type === 'file') return [data.path]\r\n\t\tif (data?.type === 'dir') return fetchPath(data.path)\r\n\t\treturn []\r\n\t}\r\n\r\n\treturn fetchPath(path)\r\n}\r\n\r\nexport async function createBlob(\r\n\ttoken: string,\r\n\towner: string,\r\n\trepo: string,\r\n\tcontent: string,\r\n\tencoding: 'utf-8' | 'base64' = 'base64'\r\n): Promise<{ sha: string }> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/blobs`, {\r\n\t\tmethod: 'POST',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ content, encoding })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`create blob failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn { sha: data.sha }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 873, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/lib/file-utils.ts"],"sourcesContent":["'use client'\r\n\r\nexport function readFileAsText(file: File): Promise<string> {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst reader = new FileReader()\r\n\t\treader.onload = () => resolve(String(reader.result || ''))\r\n\t\treader.onerror = reject\r\n\t\treader.readAsText(file)\r\n\t})\r\n}\r\n\r\nexport function fileToBase64NoPrefix(file: File): Promise<string> {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst reader = new FileReader()\r\n\t\treader.onload = () => {\r\n\t\t\tconst dataUrl = String(reader.result || '')\r\n\t\t\tresolve(dataUrl.replace(/^data:[^;]+;base64,/, ''))\r\n\t\t}\r\n\t\treader.onerror = reject\r\n\t\treader.readAsDataURL(file)\r\n\t})\r\n}\r\n\r\nexport async function hashFileSHA256(file: File): Promise<string> {\r\n\tconst buf = await file.arrayBuffer()\r\n\tconst digest = await crypto.subtle.digest('SHA-256', buf)\r\n\tconst bytes = new Uint8Array(digest)\r\n\tlet hex = ''\r\n\tfor (let i = 0; i < bytes.length; i++) {\r\n\t\tconst h = bytes[i].toString(16).padStart(2, '0')\r\n\t\thex += h\r\n\t}\r\n\treturn hex.slice(0, 16)\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AAEO,SAAS,eAAe,IAAU;IACxC,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC5B,MAAM,SAAS,IAAI;QACnB,OAAO,MAAM,GAAG,IAAM,QAAQ,OAAO,OAAO,MAAM,IAAI;QACtD,OAAO,OAAO,GAAG;QACjB,OAAO,UAAU,CAAC;IACnB;AACD;AAEO,SAAS,qBAAqB,IAAU;IAC9C,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC5B,MAAM,SAAS,IAAI;QACnB,OAAO,MAAM,GAAG;YACf,MAAM,UAAU,OAAO,OAAO,MAAM,IAAI;YACxC,QAAQ,QAAQ,OAAO,CAAC,uBAAuB;QAChD;QACA,OAAO,OAAO,GAAG;QACjB,OAAO,aAAa,CAAC;IACtB;AACD;AAEO,eAAe,eAAe,IAAU;IAC9C,MAAM,MAAM,MAAM,KAAK,WAAW;IAClC,MAAM,SAAS,MAAM,OAAO,MAAM,CAAC,MAAM,CAAC,WAAW;IACrD,MAAM,QAAQ,IAAI,WAAW;IAC7B,IAAI,MAAM;IACV,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,MAAM,EAAE,IAAK;QACtC,MAAM,IAAI,KAAK,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG;QAC5C,OAAO;IACR;IACA,OAAO,IAAI,KAAK,CAAC,GAAG;AACrB","debugId":null}},
    {"offset": {"line": 916, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/pictures/services/push-pictures.ts"],"sourcesContent":["import { toBase64Utf8, getRef, createTree, createCommit, updateRef, createBlob, type TreeItem } from '@/lib/github-client'\r\nimport { fileToBase64NoPrefix, hashFileSHA256 } from '@/lib/file-utils'\r\nimport { getAuthToken } from '@/lib/auth'\r\nimport { GITHUB_CONFIG } from '@/consts'\r\nimport type { Picture } from '../components/picture-card'\r\nimport type { ImageItem } from '../../projects/components/image-upload-dialog'\r\nimport { getFileExt } from '@/lib/utils'\r\nimport { toast } from 'sonner'\r\n\r\nexport type PushPicturesParams = {\r\n\tpictures: Picture[]\r\n\timageItems?: Map<string, ImageItem>\r\n}\r\n\r\nexport async function pushPictures(params: PushPicturesParams): Promise<void> {\r\n\tconst { pictures, imageItems } = params\r\n\r\n\tconst token = await getAuthToken()\r\n\r\n\ttoast.info('正在获取分支信息...')\r\n\tconst refData = await getRef(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, `heads/${GITHUB_CONFIG.BRANCH}`)\r\n\tconst latestCommitSha = refData.sha\r\n\r\n\tconst commitMessage = `更新图床列表`\r\n\r\n\ttoast.info('正在准备文件...')\r\n\r\n\tconst treeItems: TreeItem[] = []\r\n\tconst uploadedHashes = new Set<string>()\r\n\tlet updatedPictures = [...pictures]\r\n\r\n\tif (imageItems && imageItems.size > 0) {\r\n\t\ttoast.info('正在上传图片...')\r\n\t\tfor (const [key, imageItem] of imageItems.entries()) {\r\n\t\t\tif (imageItem.type === 'file') {\r\n\t\t\t\tconst hash = imageItem.hash || (await hashFileSHA256(imageItem.file))\r\n\t\t\t\tconst ext = getFileExt(imageItem.file.name)\r\n\t\t\t\tconst filename = `${hash}${ext}`\r\n\t\t\t\tconst publicPath = `/images/pictures/${filename}`\r\n\r\n\t\t\t\tif (!uploadedHashes.has(hash)) {\r\n\t\t\t\t\tconst path = `public/images/pictures/${filename}`\r\n\t\t\t\t\tconst contentBase64 = await fileToBase64NoPrefix(imageItem.file)\r\n\t\t\t\t\tconst blobData = await createBlob(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, contentBase64, 'base64')\r\n\t\t\t\t\ttreeItems.push({\r\n\t\t\t\t\t\tpath,\r\n\t\t\t\t\t\tmode: '100644',\r\n\t\t\t\t\t\ttype: 'blob',\r\n\t\t\t\t\t\tsha: blobData.sha\r\n\t\t\t\t\t})\r\n\t\t\t\t\tuploadedHashes.add(hash)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tconst [groupId, indexStr] = key.split('::')\r\n\t\t\t\tconst imageIndex = Number(indexStr) || 0\r\n\r\n\t\t\t\tupdatedPictures = updatedPictures.map(p => {\r\n\t\t\t\t\tif (p.id !== groupId) return p\r\n\r\n\t\t\t\t\tconst currentImages = p.images && p.images.length > 0 ? p.images : p.image ? [p.image] : []\r\n\r\n\t\t\t\t\tconst nextImages = currentImages.map((img, idx) => (idx === imageIndex ? publicPath : img))\r\n\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\t...p,\r\n\t\t\t\t\t\timage: undefined,\r\n\t\t\t\t\t\timages: nextImages\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tconst picturesJson = JSON.stringify(updatedPictures, null, '\\t')\r\n\tconst picturesBlob = await createBlob(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, toBase64Utf8(picturesJson), 'base64')\r\n\ttreeItems.push({\r\n\t\tpath: 'src/app/pictures/list.json',\r\n\t\tmode: '100644',\r\n\t\ttype: 'blob',\r\n\t\tsha: picturesBlob.sha\r\n\t})\r\n\r\n\ttoast.info('正在创建文件树...')\r\n\tconst treeData = await createTree(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, treeItems, latestCommitSha)\r\n\r\n\ttoast.info('正在创建提交...')\r\n\tconst commitData = await createCommit(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, commitMessage, treeData.sha, [latestCommitSha])\r\n\r\n\ttoast.info('正在更新分支...')\r\n\tawait updateRef(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, `heads/${GITHUB_CONFIG.BRANCH}`, commitData.sha)\r\n\r\n\ttoast.success('发布成功！')\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1004, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/pictures/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState, useRef } from 'react'\r\nimport { motion } from 'motion/react'\r\nimport { toast } from 'sonner'\r\nimport initialList from './list.json'\r\nimport { PictureCard, type Picture } from './components/picture-card'\r\nimport UploadDialog from './components/upload-dialog'\r\nimport { pushPictures } from './services/push-pictures'\r\nimport { useAuthStore } from '@/hooks/use-auth'\r\nimport type { ImageItem } from '../projects/components/image-upload-dialog'\r\nimport { useRouter } from 'next/navigation'\r\n\r\nexport default function Page() {\r\n\tconst [pictures, setPictures] = useState<Picture[]>(initialList as Picture[])\r\n\tconst [originalPictures, setOriginalPictures] = useState<Picture[]>(initialList as Picture[])\r\n\tconst [isEditMode, setIsEditMode] = useState(false)\r\n\tconst [isSaving, setIsSaving] = useState(false)\r\n\tconst [isUploadDialogOpen, setIsUploadDialogOpen] = useState(false)\r\n\tconst [imageItems, setImageItems] = useState<Map<string, ImageItem>>(new Map())\r\n\tconst keyInputRef = useRef<HTMLInputElement>(null)\r\n\tconst router = useRouter()\r\n\r\n\tconst { isAuth, setPrivateKey } = useAuthStore()\r\n\r\n\tconst handleUploadSubmit = ({ images, description }: { images: ImageItem[]; description: string }) => {\r\n\t\tconst now = new Date().toISOString()\r\n\r\n\t\tif (images.length === 0) {\r\n\t\t\ttoast.error('请至少选择一张图片')\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst id = `${Date.now()}-${Math.random().toString(16).slice(2)}`\r\n\t\tconst desc = description.trim() || undefined\r\n\r\n\t\tconst imageUrls = images.map(imageItem => (imageItem.type === 'url' ? imageItem.url : imageItem.previewUrl))\r\n\r\n\t\tconst newPicture: Picture = {\r\n\t\t\tid,\r\n\t\t\tuploadedAt: now,\r\n\t\t\tdescription: desc,\r\n\t\t\timages: imageUrls\r\n\t\t}\r\n\r\n\t\tconst newMap = new Map(imageItems)\r\n\r\n\t\timages.forEach((imageItem, index) => {\r\n\t\t\tif (imageItem.type === 'file') {\r\n\t\t\t\tnewMap.set(`${id}::${index}`, imageItem)\r\n\t\t\t}\r\n\t\t})\r\n\r\n\t\tsetPictures(prev => [...prev, newPicture])\r\n\t\tsetImageItems(newMap)\r\n\t\tsetIsUploadDialogOpen(false)\r\n\t}\r\n\r\n\tconst handleDelete = (picture: Picture) => {\r\n\t\tif (!confirm('确定要删除这一组图片吗？')) return\r\n\r\n\t\tsetPictures(prev => prev.filter(p => p.id !== picture.id))\r\n\t\tsetImageItems(prev => {\r\n\t\t\tconst next = new Map(prev)\r\n\t\t\tfor (const key of next.keys()) {\r\n\t\t\t\tif (key.startsWith(`${picture.id}::`)) {\r\n\t\t\t\t\tnext.delete(key)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn next\r\n\t\t})\r\n\t}\r\n\r\n\tconst handleChoosePrivateKey = async (file: File) => {\r\n\t\ttry {\r\n\t\t\tconst text = await file.text()\r\n\t\t\tsetPrivateKey(text)\r\n\t\t\tawait handleSave()\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Failed to read private key:', error)\r\n\t\t\ttoast.error('读取密钥文件失败')\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleSaveClick = () => {\r\n\t\tif (!isAuth) {\r\n\t\t\tkeyInputRef.current?.click()\r\n\t\t} else {\r\n\t\t\thandleSave()\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleSave = async () => {\r\n\t\tsetIsSaving(true)\r\n\r\n\t\ttry {\r\n\t\t\tawait pushPictures({\r\n\t\t\t\tpictures,\r\n\t\t\t\timageItems\r\n\t\t\t})\r\n\r\n\t\t\tsetOriginalPictures(pictures)\r\n\t\t\tsetImageItems(new Map())\r\n\t\t\tsetIsEditMode(false)\r\n\t\t\ttoast.success('保存成功！')\r\n\t\t} catch (error: any) {\r\n\t\t\tconsole.error('Failed to save:', error)\r\n\t\t\ttoast.error(`保存失败: ${error?.message || '未知错误'}`)\r\n\t\t} finally {\r\n\t\t\tsetIsSaving(false)\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleCancel = () => {\r\n\t\tsetPictures(originalPictures)\r\n\t\tsetImageItems(new Map())\r\n\t\tsetIsEditMode(false)\r\n\t}\r\n\r\n\tconst buttonText = isAuth ? '保存' : '导入密钥'\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<input\r\n\t\t\t\tref={keyInputRef}\r\n\t\t\t\ttype='file'\r\n\t\t\t\taccept='.pem'\r\n\t\t\t\tclassName='hidden'\r\n\t\t\t\tonChange={async e => {\r\n\t\t\t\t\tconst f = e.target.files?.[0]\r\n\t\t\t\t\tif (f) await handleChoosePrivateKey(f)\r\n\t\t\t\t\tif (e.currentTarget) e.currentTarget.value = ''\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\r\n\t\t\t<div className='flex flex-col items-center justify-center px-6 pt-32 pb-12'>\r\n\t\t\t\t<div className='grid w-full max-w-[1200px] grid-cols-3 gap-6 max-lg:grid-cols-2 max-sm:grid-cols-1'>\r\n\t\t\t\t\t{pictures.map(picture => (\r\n\t\t\t\t\t\t<PictureCard key={picture.id} picture={picture} isEditMode={isEditMode} onDelete={() => handleDelete(picture)} />\r\n\t\t\t\t\t))}\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{pictures.length === 0 && <div className='mt-16 text-center text-sm text-gray-500'>还没有上传图片，点击右上角「编辑」后即可开始上传。</div>}\r\n\t\t\t</div>\r\n\r\n\t\t\t<motion.div initial={{ opacity: 0, scale: 0.6 }} animate={{ opacity: 1, scale: 1 }} className='absolute top-4 right-6 flex gap-3 max-sm:hidden'>\r\n\t\t\t\t{isEditMode ? (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<motion.button\r\n\t\t\t\t\t\t\twhileHover={{ scale: 1.05 }}\r\n\t\t\t\t\t\t\twhileTap={{ scale: 0.95 }}\r\n\t\t\t\t\t\t\tonClick={() => router.push('/image-toolbox')}\r\n\t\t\t\t\t\t\tclassName='rounded-xl border bg-blue-50 px-4 py-2 text-sm text-blue-700'>\r\n\t\t\t\t\t\t\t压缩工具\r\n\t\t\t\t\t\t</motion.button>\r\n\t\t\t\t\t\t<motion.button\r\n\t\t\t\t\t\t\twhileHover={{ scale: 1.05 }}\r\n\t\t\t\t\t\t\twhileTap={{ scale: 0.95 }}\r\n\t\t\t\t\t\t\tonClick={handleCancel}\r\n\t\t\t\t\t\t\tdisabled={isSaving}\r\n\t\t\t\t\t\t\tclassName='rounded-xl border bg-white/60 px-6 py-2 text-sm'>\r\n\t\t\t\t\t\t\t取消\r\n\t\t\t\t\t\t</motion.button>\r\n\t\t\t\t\t\t<motion.button\r\n\t\t\t\t\t\t\twhileHover={{ scale: 1.05 }}\r\n\t\t\t\t\t\t\twhileTap={{ scale: 0.95 }}\r\n\t\t\t\t\t\t\tonClick={() => setIsUploadDialogOpen(true)}\r\n\t\t\t\t\t\t\tclassName='rounded-xl border bg-white/60 px-6 py-2 text-sm'>\r\n\t\t\t\t\t\t\t上传\r\n\t\t\t\t\t\t</motion.button>\r\n\t\t\t\t\t\t<motion.button whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} onClick={handleSaveClick} disabled={isSaving} className='brand-btn px-6'>\r\n\t\t\t\t\t\t\t{isSaving ? '保存中...' : buttonText}\r\n\t\t\t\t\t\t</motion.button>\r\n\t\t\t\t\t</>\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<motion.button\r\n\t\t\t\t\t\twhileHover={{ scale: 1.05 }}\r\n\t\t\t\t\t\twhileTap={{ scale: 0.95 }}\r\n\t\t\t\t\t\tonClick={() => setIsEditMode(true)}\r\n\t\t\t\t\t\tclassName='rounded-xl border bg-white/60 px-6 py-2 text-sm backdrop-blur-sm transition-colors hover:bg-white/80'>\r\n\t\t\t\t\t\t编辑\r\n\t\t\t\t\t</motion.button>\r\n\t\t\t\t)}\r\n\t\t\t</motion.div>\r\n\r\n\t\t\t{isUploadDialogOpen && <UploadDialog onClose={() => setIsUploadDialogOpen(false)} onSubmit={handleUploadSubmit} />}\r\n\t\t</>\r\n\t)\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}}]
}