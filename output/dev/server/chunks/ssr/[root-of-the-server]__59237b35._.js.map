{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/lib/file-utils.ts"],"sourcesContent":["'use client'\r\n\r\nexport function readFileAsText(file: File): Promise<string> {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst reader = new FileReader()\r\n\t\treader.onload = () => resolve(String(reader.result || ''))\r\n\t\treader.onerror = reject\r\n\t\treader.readAsText(file)\r\n\t})\r\n}\r\n\r\nexport function fileToBase64NoPrefix(file: File): Promise<string> {\r\n\treturn new Promise((resolve, reject) => {\r\n\t\tconst reader = new FileReader()\r\n\t\treader.onload = () => {\r\n\t\t\tconst dataUrl = String(reader.result || '')\r\n\t\t\tresolve(dataUrl.replace(/^data:[^;]+;base64,/, ''))\r\n\t\t}\r\n\t\treader.onerror = reject\r\n\t\treader.readAsDataURL(file)\r\n\t})\r\n}\r\n\r\nexport async function hashFileSHA256(file: File): Promise<string> {\r\n\tconst buf = await file.arrayBuffer()\r\n\tconst digest = await crypto.subtle.digest('SHA-256', buf)\r\n\tconst bytes = new Uint8Array(digest)\r\n\tlet hex = ''\r\n\tfor (let i = 0; i < bytes.length; i++) {\r\n\t\tconst h = bytes[i].toString(16).padStart(2, '0')\r\n\t\thex += h\r\n\t}\r\n\treturn hex.slice(0, 16)\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AAEO,SAAS,eAAe,IAAU;IACxC,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC5B,MAAM,SAAS,IAAI;QACnB,OAAO,MAAM,GAAG,IAAM,QAAQ,OAAO,OAAO,MAAM,IAAI;QACtD,OAAO,OAAO,GAAG;QACjB,OAAO,UAAU,CAAC;IACnB;AACD;AAEO,SAAS,qBAAqB,IAAU;IAC9C,OAAO,IAAI,QAAQ,CAAC,SAAS;QAC5B,MAAM,SAAS,IAAI;QACnB,OAAO,MAAM,GAAG;YACf,MAAM,UAAU,OAAO,OAAO,MAAM,IAAI;YACxC,QAAQ,QAAQ,OAAO,CAAC,uBAAuB;QAChD;QACA,OAAO,OAAO,GAAG;QACjB,OAAO,aAAa,CAAC;IACtB;AACD;AAEO,eAAe,eAAe,IAAU;IAC9C,MAAM,MAAM,MAAM,KAAK,WAAW;IAClC,MAAM,SAAS,MAAM,OAAO,MAAM,CAAC,MAAM,CAAC,WAAW;IACrD,MAAM,QAAQ,IAAI,WAAW;IAC7B,IAAI,MAAM;IACV,IAAK,IAAI,IAAI,GAAG,IAAI,MAAM,MAAM,EAAE,IAAK;QACtC,MAAM,IAAI,KAAK,CAAC,EAAE,CAAC,QAAQ,CAAC,IAAI,QAAQ,CAAC,GAAG;QAC5C,OAAO;IACR;IACA,OAAO,IAAI,KAAK,CAAC,GAAG;AACrB","debugId":null}},
    {"offset": {"line": 47, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/lib/load-blog.ts"],"sourcesContent":["export type BlogConfig = {\r\n\ttitle?: string\r\n\ttags?: string[]\r\n\tdate?: string\r\n\tsummary?: string\r\n\tcover?: string\r\n}\r\n\r\nexport type LoadedBlog = {\r\n\tslug: string\r\n\tconfig: BlogConfig\r\n\tmarkdown: string\r\n\tcover?: string\r\n}\r\n\r\n/**\r\n * Load blog data from public/blogs/{slug}\r\n * Used by both view page and edit page\r\n */\r\nexport async function loadBlog(slug: string): Promise<LoadedBlog> {\r\n\tif (!slug) {\r\n\t\tthrow new Error('Slug is required')\r\n\t}\r\n\r\n\t// Load config.json\r\n\tlet config: BlogConfig = {}\r\n\tconst configRes = await fetch(`/blogs/${encodeURIComponent(slug)}/config.json`)\r\n\tif (configRes.ok) {\r\n\t\ttry {\r\n\t\t\tconfig = await configRes.json()\r\n\t\t} catch {\r\n\t\t\tconfig = {}\r\n\t\t}\r\n\t}\r\n\r\n\t// Load index.md\r\n\tconst mdRes = await fetch(`/blogs/${encodeURIComponent(slug)}/index.md`)\r\n\tif (!mdRes.ok) {\r\n\t\tthrow new Error('Blog not found')\r\n\t}\r\n\tconst markdown = await mdRes.text()\r\n\r\n\treturn {\r\n\t\tslug,\r\n\t\tconfig,\r\n\t\tmarkdown,\r\n\t\tcover: config.cover\r\n\t}\r\n}\r\n"],"names":[],"mappings":";;;;AAmBO,eAAe,SAAS,IAAY;IAC1C,IAAI,CAAC,MAAM;QACV,MAAM,IAAI,MAAM;IACjB;IAEA,mBAAmB;IACnB,IAAI,SAAqB,CAAC;IAC1B,MAAM,YAAY,MAAM,MAAM,CAAC,OAAO,EAAE,mBAAmB,MAAM,YAAY,CAAC;IAC9E,IAAI,UAAU,EAAE,EAAE;QACjB,IAAI;YACH,SAAS,MAAM,UAAU,IAAI;QAC9B,EAAE,OAAM;YACP,SAAS,CAAC;QACX;IACD;IAEA,gBAAgB;IAChB,MAAM,QAAQ,MAAM,MAAM,CAAC,OAAO,EAAE,mBAAmB,MAAM,SAAS,CAAC;IACvE,IAAI,CAAC,MAAM,EAAE,EAAE;QACd,MAAM,IAAI,MAAM;IACjB;IACA,MAAM,WAAW,MAAM,MAAM,IAAI;IAEjC,OAAO;QACN;QACA;QACA;QACA,OAAO,OAAO,KAAK;IACpB;AACD","debugId":null}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/stores/write-store.ts"],"sourcesContent":["import { create } from 'zustand'\r\nimport { toast } from 'sonner'\r\nimport { hashFileSHA256 } from '@/lib/file-utils'\r\nimport { loadBlog } from '@/lib/load-blog'\r\nimport type { PublishForm, ImageItem } from '../types'\r\n\r\ntype WriteStore = {\r\n\t// Mode state\r\n\tmode: 'create' | 'edit'\r\n\toriginalSlug: string | null\r\n\tsetMode: (mode: 'create' | 'edit', originalSlug?: string) => void\r\n\r\n\t// Form state\r\n\tform: PublishForm\r\n\tupdateForm: (updates: Partial<PublishForm>) => void\r\n\tsetForm: (form: PublishForm) => void\r\n\r\n\t// Image state\r\n\timages: ImageItem[]\r\n\taddUrlImage: (url: string) => void\r\n\taddFiles: (files: FileList | File[]) => Promise<ImageItem[]>\r\n\tdeleteImage: (id: string) => void\r\n\r\n\t// Cover state\r\n\tcover: ImageItem | null\r\n\tsetCover: (cover: ImageItem | null) => void\r\n\r\n\t// Publish state\r\n\tloading: boolean\r\n\tsetLoading: (loading: boolean) => void\r\n\r\n\t// Load blog for editing\r\n\tloadBlogForEdit: (slug: string) => Promise<void>\r\n\r\n\t// Reset to create mode\r\n\treset: () => void\r\n}\r\n\r\nconst initialForm: PublishForm = {\r\n\tslug: '',\r\n\ttitle: '',\r\n\tmd: '',\r\n\ttags: [],\r\n\tdate: new Date().toISOString().slice(0, 10),\r\n\tsummary: ''\r\n}\r\n\r\nexport const useWriteStore = create<WriteStore>((set, get) => ({\r\n\t// Mode state\r\n\tmode: 'create',\r\n\toriginalSlug: null,\r\n\tsetMode: (mode, originalSlug) => set({ mode, originalSlug: originalSlug || null }),\r\n\r\n\t// Form state\r\n\tform: { ...initialForm },\r\n\tupdateForm: updates => set(state => ({ form: { ...state.form, ...updates } })),\r\n\tsetForm: form => set({ form }),\r\n\r\n\t// Image state\r\n\timages: [],\r\n\taddUrlImage: url => {\r\n\t\tconst { images } = get()\r\n\t\tconst exists = images.some(it => it.type === 'url' && it.url === url)\r\n\t\tif (exists) {\r\n\t\t\ttoast.info('该图片已在列表中')\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconst id = Math.random().toString(36).slice(2, 10)\r\n\t\tset(state => ({ images: [{ id, type: 'url', url }, ...state.images] }))\r\n\t},\r\n\taddFiles: async (files: FileList | File[]) => {\r\n\t\tconst { images } = get()\r\n\t\tconst arr = Array.from(files).filter(f => f.type.startsWith('image/'))\r\n\t\tif (arr.length === 0) return []\r\n\r\n\t\tconst existingHashes = new Map<string, ImageItem>(\r\n\t\t\timages\r\n\t\t\t\t.filter((it): it is Extract<ImageItem, { type: 'file'; hash?: string }> => it.type === 'file' && (it as any).hash)\r\n\t\t\t\t.map(it => [(it as any).hash as string, it])\r\n\t\t)\r\n\r\n\t\tconst computed = await Promise.all(\r\n\t\t\tarr.map(async file => {\r\n\t\t\t\tconst hash = await hashFileSHA256(file)\r\n\t\t\t\treturn { file, hash }\r\n\t\t\t})\r\n\t\t)\r\n\r\n\t\tconst seen = new Set<string>()\r\n\t\tconst unique = computed.filter(({ hash }) => {\r\n\t\t\tif (existingHashes.has(hash)) return false\r\n\t\t\tif (seen.has(hash)) return false\r\n\t\t\tseen.add(hash)\r\n\t\t\treturn true\r\n\t\t})\r\n\r\n\t\tconst resultImages: ImageItem[] = []\r\n\r\n\t\t// 处理已存在的图片\r\n\t\tfor (const { hash } of computed) {\r\n\t\t\tif (existingHashes.has(hash)) {\r\n\t\t\t\tresultImages.push(existingHashes.get(hash)!)\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 处理新图片\r\n\t\tif (unique.length > 0) {\r\n\t\t\tconst newItems: ImageItem[] = unique.map(({ file, hash }) => {\r\n\t\t\t\tconst id = Math.random().toString(36).slice(2, 10)\r\n\t\t\t\tconst previewUrl = URL.createObjectURL(file)\r\n\t\t\t\tconst filename = file.name\r\n\t\t\t\treturn { id, type: 'file', file, previewUrl, filename, hash }\r\n\t\t\t})\r\n\r\n\t\t\tset(state => ({ images: [...newItems, ...state.images] }))\r\n\t\t\tresultImages.push(...newItems)\r\n\t\t} else if (resultImages.length === 0) {\r\n\t\t\ttoast.info('图片已存在，不重复添加')\r\n\t\t}\r\n\r\n\t\treturn resultImages\r\n\t},\r\n\tdeleteImage: id =>\r\n\t\tset(state => {\r\n\t\t\tfor (const it of state.images) {\r\n\t\t\t\tif (it.type === 'file' && it.id === id) {\r\n\t\t\t\t\tURL.revokeObjectURL(it.previewUrl)\r\n\r\n\t\t\t\t\tif (it.id === state.cover?.id) {\r\n\t\t\t\t\t\tset({ cover: null })\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn { images: state.images.filter(it => it.id !== id) }\r\n\t\t}),\r\n\r\n\t// Cover state\r\n\tcover: null,\r\n\tsetCover: cover => set({ cover }),\r\n\r\n\t// Publish state\r\n\tloading: false,\r\n\tsetLoading: loading => set({ loading }),\r\n\r\n\t// Load blog for editing\r\n\tloadBlogForEdit: async (slug: string) => {\r\n\t\ttry {\r\n\t\t\tset({ loading: true })\r\n\t\t\tconst blog = await loadBlog(slug)\r\n\r\n\t\t\t// Parse images from markdown\r\n\t\t\tconst images: ImageItem[] = []\r\n\t\t\tconst imageRegex = /!\\[.*?\\]\\((.*?)\\)/g\r\n\t\t\tlet match\r\n\t\t\twhile ((match = imageRegex.exec(blog.markdown)) !== null) {\r\n\t\t\t\tconst url = match[1]\r\n\t\t\t\t// Skip cover image and only collect content images\r\n\t\t\t\tif (url && url !== blog.cover && !url.startsWith('local-image:')) {\r\n\t\t\t\t\t// Check if already added\r\n\t\t\t\t\tif (!images.some(img => img.type === 'url' && img.url === url)) {\r\n\t\t\t\t\t\tconst id = Math.random().toString(36).slice(2, 10)\r\n\t\t\t\t\t\timages.push({ id, type: 'url', url })\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Set cover\r\n\t\t\tlet cover: ImageItem | null = null\r\n\t\t\tif (blog.cover) {\r\n\t\t\t\tconst coverId = Math.random().toString(36).slice(2, 10)\r\n\t\t\t\tcover = { id: coverId, type: 'url', url: blog.cover }\r\n\t\t\t}\r\n\r\n\t\t\t// Set form\r\n\t\t\tset({\r\n\t\t\t\tmode: 'edit',\r\n\t\t\t\toriginalSlug: slug,\r\n\t\t\t\tform: {\r\n\t\t\t\t\tslug,\r\n\t\t\t\t\ttitle: blog.config.title || '',\r\n\t\t\t\t\tmd: blog.markdown,\r\n\t\t\t\t\ttags: blog.config.tags || [],\r\n\t\t\t\t\tdate: blog.config.date || new Date().toISOString().slice(0, 10),\r\n\t\t\t\t\tsummary: blog.config.summary || ''\r\n\t\t\t\t},\r\n\t\t\t\timages,\r\n\t\t\t\tcover,\r\n\t\t\t\tloading: false\r\n\t\t\t})\r\n\r\n\t\t\ttoast.success('博客加载成功')\r\n\t\t} catch (err: any) {\r\n\t\t\tconsole.error('Failed to load blog:', err)\r\n\t\t\ttoast.error(err?.message || '加载博客失败')\r\n\t\t\tset({ loading: false })\r\n\t\t\tthrow err\r\n\t\t}\r\n\t},\r\n\r\n\t// Reset to create mode\r\n\treset: () => {\r\n\t\t// Revoke object URLs\r\n\t\tconst { images, cover } = get()\r\n\t\tfor (const img of images) {\r\n\t\t\tif (img.type === 'file') {\r\n\t\t\t\tURL.revokeObjectURL(img.previewUrl)\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (cover?.type === 'file') {\r\n\t\t\tURL.revokeObjectURL(cover.previewUrl)\r\n\t\t}\r\n\r\n\t\tset({\r\n\t\t\tmode: 'create',\r\n\t\t\toriginalSlug: null,\r\n\t\t\tform: { ...initialForm, date: new Date().toISOString().slice(0, 10) },\r\n\t\t\timages: [],\r\n\t\t\tcover: null\r\n\t\t})\r\n\t}\r\n}))\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 315, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/stores/preview-store.ts"],"sourcesContent":["import { create } from 'zustand'\r\n\r\ntype PreviewStore = {\r\n\tisPreview: boolean\r\n\topenPreview: () => void\r\n\tclosePreview: () => void\r\n\ttogglePreview: () => void\r\n}\r\n\r\nexport const usePreviewStore = create<PreviewStore>(set => ({\r\n\tisPreview: false,\r\n\topenPreview: () => set({ isPreview: true }),\r\n\tclosePreview: () => set({ isPreview: false }),\r\n\ttogglePreview: () => set(state => ({ isPreview: !state.isPreview }))\r\n}))\r\n"],"names":[],"mappings":";;;;AAAA;;AASO,MAAM,kBAAkB,IAAA,8PAAM,EAAe,CAAA,MAAO,CAAC;QAC3D,WAAW;QACX,aAAa,IAAM,IAAI;gBAAE,WAAW;YAAK;QACzC,cAAc,IAAM,IAAI;gBAAE,WAAW;YAAM;QAC3C,eAAe,IAAM,IAAI,CAAA,QAAS,CAAC;oBAAE,WAAW,CAAC,MAAM,SAAS;gBAAC,CAAC;IACnE,CAAC","debugId":null}},
    {"offset": {"line": 337, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/components/editor.tsx"],"sourcesContent":["import { motion } from 'motion/react'\r\nimport { useWriteStore } from '../stores/write-store'\r\nimport { INIT_DELAY } from '@/consts'\r\nimport { useRef } from 'react'\r\n\r\nconst defaultText = 'text'\r\n\r\nexport function WriteEditor() {\r\n\tconst { form, updateForm, images, addFiles } = useWriteStore()\r\n\tconst textareaRef = useRef<HTMLTextAreaElement>(null)\r\n\r\n\tconst insertText = (text: string) => {\r\n\t\tconst textarea = textareaRef.current\r\n\t\tif (!textarea) return\r\n\r\n\t\ttextarea.focus()\r\n\t\t// Use execCommand to preserve undo/redo stack\r\n\t\tconst success = document.execCommand('insertText', false, text)\r\n\r\n\t\tif (!success) {\r\n\t\t\t// Fallback for browsers that don't support execCommand\r\n\t\t\tconst { selectionStart, selectionEnd, value } = textarea\r\n\t\t\tconst before = value.substring(0, selectionStart)\r\n\t\t\tconst after = value.substring(selectionEnd)\r\n\t\t\tupdateForm({ md: before + text + after })\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\ttextarea.setSelectionRange(selectionStart + text.length, selectionStart + text.length)\r\n\t\t\t\ttextarea.focus()\r\n\t\t\t}, 0)\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleKeyDown = (e: React.KeyboardEvent<HTMLTextAreaElement>) => {\r\n\t\tconst textarea = textareaRef.current\r\n\t\tif (!textarea) return\r\n\r\n\t\tconst { selectionStart, selectionEnd, value } = textarea\r\n\t\tconst selectedText = value.substring(selectionStart, selectionEnd)\r\n\r\n\t\t// Ctrl/Cmd + B: Toggle Bold\r\n\t\tif ((e.ctrlKey || e.metaKey) && e.key === 'b') {\r\n\t\t\te.preventDefault()\r\n\t\t\tconst before = value.substring(0, selectionStart)\r\n\t\t\tconst after = value.substring(selectionEnd)\r\n\r\n\t\t\t// Check if already bold\r\n\t\t\tconst isBold = before.endsWith('**') && after.startsWith('**')\r\n\r\n\t\t\tif (isBold && selectedText) {\r\n\t\t\t\t// Remove bold - select including markers and replace\r\n\t\t\t\ttextarea.setSelectionRange(selectionStart - 2, selectionEnd + 2)\r\n\t\t\t\tinsertText(selectedText)\r\n\t\t\t} else {\r\n\t\t\t\t// Add bold\r\n\t\t\t\tconst text = selectedText || defaultText\r\n\t\t\t\tinsertText(`**${text}**`)\r\n\t\t\t\tif (!selectedText) {\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\ttextarea.setSelectionRange(selectionStart + 2, selectionStart + 2 + defaultText.length)\r\n\t\t\t\t\t}, 0)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t// Ctrl/Cmd + I: Toggle Italic\r\n\t\tif ((e.ctrlKey || e.metaKey) && e.key === 'i') {\r\n\t\t\te.preventDefault()\r\n\t\t\tconst before = value.substring(0, selectionStart)\r\n\t\t\tconst after = value.substring(selectionEnd)\r\n\r\n\t\t\t// Check if already italic\r\n\t\t\tconst isItalic = before.endsWith('*') && after.startsWith('*') && !(before.endsWith('**') && after.startsWith('**'))\r\n\r\n\t\t\tif (isItalic && selectedText) {\r\n\t\t\t\t// Remove italic and replace\r\n\t\t\t\ttextarea.setSelectionRange(selectionStart - 1, selectionEnd + 1)\r\n\t\t\t\tinsertText(selectedText)\r\n\t\t\t} else {\r\n\t\t\t\t// Add italic\r\n\t\t\t\tconst text = selectedText || defaultText\r\n\t\t\t\tinsertText(`*${text}*`)\r\n\t\t\t\tif (!selectedText) {\r\n\t\t\t\t\t// Select the default text\r\n\t\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t\ttextarea.setSelectionRange(selectionStart + 1, selectionStart + 1 + defaultText.length)\r\n\t\t\t\t\t}, 0)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t// Ctrl/Cmd + K: Link\r\n\t\tif ((e.ctrlKey || e.metaKey) && e.key === 'k') {\r\n\t\t\te.preventDefault()\r\n\t\t\tconst text = selectedText || defaultText\r\n\t\t\tinsertText(`[${text}](url)`)\r\n\t\t\t// Select 'url' part\r\n\t\t\tsetTimeout(() => {\r\n\t\t\t\tconst urlStart = selectionStart + text.length + 3\r\n\t\t\t\ttextarea.setSelectionRange(urlStart, urlStart + 3)\r\n\t\t\t}, 0)\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t// Tab: Indent\r\n\t\tif (e.key === 'Tab' && !e.shiftKey) {\r\n\t\t\te.preventDefault()\r\n\t\t\tinsertText('\\t')\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\t// Shift + Tab: Outdent\r\n\t\tif (e.key === 'Tab' && e.shiftKey) {\r\n\t\t\te.preventDefault()\r\n\t\t\tconst lineStart = value.lastIndexOf('\\n', selectionStart - 1) + 1\r\n\t\t\tconst line = value.substring(lineStart, value.indexOf('\\n', selectionStart))\r\n\r\n\t\t\tif (line.startsWith('\\t')) {\r\n\t\t\t\ttextarea.setSelectionRange(lineStart, lineStart + 1)\r\n\t\t\t\tinsertText('')\r\n\t\t\t} else if (line.startsWith('  ')) {\r\n\t\t\t\ttextarea.setSelectionRange(lineStart, lineStart + 2)\r\n\t\t\t\tinsertText('')\r\n\t\t\t}\r\n\t\t\treturn\r\n\t\t}\r\n\t}\r\n\r\n\tconst handlePaste = async (e: React.ClipboardEvent<HTMLTextAreaElement>) => {\r\n\t\tconst items = e.clipboardData.items\r\n\t\tif (!items) return\r\n\r\n\t\tconst imageFiles: File[] = []\r\n\t\tfor (let i = 0; i < items.length; i++) {\r\n\t\t\tconst item = items[i]\r\n\t\t\tif (item.type.startsWith('image/')) {\r\n\t\t\t\tconst file = item.getAsFile()\r\n\t\t\t\tif (file) {\r\n\t\t\t\t\timageFiles.push(file)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (imageFiles.length > 0) {\r\n\t\t\te.preventDefault()\r\n\r\n\t\t\tconst resultImages = await addFiles(imageFiles).catch(() => [])\r\n\r\n\t\t\tif (resultImages && resultImages.length > 0) {\r\n\t\t\t\t// 为所有处理后的图片（包括新添加和已存在的）生成 markdown\r\n\t\t\t\tconst markdowns = resultImages.map(item => (item.type === 'url' ? `![](${item.url})` : `![](local-image:${item.id})`)).join('\\n')\r\n\t\t\t\tinsertText(markdowns)\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<motion.div\r\n\t\t\tinitial={{ opacity: 0, scale: 0.8 }}\r\n\t\t\tanimate={{ opacity: 1, scale: 1 }}\r\n\t\t\ttransition={{ delay: INIT_DELAY }}\r\n\t\t\tclassName='flex min-h-[800px] w-[800px] flex-col rounded-[40px] border bg-white/60 p-6 shadow'>\r\n\t\t\t<div className='mb-3 flex gap-3'>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype='text'\r\n\t\t\t\t\tplaceholder='标题'\r\n\t\t\t\t\tclassName='flex-1 rounded-lg border bg-white/60 px-3 py-2 text-sm'\r\n\t\t\t\t\tvalue={form.title}\r\n\t\t\t\t\tonChange={e => updateForm({ title: e.target.value })}\r\n\t\t\t\t/>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype='text'\r\n\t\t\t\t\tplaceholder='slug（xx-xx）'\r\n\t\t\t\t\tclassName='w-[200px] rounded-lg border bg-white/60 px-3 py-2 text-sm'\r\n\t\t\t\t\tvalue={form.slug}\r\n\t\t\t\t\tonChange={e => updateForm({ slug: e.target.value })}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t\t<textarea\r\n\t\t\t\tref={textareaRef}\r\n\t\t\t\tplaceholder='Markdown 内容'\r\n\t\t\t\tclassName='h-[650px] w-full flex-1 resize-none rounded-xl border bg-white/60 p-4 text-sm'\r\n\t\t\t\tvalue={form.md}\r\n\t\t\t\tonChange={e => updateForm({ md: e.target.value })}\r\n\t\t\t\tonKeyDown={handleKeyDown}\r\n\t\t\t\tonPaste={handlePaste}\r\n\t\t\t/>\r\n\t\t</motion.div>\r\n\t)\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 558, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/components/sections/cover-section.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useRef } from 'react'\r\nimport { motion } from 'motion/react'\r\nimport { toast } from 'sonner'\r\nimport { useWriteStore } from '../../stores/write-store'\r\n\r\ntype CoverSectionProps = {\r\n\tdelay?: number\r\n}\r\n\r\nexport function CoverSection({ delay = 0 }: CoverSectionProps) {\r\n\tconst { images, setCover, cover, addFiles } = useWriteStore()\r\n\tconst fileInputRef = useRef<HTMLInputElement>(null)\r\n\r\n\tconst coverPreviewUrl = cover ? (cover.type === 'url' ? cover.url : cover.previewUrl) : null\r\n\r\n\tconst handleCoverDrop = async (e: React.DragEvent<HTMLDivElement>) => {\r\n\t\te.preventDefault()\r\n\r\n\t\t// 处理从图片列表中拖入的情况\r\n\t\tconst md = e.dataTransfer.getData('text/markdown') || e.dataTransfer.getData('text/plain') || ''\r\n\t\tconst m = /!\\[\\]\\(([^)]+)\\)/.exec(md.trim())\r\n\t\tif (m) {\r\n\t\t\tconst target = m[1]\r\n\t\t\tlet foundItem\r\n\r\n\t\t\tif (target.startsWith('local-image:')) {\r\n\t\t\t\tconst id = target.replace(/^local-image:/, '')\r\n\t\t\t\tfoundItem = images.find(it => it.id === id)\r\n\t\t\t} else {\r\n\t\t\t\tfoundItem = images.find(it => it.type === 'url' && it.url === target)\r\n\t\t\t}\r\n\r\n\t\t\tif (foundItem) {\r\n\t\t\t\tsetCover(foundItem)\r\n\t\t\t\ttoast.success('已设置封面')\r\n\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// 处理直接拖入文件的情况\r\n\t\tconst files = e.dataTransfer.files\r\n\t\tif (files && files.length > 0) {\r\n\t\t\tconst imageFiles = Array.from(files).filter(file => file.type.startsWith('image/'))\r\n\t\t\tif (imageFiles.length === 0) {\r\n\t\t\t\ttoast.error('请拖入图片文件')\r\n\t\t\t\treturn\r\n\t\t\t}\r\n\r\n\t\t\tconst resultImages = await addFiles(imageFiles as unknown as FileList)\r\n\t\t\tif (resultImages && resultImages.length > 0) {\r\n\t\t\t\t// 使用第一个图片作为封面\r\n\t\t\t\tsetCover(resultImages[0])\r\n\t\t\t\ttoast.success('已设置封面')\r\n\t\t\t}\r\n\t\t\treturn\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleClickUpload = () => {\r\n\t\tfileInputRef.current?.click()\r\n\t}\r\n\r\n\tconst handleFileChange = async (e: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tconst files = e.target.files\r\n\t\tif (!files || files.length === 0) return\r\n\r\n\t\tconst resultImages = await addFiles(files)\r\n\t\tif (resultImages && resultImages.length > 0) {\r\n\t\t\t// 使用第一个图片作为封面\r\n\t\t\tsetCover(resultImages[0])\r\n\t\t\ttoast.success('已设置封面')\r\n\t\t}\r\n\r\n\t\t// 重置 input 以便可以选择相同的文件\r\n\t\te.target.value = ''\r\n\t}\r\n\r\n\treturn (\r\n\t\t<motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay }} className='card relative'>\r\n\t\t\t<h2 className='text-sm'>封面</h2>\r\n\t\t\t<input ref={fileInputRef} type='file' accept='image/*' className='hidden' onChange={handleFileChange} />\r\n\t\t\t<div\r\n\t\t\t\tclassName='mt-3 h-[150px] overflow-hidden rounded-xl border bg-white/60'\r\n\t\t\t\tonDragOver={e => {\r\n\t\t\t\t\te.preventDefault()\r\n\t\t\t\t}}\r\n\t\t\t\tonDrop={handleCoverDrop}>\r\n\t\t\t\t{!!coverPreviewUrl ? (\r\n\t\t\t\t\t<img src={coverPreviewUrl} alt='cover preview' className='h-full w-full rounded-2xl object-cover' />\r\n\t\t\t\t) : (\r\n\t\t\t\t\t<div className='grid h-full w-full cursor-pointer place-items-center transition-colors hover:bg-white/60' onClick={handleClickUpload}>\r\n\t\t\t\t\t\t<span className='text-3xl leading-none text-neutral-400'>+</span>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t)}\r\n\t\t\t</div>\r\n\t\t</motion.div>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAWO,SAAS,aAAa,EAAE,QAAQ,CAAC,EAAqB;IAC5D,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,KAAK,EAAE,QAAQ,EAAE,GAAG,IAAA,gKAAa;IAC3D,MAAM,eAAe,IAAA,8TAAM,EAAmB;IAE9C,MAAM,kBAAkB,QAAS,MAAM,IAAI,KAAK,QAAQ,MAAM,GAAG,GAAG,MAAM,UAAU,GAAI;IAExF,MAAM,kBAAkB,OAAO;QAC9B,EAAE,cAAc;QAEhB,gBAAgB;QAChB,MAAM,KAAK,EAAE,YAAY,CAAC,OAAO,CAAC,oBAAoB,EAAE,YAAY,CAAC,OAAO,CAAC,iBAAiB;QAC9F,MAAM,IAAI,mBAAmB,IAAI,CAAC,GAAG,IAAI;QACzC,IAAI,GAAG;YACN,MAAM,SAAS,CAAC,CAAC,EAAE;YACnB,IAAI;YAEJ,IAAI,OAAO,UAAU,CAAC,iBAAiB;gBACtC,MAAM,KAAK,OAAO,OAAO,CAAC,iBAAiB;gBAC3C,YAAY,OAAO,IAAI,CAAC,CAAA,KAAM,GAAG,EAAE,KAAK;YACzC,OAAO;gBACN,YAAY,OAAO,IAAI,CAAC,CAAA,KAAM,GAAG,IAAI,KAAK,SAAS,GAAG,GAAG,KAAK;YAC/D;YAEA,IAAI,WAAW;gBACd,SAAS;gBACT,iRAAK,CAAC,OAAO,CAAC;gBAEd;YACD;QACD;QAEA,cAAc;QACd,MAAM,QAAQ,EAAE,YAAY,CAAC,KAAK;QAClC,IAAI,SAAS,MAAM,MAAM,GAAG,GAAG;YAC9B,MAAM,aAAa,MAAM,IAAI,CAAC,OAAO,MAAM,CAAC,CAAA,OAAQ,KAAK,IAAI,CAAC,UAAU,CAAC;YACzE,IAAI,WAAW,MAAM,KAAK,GAAG;gBAC5B,iRAAK,CAAC,KAAK,CAAC;gBACZ;YACD;YAEA,MAAM,eAAe,MAAM,SAAS;YACpC,IAAI,gBAAgB,aAAa,MAAM,GAAG,GAAG;gBAC5C,cAAc;gBACd,SAAS,YAAY,CAAC,EAAE;gBACxB,iRAAK,CAAC,OAAO,CAAC;YACf;YACA;QACD;IACD;IAEA,MAAM,oBAAoB;QACzB,aAAa,OAAO,EAAE;IACvB;IAEA,MAAM,mBAAmB,OAAO;QAC/B,MAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;QAC5B,IAAI,CAAC,SAAS,MAAM,MAAM,KAAK,GAAG;QAElC,MAAM,eAAe,MAAM,SAAS;QACpC,IAAI,gBAAgB,aAAa,MAAM,GAAG,GAAG;YAC5C,cAAc;YACd,SAAS,YAAY,CAAC,EAAE;YACxB,iRAAK,CAAC,OAAO,CAAC;QACf;QAEA,uBAAuB;QACvB,EAAE,MAAM,CAAC,KAAK,GAAG;IAClB;IAEA,qBACC,6VAAC,0SAAM,CAAC,GAAG;QAAC,SAAS;YAAE,SAAS;YAAG,OAAO;QAAI;QAAG,SAAS;YAAE,SAAS;YAAG,OAAO;QAAE;QAAG,YAAY;YAAE;QAAM;QAAG,WAAU;;0BACpH,6VAAC;gBAAG,WAAU;0BAAU;;;;;;0BACxB,6VAAC;gBAAM,KAAK;gBAAc,MAAK;gBAAO,QAAO;gBAAU,WAAU;gBAAS,UAAU;;;;;;0BACpF,6VAAC;gBACA,WAAU;gBACV,YAAY,CAAA;oBACX,EAAE,cAAc;gBACjB;gBACA,QAAQ;0BACP,CAAC,CAAC,gCACF,6VAAC;oBAAI,KAAK;oBAAiB,KAAI;oBAAgB,WAAU;;;;;yCAEzD,6VAAC;oBAAI,WAAU;oBAA2F,SAAS;8BAClH,cAAA,6VAAC;wBAAK,WAAU;kCAAyC;;;;;;;;;;;;;;;;;;;;;;AAM/D","debugId":null}},
    {"offset": {"line": 708, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/components/ui/tag-input.tsx"],"sourcesContent":["import { useState } from 'react'\r\n\r\ntype TagInputProps = {\r\n\ttags: string[]\r\n\tonChange: (tags: string[]) => void\r\n}\r\n\r\nexport function TagInput({ tags, onChange }: TagInputProps) {\r\n\tconst [tagInput, setTagInput] = useState<string>('')\r\n\r\n\tconst handleAddTag = () => {\r\n\t\tif (tagInput.trim() && !tags.includes(tagInput.trim())) {\r\n\t\t\tonChange([...tags, tagInput.trim()])\r\n\t\t\tsetTagInput('')\r\n\t\t}\r\n\t}\r\n\r\n\tconst handleRemoveTag = (index: number) => {\r\n\t\tonChange(tags.filter((_, i) => i !== index))\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className='w-full rounded-lg border bg-white/70 px-3 py-2'>\r\n\t\t\t{tags.length > 0 && (\r\n\t\t\t\t<div className='mb-2 flex flex-wrap gap-2'>\r\n\t\t\t\t\t{tags.map((tag, index) => (\r\n\t\t\t\t\t\t<span key={index} className='flex items-center gap-1.5 rounded-md bg-blue-100 px-2 py-1 text-sm text-blue-700'>\r\n\t\t\t\t\t\t\t#{tag}\r\n\t\t\t\t\t\t\t<button type='button' onClick={() => handleRemoveTag(index)} className='text-secondary'>\r\n\t\t\t\t\t\t\t\t×\r\n\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t</span>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</div>\r\n\t\t\t)}\r\n\t\t\t<input\r\n\t\t\t\ttype='text'\r\n\t\t\t\tplaceholder='添加标签（按回车）'\r\n\t\t\t\tclassName='w-full bg-transparent text-sm outline-none'\r\n\t\t\t\tvalue={tagInput}\r\n\t\t\t\tonChange={e => setTagInput(e.target.value)}\r\n\t\t\t\tonKeyDown={e => {\r\n\t\t\t\t\tif (e.key === 'Enter') {\r\n\t\t\t\t\t\te.preventDefault()\r\n\t\t\t\t\t\thandleAddTag()\r\n\t\t\t\t\t}\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\t\t</div>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;;;AAOO,SAAS,SAAS,EAAE,IAAI,EAAE,QAAQ,EAAiB;IACzD,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,gUAAQ,EAAS;IAEjD,MAAM,eAAe;QACpB,IAAI,SAAS,IAAI,MAAM,CAAC,KAAK,QAAQ,CAAC,SAAS,IAAI,KAAK;YACvD,SAAS;mBAAI;gBAAM,SAAS,IAAI;aAAG;YACnC,YAAY;QACb;IACD;IAEA,MAAM,kBAAkB,CAAC;QACxB,SAAS,KAAK,MAAM,CAAC,CAAC,GAAG,IAAM,MAAM;IACtC;IAEA,qBACC,6VAAC;QAAI,WAAU;;YACb,KAAK,MAAM,GAAG,mBACd,6VAAC;gBAAI,WAAU;0BACb,KAAK,GAAG,CAAC,CAAC,KAAK,sBACf,6VAAC;wBAAiB,WAAU;;4BAAmF;4BAC5G;0CACF,6VAAC;gCAAO,MAAK;gCAAS,SAAS,IAAM,gBAAgB;gCAAQ,WAAU;0CAAiB;;;;;;;uBAF9E;;;;;;;;;;0BASd,6VAAC;gBACA,MAAK;gBACL,aAAY;gBACZ,WAAU;gBACV,OAAO;gBACP,UAAU,CAAA,IAAK,YAAY,EAAE,MAAM,CAAC,KAAK;gBACzC,WAAW,CAAA;oBACV,IAAI,EAAE,GAAG,KAAK,SAAS;wBACtB,EAAE,cAAc;wBAChB;oBACD;gBACD;;;;;;;;;;;;AAIJ","debugId":null}},
    {"offset": {"line": 789, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/components/sections/meta-section.tsx"],"sourcesContent":["import { motion } from 'motion/react'\r\nimport { useWriteStore } from '../../stores/write-store'\r\nimport { TagInput } from '../ui/tag-input'\r\n\r\ntype MetaSectionProps = {\r\n\tdelay?: number\r\n}\r\n\r\nexport function MetaSection({ delay = 0 }: MetaSectionProps) {\r\n\tconst { form, updateForm } = useWriteStore()\r\n\treturn (\r\n\t\t<motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay }} className='card relative'>\r\n\t\t\t<h2 className='text-sm'>元信息</h2>\r\n\r\n\t\t\t<div className='mt-3 space-y-2'>\r\n\t\t\t\t<textarea\r\n\t\t\t\t\tplaceholder='为这篇文章写一段简短摘要'\r\n\t\t\t\t\trows={2}\r\n\t\t\t\t\tclassName='block w-full resize-none rounded-xl border bg-white/60 p-3 text-sm'\r\n\t\t\t\t\tvalue={form.summary}\r\n\t\t\t\t\tonChange={e => updateForm({ summary: e.target.value })}\r\n\t\t\t\t/>\r\n\r\n\t\t\t\t<TagInput tags={form.tags} onChange={tags => updateForm({ tags })} />\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype='date'\r\n\t\t\t\t\tplaceholder='日期'\r\n\t\t\t\t\tclassName='w-full rounded-lg border bg-white/60 px-3 py-2 text-sm'\r\n\t\t\t\t\tvalue={form.date}\r\n\t\t\t\t\tonChange={e => updateForm({ date: e.target.value })}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t</motion.div>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;AAMO,SAAS,YAAY,EAAE,QAAQ,CAAC,EAAoB;IAC1D,MAAM,EAAE,IAAI,EAAE,UAAU,EAAE,GAAG,IAAA,gKAAa;IAC1C,qBACC,6VAAC,0SAAM,CAAC,GAAG;QAAC,SAAS;YAAE,SAAS;YAAG,OAAO;QAAI;QAAG,SAAS;YAAE,SAAS;YAAG,OAAO;QAAE;QAAG,YAAY;YAAE;QAAM;QAAG,WAAU;;0BACpH,6VAAC;gBAAG,WAAU;0BAAU;;;;;;0BAExB,6VAAC;gBAAI,WAAU;;kCACd,6VAAC;wBACA,aAAY;wBACZ,MAAM;wBACN,WAAU;wBACV,OAAO,KAAK,OAAO;wBACnB,UAAU,CAAA,IAAK,WAAW;gCAAE,SAAS,EAAE,MAAM,CAAC,KAAK;4BAAC;;;;;;kCAGrD,6VAAC,oKAAQ;wBAAC,MAAM,KAAK,IAAI;wBAAE,UAAU,CAAA,OAAQ,WAAW;gCAAE;4BAAK;;;;;;kCAC/D,6VAAC;wBACA,MAAK;wBACL,aAAY;wBACZ,WAAU;wBACV,OAAO,KAAK,IAAI;wBAChB,UAAU,CAAA,IAAK,WAAW;gCAAE,MAAM,EAAE,MAAM,CAAC,KAAK;4BAAC;;;;;;;;;;;;;;;;;;AAKtD","debugId":null}},
    {"offset": {"line": 881, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/components/sections/images-section.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useMemo, useRef, useState } from 'react'\r\nimport { motion } from 'motion/react'\r\nimport { useWriteStore } from '../../stores/write-store'\r\nimport Link from 'next/link'\r\n\r\ntype ImagesSectionProps = {\r\n\tdelay?: number\r\n}\r\n\r\nexport function ImagesSection({ delay = 0 }: ImagesSectionProps) {\r\n\tconst { images, cover, addUrlImage, addFiles, deleteImage } = useWriteStore()\r\n\tconst [urlInput, setUrlInput] = useState<string>('')\r\n\tconst fileInputRef = useRef<HTMLInputElement>(null)\r\n\r\n\tconst coverId = cover?.id ?? null\r\n\r\n\treturn (\r\n\t\t<motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay }} className='card relative'>\r\n\t\t\t<div className='flex items-center justify-between'>\r\n\t\t\t\t<h2 className='text-sm'>图片管理</h2>\r\n\t\t\t\t<Link href='/image-toolbox' target='_blank' className='text-xs hover:underline'>\r\n\t\t\t\t\t压缩工具\r\n\t\t\t\t</Link>\r\n\t\t\t</div>\r\n\r\n\t\t\t<div className='mt-3 flex items-center gap-2'>\r\n\t\t\t\t<input\r\n\t\t\t\t\ttype='text'\r\n\t\t\t\t\tplaceholder='https://...'\r\n\t\t\t\t\tclassName='flex-1 rounded-lg border bg-white/70 px-3 py-2 text-sm'\r\n\t\t\t\t\tvalue={urlInput}\r\n\t\t\t\t\tonChange={e => setUrlInput(e.target.value)}\r\n\t\t\t\t/>\r\n\t\t\t\t<button\r\n\t\t\t\t\tclassName='rounded-lg border bg-white/70 px-3 py-2 text-sm'\r\n\t\t\t\t\tonClick={() => {\r\n\t\t\t\t\t\tconst v = urlInput.trim()\r\n\t\t\t\t\t\tif (!v) return\r\n\t\t\t\t\t\taddUrlImage(v)\r\n\t\t\t\t\t\tsetUrlInput('')\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t添加\r\n\t\t\t\t</button>\r\n\t\t\t</div>\r\n\r\n\t\t\t<input\r\n\t\t\t\tref={fileInputRef}\r\n\t\t\t\ttype='file'\r\n\t\t\t\taccept='image/*'\r\n\t\t\t\tmultiple\r\n\t\t\t\tclassName='hidden'\r\n\t\t\t\tonChange={e => {\r\n\t\t\t\t\tconst files = e.target.files\r\n\t\t\t\t\tif (files && files.length > 0) {\r\n\t\t\t\t\t\taddFiles(files)\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (e.currentTarget) e.currentTarget.value = ''\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\r\n\t\t\t<div className='mt-3 grid grid-cols-4 gap-2'>\r\n\t\t\t\t{/* plus tile */}\r\n\t\t\t\t<div\r\n\t\t\t\t\tclassName='group relative grid aspect-square cursor-pointer place-items-center rounded-lg border bg-white/50 hover:bg-white/70'\r\n\t\t\t\t\tonClick={() => fileInputRef.current?.click()}\r\n\t\t\t\t\tonDragOver={e => {\r\n\t\t\t\t\t\te.preventDefault()\r\n\t\t\t\t\t}}\r\n\t\t\t\t\tonDrop={e => {\r\n\t\t\t\t\t\te.preventDefault()\r\n\t\t\t\t\t\tconst files = e.dataTransfer.files\r\n\t\t\t\t\t\tif (files && files.length) addFiles(files)\r\n\t\t\t\t\t}}>\r\n\t\t\t\t\t<span className='text-2xl leading-none text-neutral-400'>+</span>\r\n\t\t\t\t</div>\r\n\r\n\t\t\t\t{images.map(item => {\r\n\t\t\t\t\tconst isUrl = item.type === 'url'\r\n\t\t\t\t\tconst src = isUrl ? item.url : item.previewUrl\r\n\t\t\t\t\tconst markdown = isUrl ? `![](${item.url})` : `![](local-image:${item.id})`\r\n\t\t\t\t\tconst isCover = coverId === item.id\r\n\r\n\t\t\t\t\treturn (\r\n\t\t\t\t\t\t<div\r\n\t\t\t\t\t\t\tkey={item.id}\r\n\t\t\t\t\t\t\tclassName={`group relative aspect-square overflow-hidden rounded-lg border bg-white/50 text-xs ${isCover ? 'ring-2 ring-blue-500' : ''}`}>\r\n\t\t\t\t\t\t\t<img\r\n\t\t\t\t\t\t\t\tsrc={src}\r\n\t\t\t\t\t\t\t\tclassName='h-full w-full object-cover'\r\n\t\t\t\t\t\t\t\tdraggable\r\n\t\t\t\t\t\t\t\tonDragStart={e => {\r\n\t\t\t\t\t\t\t\t\te.dataTransfer.setData('text/plain', markdown)\r\n\t\t\t\t\t\t\t\t\te.dataTransfer.setData('text/markdown', markdown)\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t{isCover && <div className='absolute top-1 left-1 rounded-md bg-blue-500 px-1.5 py-0.5 text-white shadow'>封面</div>}\r\n\t\t\t\t\t\t\t<div className='absolute top-1 right-1 hidden group-hover:flex'>\r\n\t\t\t\t\t\t\t\t<button type='button' className='rounded-md bg-white/80 px-1.5 py-0.5 shadow hover:bg-white' onClick={() => deleteImage(item.id)}>\r\n\t\t\t\t\t\t\t\t\t删除\r\n\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)\r\n\t\t\t\t})}\r\n\t\t\t</div>\r\n\t\t</motion.div>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAWO,SAAS,cAAc,EAAE,QAAQ,CAAC,EAAsB;IAC9D,MAAM,EAAE,MAAM,EAAE,KAAK,EAAE,WAAW,EAAE,QAAQ,EAAE,WAAW,EAAE,GAAG,IAAA,gKAAa;IAC3E,MAAM,CAAC,UAAU,YAAY,GAAG,IAAA,gUAAQ,EAAS;IACjD,MAAM,eAAe,IAAA,8TAAM,EAAmB;IAE9C,MAAM,UAAU,OAAO,MAAM;IAE7B,qBACC,6VAAC,0SAAM,CAAC,GAAG;QAAC,SAAS;YAAE,SAAS;YAAG,OAAO;QAAI;QAAG,SAAS;YAAE,SAAS;YAAG,OAAO;QAAE;QAAG,YAAY;YAAE;QAAM;QAAG,WAAU;;0BACpH,6VAAC;gBAAI,WAAU;;kCACd,6VAAC;wBAAG,WAAU;kCAAU;;;;;;kCACxB,6VAAC,sRAAI;wBAAC,MAAK;wBAAiB,QAAO;wBAAS,WAAU;kCAA0B;;;;;;;;;;;;0BAKjF,6VAAC;gBAAI,WAAU;;kCACd,6VAAC;wBACA,MAAK;wBACL,aAAY;wBACZ,WAAU;wBACV,OAAO;wBACP,UAAU,CAAA,IAAK,YAAY,EAAE,MAAM,CAAC,KAAK;;;;;;kCAE1C,6VAAC;wBACA,WAAU;wBACV,SAAS;4BACR,MAAM,IAAI,SAAS,IAAI;4BACvB,IAAI,CAAC,GAAG;4BACR,YAAY;4BACZ,YAAY;wBACb;kCAAG;;;;;;;;;;;;0BAKL,6VAAC;gBACA,KAAK;gBACL,MAAK;gBACL,QAAO;gBACP,QAAQ;gBACR,WAAU;gBACV,UAAU,CAAA;oBACT,MAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;oBAC5B,IAAI,SAAS,MAAM,MAAM,GAAG,GAAG;wBAC9B,SAAS;oBACV;oBACA,IAAI,EAAE,aAAa,EAAE,EAAE,aAAa,CAAC,KAAK,GAAG;gBAC9C;;;;;;0BAGD,6VAAC;gBAAI,WAAU;;kCAEd,6VAAC;wBACA,WAAU;wBACV,SAAS,IAAM,aAAa,OAAO,EAAE;wBACrC,YAAY,CAAA;4BACX,EAAE,cAAc;wBACjB;wBACA,QAAQ,CAAA;4BACP,EAAE,cAAc;4BAChB,MAAM,QAAQ,EAAE,YAAY,CAAC,KAAK;4BAClC,IAAI,SAAS,MAAM,MAAM,EAAE,SAAS;wBACrC;kCACA,cAAA,6VAAC;4BAAK,WAAU;sCAAyC;;;;;;;;;;;oBAGzD,OAAO,GAAG,CAAC,CAAA;wBACX,MAAM,QAAQ,KAAK,IAAI,KAAK;wBAC5B,MAAM,MAAM,QAAQ,KAAK,GAAG,GAAG,KAAK,UAAU;wBAC9C,MAAM,WAAW,QAAQ,CAAC,IAAI,EAAE,KAAK,GAAG,CAAC,CAAC,CAAC,GAAG,CAAC,gBAAgB,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC;wBAC3E,MAAM,UAAU,YAAY,KAAK,EAAE;wBAEnC,qBACC,6VAAC;4BAEA,WAAW,CAAC,mFAAmF,EAAE,UAAU,yBAAyB,IAAI;;8CACxI,6VAAC;oCACA,KAAK;oCACL,WAAU;oCACV,SAAS;oCACT,aAAa,CAAA;wCACZ,EAAE,YAAY,CAAC,OAAO,CAAC,cAAc;wCACrC,EAAE,YAAY,CAAC,OAAO,CAAC,iBAAiB;oCACzC;;;;;;gCAEA,yBAAW,6VAAC;oCAAI,WAAU;8CAA+E;;;;;;8CAC1G,6VAAC;oCAAI,WAAU;8CACd,cAAA,6VAAC;wCAAO,MAAK;wCAAS,WAAU;wCAA6D,SAAS,IAAM,YAAY,KAAK,EAAE;kDAAG;;;;;;;;;;;;2BAb9H,KAAK,EAAE;;;;;oBAmBf;;;;;;;;;;;;;AAIJ","debugId":null}},
    {"offset": {"line": 1091, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/components/sidebar.tsx"],"sourcesContent":["import { CoverSection } from './sections/cover-section'\r\nimport { MetaSection } from './sections/meta-section'\r\nimport { ImagesSection } from './sections/images-section'\r\nimport { ANIMATION_DELAY, INIT_DELAY } from '@/consts'\r\n\r\nexport function WriteSidebar() {\r\n\treturn (\r\n\t\t<div className='w-[320px] space-y-6'>\r\n\t\t\t<CoverSection delay={INIT_DELAY + ANIMATION_DELAY * 0} />\r\n\t\t\t<MetaSection delay={INIT_DELAY + ANIMATION_DELAY * 1} />\r\n\t\t\t<ImagesSection delay={INIT_DELAY + ANIMATION_DELAY * 2} />\r\n\t\t</div>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;;;;;;AAEO,SAAS;IACf,qBACC,6VAAC;QAAI,WAAU;;0BACd,6VAAC,kLAAY;gBAAC,OAAO,2HAAU,GAAG,gIAAe,GAAG;;;;;;0BACpD,6VAAC,gLAAW;gBAAC,OAAO,2HAAU,GAAG,gIAAe,GAAG;;;;;;0BACnD,6VAAC,oLAAa;gBAAC,OAAO,2HAAU,GAAG,gIAAe,GAAG;;;;;;;;;;;;AAGxD","debugId":null}},
    {"offset": {"line": 1141, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/lib/auth.ts"],"sourcesContent":["import { createInstallationToken, getInstallationId, signAppJwt } from './github-client'\r\nimport { GITHUB_CONFIG } from '@/consts'\r\nimport { useAuthStore } from '@/hooks/use-auth'\r\nimport { toast } from 'sonner'\r\n\r\nconst GITHUB_TOKEN_CACHE_KEY = 'github_token'\r\n\r\nfunction getTokenFromCache(): string | null {\r\n\tif (typeof sessionStorage === 'undefined') return null\r\n\ttry {\r\n\t\treturn sessionStorage.getItem(GITHUB_TOKEN_CACHE_KEY)\r\n\t} catch {\r\n\t\treturn null\r\n\t}\r\n}\r\n\r\nfunction saveTokenToCache(token: string): void {\r\n\tif (typeof sessionStorage === 'undefined') return\r\n\ttry {\r\n\t\tsessionStorage.setItem(GITHUB_TOKEN_CACHE_KEY, token)\r\n\t} catch (error) {\r\n\t\tconsole.error('Failed to save token to cache:', error)\r\n\t}\r\n}\r\n\r\nfunction clearTokenCache(): void {\r\n\tif (typeof sessionStorage === 'undefined') return\r\n\ttry {\r\n\t\tsessionStorage.removeItem(GITHUB_TOKEN_CACHE_KEY)\r\n\t} catch (error) {\r\n\t\tconsole.error('Failed to clear token cache:', error)\r\n\t}\r\n}\r\n\r\nexport function clearAllAuthCache(): void {\r\n\tclearTokenCache()\r\n}\r\n\r\nexport function hasAuth(): boolean {\r\n\treturn !!getTokenFromCache()\r\n}\r\n\r\n/**\r\n * 统一的认证 Token 获取\r\n * 自动处理缓存、签发等逻辑\r\n * @returns GitHub Installation Token\r\n */\r\nexport async function getAuthToken(): Promise<string> {\r\n\t// 1. 先尝试从缓存获取 token\r\n\tconst cachedToken = getTokenFromCache()\r\n\tif (cachedToken) {\r\n\t\ttoast.info('使用缓存的令牌...')\r\n\t\treturn cachedToken\r\n\t}\r\n\r\n\t// 2. 获取私钥（从缓存）\r\n\tconst privateKey = useAuthStore.getState().privateKey\r\n\tif (!privateKey) {\r\n\t\tthrow new Error('需要先设置私钥。请使用 useAuth().setPrivateKey()')\r\n\t}\r\n\r\n\ttoast.info('正在签发 JWT...')\r\n\tconst jwt = signAppJwt(GITHUB_CONFIG.APP_ID, privateKey)\r\n\r\n\ttoast.info('正在获取安装信息...')\r\n\tconst installationId = await getInstallationId(jwt, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO)\r\n\r\n\ttoast.info('正在创建安装令牌...')\r\n\tconst token = await createInstallationToken(jwt, installationId)\r\n\r\n\tsaveTokenToCache(token)\r\n\r\n\treturn token\r\n}\r\n"],"names":[],"mappings":";;;;;;;;AAAA;AACA;AACA;AACA;;;;;AAEA,MAAM,yBAAyB;AAE/B,SAAS;IACR,IAAI,OAAO,mBAAmB,aAAa,OAAO;IAClD,IAAI;QACH,OAAO,eAAe,OAAO,CAAC;IAC/B,EAAE,OAAM;QACP,OAAO;IACR;AACD;AAEA,SAAS,iBAAiB,KAAa;IACtC,IAAI,OAAO,mBAAmB,aAAa;IAC3C,IAAI;QACH,eAAe,OAAO,CAAC,wBAAwB;IAChD,EAAE,OAAO,OAAO;QACf,QAAQ,KAAK,CAAC,kCAAkC;IACjD;AACD;AAEA,SAAS;IACR,IAAI,OAAO,mBAAmB,aAAa;IAC3C,IAAI;QACH,eAAe,UAAU,CAAC;IAC3B,EAAE,OAAO,OAAO;QACf,QAAQ,KAAK,CAAC,gCAAgC;IAC/C;AACD;AAEO,SAAS;IACf;AACD;AAEO,SAAS;IACf,OAAO,CAAC,CAAC;AACV;AAOO,eAAe;IACrB,oBAAoB;IACpB,MAAM,cAAc;IACpB,IAAI,aAAa;QAChB,iRAAK,CAAC,IAAI,CAAC;QACX,OAAO;IACR;IAEA,eAAe;IACf,MAAM,aAAa,2IAAY,CAAC,QAAQ,GAAG,UAAU;IACrD,IAAI,CAAC,YAAY;QAChB,MAAM,IAAI,MAAM;IACjB;IAEA,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,MAAM,IAAA,4IAAU,EAAC,8HAAa,CAAC,MAAM,EAAE;IAE7C,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,iBAAiB,MAAM,IAAA,mJAAiB,EAAC,KAAK,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI;IAE3F,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,QAAQ,MAAM,IAAA,yJAAuB,EAAC,KAAK;IAEjD,iBAAiB;IAEjB,OAAO;AACR","debugId":null}},
    {"offset": {"line": 1213, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/hooks/use-auth.ts"],"sourcesContent":["import { create } from 'zustand'\r\nimport { clearAllAuthCache, getAuthToken as getToken, hasAuth as checkAuth } from '@/lib/auth'\r\n\r\ninterface AuthStore {\r\n\t// State\r\n\tisAuth: boolean\r\n\tprivateKey: string | null\r\n\r\n\t// Actions\r\n\tsetPrivateKey: (key: string) => void\r\n\tclearAuth: () => void\r\n\trefreshAuthState: () => void\r\n\tgetAuthToken: () => Promise<string>\r\n}\r\n\r\nexport const useAuthStore = create<AuthStore>((set, get) => ({\r\n\tisAuth: checkAuth(),\r\n\tprivateKey: null,\r\n\r\n\tsetPrivateKey: (key: string) => {\r\n\t\tset({ isAuth: true, privateKey: key })\r\n\t},\r\n\r\n\tclearAuth: () => {\r\n\t\tclearAllAuthCache()\r\n\t\tset({ isAuth: false })\r\n\t},\r\n\r\n\trefreshAuthState: () => {\r\n\t\tset({ isAuth: checkAuth() })\r\n\t},\r\n\r\n\tgetAuthToken: async () => {\r\n\t\tconst token = await getToken()\r\n\t\tget().refreshAuthState()\r\n\t\treturn token\r\n\t}\r\n}))\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAcO,MAAM,eAAe,IAAA,8PAAM,EAAY,CAAC,KAAK,MAAQ,CAAC;QAC5D,QAAQ,IAAA,6HAAS;QACjB,YAAY;QAEZ,eAAe,CAAC;YACf,IAAI;gBAAE,QAAQ;gBAAM,YAAY;YAAI;QACrC;QAEA,WAAW;YACV,IAAA,uIAAiB;YACjB,IAAI;gBAAE,QAAQ;YAAM;QACrB;QAEA,kBAAkB;YACjB,IAAI;gBAAE,QAAQ,IAAA,6HAAS;YAAG;QAC3B;QAEA,cAAc;YACb,MAAM,QAAQ,MAAM,IAAA,kIAAQ;YAC5B,MAAM,gBAAgB;YACtB,OAAO;QACR;IACD,CAAC","debugId":null}},
    {"offset": {"line": 1251, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/lib/github-client.ts"],"sourcesContent":["'use client'\r\n\r\nimport { useAuthStore } from '@/hooks/use-auth'\r\nimport { KJUR, KEYUTIL } from 'jsrsasign'\r\n\r\nexport const GH_API = 'https://api.github.com'\r\n\r\nfunction handle401Error(): void {\r\n\tif (typeof sessionStorage === 'undefined') return\r\n\ttry {\r\n\t\tuseAuthStore.getState().clearAuth()\r\n\t} catch (error) {\r\n\t\tconsole.error('Failed to clear auth cache:', error)\r\n\t}\r\n}\r\n\r\nexport function toBase64Utf8(input: string): string {\r\n\treturn btoa(unescape(encodeURIComponent(input)))\r\n}\r\n\r\nexport function signAppJwt(appId: string, privateKeyPem: string): string {\r\n\tconst now = Math.floor(Date.now() / 1000)\r\n\tconst header = { alg: 'RS256', typ: 'JWT' }\r\n\tconst payload = { iat: now - 60, exp: now + 8 * 60, iss: appId }\r\n\tconst prv = KEYUTIL.getKey(privateKeyPem) as unknown as string\r\n\treturn KJUR.jws.JWS.sign('RS256', JSON.stringify(header), JSON.stringify(payload), prv)\r\n}\r\n\r\nexport async function getInstallationId(jwt: string, owner: string, repo: string): Promise<number> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/installation`, {\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${jwt}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`installation lookup failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn data.id\r\n}\r\n\r\nexport async function createInstallationToken(jwt: string, installationId: number): Promise<string> {\r\n\tconst res = await fetch(`${GH_API}/app/installations/${installationId}/access_tokens`, {\r\n\t\tmethod: 'POST',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${jwt}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`create token failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn data.token as string\r\n}\r\n\r\nexport async function getFileSha(token: string, owner: string, repo: string, path: string, branch: string): Promise<string | undefined> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(branch)}`, {\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (res.status === 404) return undefined\r\n\tif (!res.ok) throw new Error(`get file sha failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn (data && data.sha) || undefined\r\n}\r\n\r\nexport async function putFile(token: string, owner: string, repo: string, path: string, contentBase64: string, message: string, branch: string) {\r\n\tconst sha = await getFileSha(token, owner, repo, path, branch)\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}`, {\r\n\t\tmethod: 'PUT',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ message, content: contentBase64, branch, ...(sha ? { sha } : {}) })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`put file failed: ${res.status}`)\r\n\treturn res.json()\r\n}\r\n\r\n// Batch commit APIs\r\n\r\nexport async function getRef(token: string, owner: string, repo: string, ref: string): Promise<{ sha: string }> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/ref/${encodeURIComponent(ref)}`, {\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`get ref failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn { sha: data.object.sha }\r\n}\r\n\r\nexport type TreeItem = {\r\n\tpath: string\r\n\tmode: '100644' | '100755' | '040000' | '160000' | '120000'\r\n\ttype: 'blob' | 'tree' | 'commit'\r\n\tcontent?: string\r\n\tsha?: string | null\r\n}\r\n\r\nexport async function createTree(token: string, owner: string, repo: string, tree: TreeItem[], baseTree?: string): Promise<{ sha: string }> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/trees`, {\r\n\t\tmethod: 'POST',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ tree, base_tree: baseTree })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`create tree failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn { sha: data.sha }\r\n}\r\n\r\nexport async function createCommit(token: string, owner: string, repo: string, message: string, tree: string, parents: string[]): Promise<{ sha: string }> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/commits`, {\r\n\t\tmethod: 'POST',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ message, tree, parents })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`create commit failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn { sha: data.sha }\r\n}\r\n\r\nexport async function updateRef(token: string, owner: string, repo: string, ref: string, sha: string, force = false): Promise<void> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/refs/${encodeURIComponent(ref)}`, {\r\n\t\tmethod: 'PATCH',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ sha, force })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`update ref failed: ${res.status}`)\r\n}\r\n\r\nexport async function readTextFileFromRepo(token: string, owner: string, repo: string, path: string, ref: string): Promise<string | null> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/contents/${encodeURIComponent(path)}?ref=${encodeURIComponent(ref)}`, {\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t}\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (res.status === 404) return null\r\n\tif (!res.ok) throw new Error(`read file failed: ${res.status}`)\r\n\tconst data: any = await res.json()\r\n\tif (Array.isArray(data) || !data.content) return null\r\n\ttry {\r\n\t\treturn decodeURIComponent(escape(atob(data.content)))\r\n\t} catch {\r\n\t\treturn atob(data.content)\r\n\t}\r\n}\r\n\r\nexport async function listRepoFilesRecursive(token: string, owner: string, repo: string, path: string, ref: string): Promise<string[]> {\r\n\tasync function fetchPath(targetPath: string): Promise<string[]> {\r\n\t\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/contents/${encodeURIComponent(targetPath)}?ref=${encodeURIComponent(ref)}`, {\r\n\t\t\theaders: {\r\n\t\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t\t'X-GitHub-Api-Version': '2022-11-28'\r\n\t\t\t}\r\n\t\t})\r\n\t\tif (res.status === 401) handle401Error()\r\n\t\tif (res.status === 404) return []\r\n\t\tif (!res.ok) throw new Error(`read directory failed: ${res.status}`)\r\n\t\tconst data: any = await res.json()\r\n\t\tif (Array.isArray(data)) {\r\n\t\t\tconst files: string[] = []\r\n\t\t\tfor (const item of data) {\r\n\t\t\t\tif (item.type === 'file') {\r\n\t\t\t\t\tfiles.push(item.path)\r\n\t\t\t\t} else if (item.type === 'dir') {\r\n\t\t\t\t\tconst nested = await fetchPath(item.path)\r\n\t\t\t\t\tfiles.push(...nested)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn files\r\n\t\t}\r\n\t\tif (data?.type === 'file') return [data.path]\r\n\t\tif (data?.type === 'dir') return fetchPath(data.path)\r\n\t\treturn []\r\n\t}\r\n\r\n\treturn fetchPath(path)\r\n}\r\n\r\nexport async function createBlob(\r\n\ttoken: string,\r\n\towner: string,\r\n\trepo: string,\r\n\tcontent: string,\r\n\tencoding: 'utf-8' | 'base64' = 'base64'\r\n): Promise<{ sha: string }> {\r\n\tconst res = await fetch(`${GH_API}/repos/${owner}/${repo}/git/blobs`, {\r\n\t\tmethod: 'POST',\r\n\t\theaders: {\r\n\t\t\tAuthorization: `Bearer ${token}`,\r\n\t\t\tAccept: 'application/vnd.github+json',\r\n\t\t\t'X-GitHub-Api-Version': '2022-11-28',\r\n\t\t\t'Content-Type': 'application/json'\r\n\t\t},\r\n\t\tbody: JSON.stringify({ content, encoding })\r\n\t})\r\n\tif (res.status === 401) handle401Error()\r\n\tif (!res.ok) throw new Error(`create blob failed: ${res.status}`)\r\n\tconst data = await res.json()\r\n\treturn { sha: data.sha }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1528, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/lib/blog-index.ts"],"sourcesContent":["'use client'\r\n\r\nimport { putFile, toBase64Utf8, readTextFileFromRepo } from '@/lib/github-client'\r\n\r\nexport type BlogIndexItem = {\r\n\tslug: string\r\n\ttitle: string\r\n\ttags: string[]\r\n\tdate: string\r\n\tsummary?: string\r\n\tcover?: string\r\n}\r\n\r\nexport async function upsertBlogsIndex(token: string, owner: string, repo: string, item: BlogIndexItem, branch: string): Promise<void> {\r\n\tconst indexPath = 'public/blogs/index.json'\r\n\tlet list: BlogIndexItem[] = []\r\n\ttry {\r\n\t\tconst txt = await readTextFileFromRepo(token, owner, repo, indexPath, branch)\r\n\t\tif (txt) list = JSON.parse(txt)\r\n\t} catch {\r\n\t\t// ignore parse errors and start from empty list\r\n\t}\r\n\tconst map = new Map<string, BlogIndexItem>(list.map(i => [i.slug, i]))\r\n\tmap.set(item.slug, item)\r\n\tconst next = Array.from(map.values()).sort((a, b) => (b.date || '').localeCompare(a.date || ''))\r\n\tconst base64 = toBase64Utf8(JSON.stringify(next, null, 2))\r\n\tawait putFile(token, owner, repo, indexPath, base64, 'Update blogs index', branch)\r\n}\r\n\r\nexport async function prepareBlogsIndex(token: string, owner: string, repo: string, item: BlogIndexItem, branch: string): Promise<string> {\r\n\tconst indexPath = 'public/blogs/index.json'\r\n\tlet list: BlogIndexItem[] = []\r\n\ttry {\r\n\t\tconst txt = await readTextFileFromRepo(token, owner, repo, indexPath, branch)\r\n\t\tif (txt) list = JSON.parse(txt)\r\n\t} catch {\r\n\t\t// ignore parse errors and start from empty list\r\n\t}\r\n\tconst map = new Map<string, BlogIndexItem>(list.map(i => [i.slug, i]))\r\n\tmap.set(item.slug, item)\r\n\tconst next = Array.from(map.values()).sort((a, b) => (b.date || '').localeCompare(a.date || ''))\r\n\treturn JSON.stringify(next, null, 2)\r\n}\r\n\r\nexport async function removeBlogsFromIndex(token: string, owner: string, repo: string, slugs: string[], branch: string): Promise<string> {\r\n\tconst indexPath = 'public/blogs/index.json'\r\n\tlet list: BlogIndexItem[] = []\r\n\ttry {\r\n\t\tconst txt = await readTextFileFromRepo(token, owner, repo, indexPath, branch)\r\n\t\tif (txt) list = JSON.parse(txt)\r\n\t} catch {\r\n\t\t// ignore parse errors and keep empty list\r\n\t}\r\n\tconst slugSet = new Set(slugs.filter(Boolean))\r\n\tif (slugSet.size === 0) {\r\n\t\treturn JSON.stringify(list, null, 2)\r\n\t}\r\n\tconst next = list.filter(item => !slugSet.has(item.slug))\r\n\treturn JSON.stringify(next, null, 2)\r\n}\r\n\r\nexport async function removeBlogFromIndex(token: string, owner: string, repo: string, slug: string, branch: string): Promise<string> {\r\n\treturn removeBlogsFromIndex(token, owner, repo, [slug], branch)\r\n}"],"names":[],"mappings":";;;;;;;;;;AAEA;AAFA;;AAaO,eAAe,iBAAiB,KAAa,EAAE,KAAa,EAAE,IAAY,EAAE,IAAmB,EAAE,MAAc;IACrH,MAAM,YAAY;IAClB,IAAI,OAAwB,EAAE;IAC9B,IAAI;QACH,MAAM,MAAM,MAAM,IAAA,sJAAoB,EAAC,OAAO,OAAO,MAAM,WAAW;QACtE,IAAI,KAAK,OAAO,KAAK,KAAK,CAAC;IAC5B,EAAE,OAAM;IACP,gDAAgD;IACjD;IACA,MAAM,MAAM,IAAI,IAA2B,KAAK,GAAG,CAAC,CAAA,IAAK;YAAC,EAAE,IAAI;YAAE;SAAE;IACpE,IAAI,GAAG,CAAC,KAAK,IAAI,EAAE;IACnB,MAAM,OAAO,MAAM,IAAI,CAAC,IAAI,MAAM,IAAI,IAAI,CAAC,CAAC,GAAG,IAAM,CAAC,EAAE,IAAI,IAAI,EAAE,EAAE,aAAa,CAAC,EAAE,IAAI,IAAI;IAC5F,MAAM,SAAS,IAAA,8IAAY,EAAC,KAAK,SAAS,CAAC,MAAM,MAAM;IACvD,MAAM,IAAA,yIAAO,EAAC,OAAO,OAAO,MAAM,WAAW,QAAQ,sBAAsB;AAC5E;AAEO,eAAe,kBAAkB,KAAa,EAAE,KAAa,EAAE,IAAY,EAAE,IAAmB,EAAE,MAAc;IACtH,MAAM,YAAY;IAClB,IAAI,OAAwB,EAAE;IAC9B,IAAI;QACH,MAAM,MAAM,MAAM,IAAA,sJAAoB,EAAC,OAAO,OAAO,MAAM,WAAW;QACtE,IAAI,KAAK,OAAO,KAAK,KAAK,CAAC;IAC5B,EAAE,OAAM;IACP,gDAAgD;IACjD;IACA,MAAM,MAAM,IAAI,IAA2B,KAAK,GAAG,CAAC,CAAA,IAAK;YAAC,EAAE,IAAI;YAAE;SAAE;IACpE,IAAI,GAAG,CAAC,KAAK,IAAI,EAAE;IACnB,MAAM,OAAO,MAAM,IAAI,CAAC,IAAI,MAAM,IAAI,IAAI,CAAC,CAAC,GAAG,IAAM,CAAC,EAAE,IAAI,IAAI,EAAE,EAAE,aAAa,CAAC,EAAE,IAAI,IAAI;IAC5F,OAAO,KAAK,SAAS,CAAC,MAAM,MAAM;AACnC;AAEO,eAAe,qBAAqB,KAAa,EAAE,KAAa,EAAE,IAAY,EAAE,KAAe,EAAE,MAAc;IACrH,MAAM,YAAY;IAClB,IAAI,OAAwB,EAAE;IAC9B,IAAI;QACH,MAAM,MAAM,MAAM,IAAA,sJAAoB,EAAC,OAAO,OAAO,MAAM,WAAW;QACtE,IAAI,KAAK,OAAO,KAAK,KAAK,CAAC;IAC5B,EAAE,OAAM;IACP,0CAA0C;IAC3C;IACA,MAAM,UAAU,IAAI,IAAI,MAAM,MAAM,CAAC;IACrC,IAAI,QAAQ,IAAI,KAAK,GAAG;QACvB,OAAO,KAAK,SAAS,CAAC,MAAM,MAAM;IACnC;IACA,MAAM,OAAO,KAAK,MAAM,CAAC,CAAA,OAAQ,CAAC,QAAQ,GAAG,CAAC,KAAK,IAAI;IACvD,OAAO,KAAK,SAAS,CAAC,MAAM,MAAM;AACnC;AAEO,eAAe,oBAAoB,KAAa,EAAE,KAAa,EAAE,IAAY,EAAE,IAAY,EAAE,MAAc;IACjH,OAAO,qBAAqB,OAAO,OAAO,MAAM;QAAC;KAAK,EAAE;AACzD","debugId":null}},
    {"offset": {"line": 1601, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/services/push-blog.ts"],"sourcesContent":["import { toBase64Utf8, getRef, createTree, createCommit, updateRef, createBlob, type TreeItem } from '@/lib/github-client'\r\nimport { fileToBase64NoPrefix, hashFileSHA256 } from '@/lib/file-utils'\r\nimport { prepareBlogsIndex } from '@/lib/blog-index'\r\nimport { getAuthToken } from '@/lib/auth'\r\nimport { GITHUB_CONFIG } from '@/consts'\r\nimport type { ImageItem } from '../types'\r\nimport { getFileExt } from '@/lib/utils'\r\nimport { toast } from 'sonner'\r\n\r\nexport type PushBlogParams = {\r\n\tform: {\r\n\t\tslug: string\r\n\t\ttitle: string\r\n\t\tmd: string\r\n\t\ttags: string[]\r\n\t\tdate?: string\r\n\t\tsummary?: string\r\n\t}\r\n\tcover?: ImageItem | null\r\n\timages?: ImageItem[]\r\n\tmode?: 'create' | 'edit'\r\n\toriginalSlug?: string | null\r\n}\r\n\r\nexport async function pushBlog(params: PushBlogParams): Promise<void> {\r\n\tconst { form, cover, images, mode = 'create', originalSlug } = params\r\n\r\n\tif (!form?.slug) throw new Error('需要 slug')\r\n\r\n\tif (mode === 'edit' && originalSlug && originalSlug !== form.slug) {\r\n\t\tthrow new Error('编辑模式下不支持修改 slug，请保持原 slug 不变')\r\n\t}\r\n\r\n\t// 获取认证 token（自动从全局认证状态获取）\r\n\tconst token = await getAuthToken()\r\n\r\n\ttoast.info('正在获取分支信息...')\r\n\tconst refData = await getRef(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, `heads/${GITHUB_CONFIG.BRANCH}`)\r\n\tconst latestCommitSha = refData.sha\r\n\r\n\tconst basePath = `public/blogs/${form.slug}`\r\n\tconst commitMessage = mode === 'edit' ? `更新文章: ${form.slug}` : `新增文章: ${form.slug}`\r\n\r\n\t// collect all local images (content + cover)\r\n\tconst allLocalImages: Array<{ img: Extract<ImageItem, { type: 'file' }>; id: string }> = []\r\n\r\n\t// add content images\r\n\tfor (const img of images || []) {\r\n\t\tif (img.type === 'file') {\r\n\t\t\tallLocalImages.push({ img, id: img.id })\r\n\t\t}\r\n\t}\r\n\r\n\t// add cover if local\r\n\tif (cover?.type === 'file') {\r\n\t\tallLocalImages.push({ img: cover, id: cover.id })\r\n\t}\r\n\r\n\ttoast.info('正在准备文件...')\r\n\r\n\tconst uploadedHashes = new Set<string>()\r\n\tlet mdToUpload = form.md\r\n\tlet coverPath: string | undefined\r\n\r\n\t// prepare tree items for all files\r\n\tconst treeItems: TreeItem[] = []\r\n\r\n\t// process all images\r\n\tif (allLocalImages.length > 0) {\r\n\t\ttoast.info('正在上传图片...')\r\n\t\tfor (const { img, id } of allLocalImages) {\r\n\t\t\tconst hash = img.hash || (await hashFileSHA256(img.file))\r\n\t\t\tconst ext = getFileExt(img.file.name)\r\n\t\t\tconst filename = `${hash}${ext}`\r\n\t\t\tconst publicPath = `/blogs/${form.slug}/${filename}`\r\n\r\n\t\t\tif (!uploadedHashes.has(hash)) {\r\n\t\t\t\tconst path = `${basePath}/${filename}`\r\n\t\t\t\tconst contentBase64 = await fileToBase64NoPrefix(img.file)\r\n\t\t\t\t// create blob for image\r\n\t\t\t\tconst blobData = await createBlob(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, contentBase64, 'base64')\r\n\t\t\t\ttreeItems.push({\r\n\t\t\t\t\tpath,\r\n\t\t\t\t\tmode: '100644',\r\n\t\t\t\t\ttype: 'blob',\r\n\t\t\t\t\tsha: blobData.sha\r\n\t\t\t\t})\r\n\t\t\t\tuploadedHashes.add(hash)\r\n\t\t\t}\r\n\r\n\t\t\t// replace placeholder in markdown\r\n\t\t\tconst placeholder = `local-image:${id}`\r\n\t\t\tmdToUpload = mdToUpload.split(`(${placeholder})`).join(`(${publicPath})`)\r\n\r\n\t\t\t// set cover path if this is the cover\r\n\t\t\tif (cover?.type === 'file' && cover.id === id) {\r\n\t\t\t\tcoverPath = publicPath\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// handle external cover URL\r\n\tif (cover?.type === 'url') {\r\n\t\tcoverPath = cover.url\r\n\t}\r\n\r\n\ttoast.info('正在创建文件...')\r\n\r\n\t// create blob for index.md\r\n\tconst mdBlob = await createBlob(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, toBase64Utf8(mdToUpload), 'base64')\r\n\ttreeItems.push({\r\n\t\tpath: `${basePath}/index.md`,\r\n\t\tmode: '100644',\r\n\t\ttype: 'blob',\r\n\t\tsha: mdBlob.sha\r\n\t})\r\n\r\n\t// create blob for config.json\r\n\tconst dateStr = form.date || new Date().toISOString().slice(0, 10)\r\n\tconst config = {\r\n\t\ttitle: form.title,\r\n\t\ttags: form.tags,\r\n\t\tdate: dateStr,\r\n\t\tsummary: form.summary,\r\n\t\tcover: coverPath\r\n\t}\r\n\tconst configBlob = await createBlob(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, toBase64Utf8(JSON.stringify(config, null, 2)), 'base64')\r\n\ttreeItems.push({\r\n\t\tpath: `${basePath}/config.json`,\r\n\t\tmode: '100644',\r\n\t\ttype: 'blob',\r\n\t\tsha: configBlob.sha\r\n\t})\r\n\r\n\t// prepare and create blob for blogs index\r\n\tconst indexJson = await prepareBlogsIndex(\r\n\t\ttoken,\r\n\t\tGITHUB_CONFIG.OWNER,\r\n\t\tGITHUB_CONFIG.REPO,\r\n\t\t{\r\n\t\t\tslug: form.slug,\r\n\t\t\ttitle: form.title,\r\n\t\t\ttags: form.tags,\r\n\t\t\tdate: dateStr,\r\n\t\t\tsummary: form.summary,\r\n\t\t\tcover: coverPath\r\n\t\t},\r\n\t\tGITHUB_CONFIG.BRANCH\r\n\t)\r\n\tconst indexBlob = await createBlob(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, toBase64Utf8(indexJson), 'base64')\r\n\ttreeItems.push({\r\n\t\tpath: 'public/blogs/index.json',\r\n\t\tmode: '100644',\r\n\t\ttype: 'blob',\r\n\t\tsha: indexBlob.sha\r\n\t})\r\n\r\n\t// create tree\r\n\ttoast.info('正在创建文件树...')\r\n\tconst treeData = await createTree(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, treeItems, latestCommitSha)\r\n\r\n\t// create commit\r\n\ttoast.info('正在创建提交...')\r\n\tconst commitData = await createCommit(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, commitMessage, treeData.sha, [latestCommitSha])\r\n\r\n\t// update branch reference\r\n\ttoast.info('正在更新分支...')\r\n\tawait updateRef(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, `heads/${GITHUB_CONFIG.BRANCH}`, commitData.sha)\r\n\r\n\ttoast.success('发布成功！')\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1748, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/services/delete-blog.ts"],"sourcesContent":["import { toast } from 'sonner'\r\nimport { getAuthToken } from '@/lib/auth'\r\nimport { GITHUB_CONFIG } from '@/consts'\r\nimport { createBlob, createCommit, createTree, getRef, listRepoFilesRecursive, toBase64Utf8, TreeItem, updateRef } from '@/lib/github-client'\r\nimport { removeBlogFromIndex } from '@/lib/blog-index'\r\n\r\nexport async function deleteBlog(slug: string): Promise<void> {\r\n\tif (!slug) throw new Error('需要 slug')\r\n\r\n\tconst token = await getAuthToken()\r\n\r\n\ttoast.info('正在获取分支信息...')\r\n\tconst refData = await getRef(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, `heads/${GITHUB_CONFIG.BRANCH}`)\r\n\tconst latestCommitSha = refData.sha\r\n\r\n\tconst basePath = `public/blogs/${slug}`\r\n\r\n\ttoast.info('正在收集文章文件...')\r\n\tconst files = await listRepoFilesRecursive(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, basePath, GITHUB_CONFIG.BRANCH)\r\n\tif (files.length === 0) {\r\n\t\tthrow new Error('文章不存在或已删除')\r\n\t}\r\n\r\n\tconst treeItems: TreeItem[] = files.map(path => ({\r\n\t\tpath,\r\n\t\tmode: '100644',\r\n\t\ttype: 'blob',\r\n\t\tsha: null\r\n\t}))\r\n\r\n\ttoast.info('正在更新索引...')\r\n\tconst indexJson = await removeBlogFromIndex(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, slug, GITHUB_CONFIG.BRANCH)\r\n\tconst indexBlob = await createBlob(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, toBase64Utf8(indexJson), 'base64')\r\n\ttreeItems.push({\r\n\t\tpath: 'public/blogs/index.json',\r\n\t\tmode: '100644',\r\n\t\ttype: 'blob',\r\n\t\tsha: indexBlob.sha\r\n\t})\r\n\r\n\ttoast.info('正在创建提交...')\r\n\tconst treeData = await createTree(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, treeItems, latestCommitSha)\r\n\tconst commitData = await createCommit(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, `删除文章: ${slug}`, treeData.sha, [latestCommitSha])\r\n\r\n\ttoast.info('正在更新分支...')\r\n\tawait updateRef(token, GITHUB_CONFIG.OWNER, GITHUB_CONFIG.REPO, `heads/${GITHUB_CONFIG.BRANCH}`, commitData.sha)\r\n\r\n\ttoast.success('删除成功！请等待页面部署后刷新')\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe,WAAW,IAAY;IAC5C,IAAI,CAAC,MAAM,MAAM,IAAI,MAAM;IAE3B,MAAM,QAAQ,MAAM,IAAA,kIAAY;IAEhC,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,UAAU,MAAM,IAAA,wIAAM,EAAC,OAAO,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI,EAAE,CAAC,MAAM,EAAE,8HAAa,CAAC,MAAM,EAAE;IAC5G,MAAM,kBAAkB,QAAQ,GAAG;IAEnC,MAAM,WAAW,CAAC,aAAa,EAAE,MAAM;IAEvC,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,QAAQ,MAAM,IAAA,wJAAsB,EAAC,OAAO,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI,EAAE,UAAU,8HAAa,CAAC,MAAM;IACzH,IAAI,MAAM,MAAM,KAAK,GAAG;QACvB,MAAM,IAAI,MAAM;IACjB;IAEA,MAAM,YAAwB,MAAM,GAAG,CAAC,CAAA,OAAQ,CAAC;YAChD;YACA,MAAM;YACN,MAAM;YACN,KAAK;QACN,CAAC;IAED,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,YAAY,MAAM,IAAA,kJAAmB,EAAC,OAAO,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI,EAAE,MAAM,8HAAa,CAAC,MAAM;IACtH,MAAM,YAAY,MAAM,IAAA,4IAAU,EAAC,OAAO,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI,EAAE,IAAA,8IAAY,EAAC,YAAY;IAC5G,UAAU,IAAI,CAAC;QACd,MAAM;QACN,MAAM;QACN,MAAM;QACN,KAAK,UAAU,GAAG;IACnB;IAEA,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,WAAW,MAAM,IAAA,4IAAU,EAAC,OAAO,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI,EAAE,WAAW;IAC7F,MAAM,aAAa,MAAM,IAAA,8IAAY,EAAC,OAAO,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI,EAAE,CAAC,MAAM,EAAE,MAAM,EAAE,SAAS,GAAG,EAAE;QAAC;KAAgB;IAEtI,iRAAK,CAAC,IAAI,CAAC;IACX,MAAM,IAAA,2IAAS,EAAC,OAAO,8HAAa,CAAC,KAAK,EAAE,8HAAa,CAAC,IAAI,EAAE,CAAC,MAAM,EAAE,8HAAa,CAAC,MAAM,EAAE,EAAE,WAAW,GAAG;IAE/G,iRAAK,CAAC,OAAO,CAAC;AACf","debugId":null}},
    {"offset": {"line": 1802, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/hooks/use-publish.ts"],"sourcesContent":["import { useCallback } from 'react'\r\nimport { readFileAsText } from '@/lib/file-utils'\r\nimport { toast } from 'sonner'\r\nimport { pushBlog } from '../services/push-blog'\r\nimport { deleteBlog } from '../services/delete-blog'\r\nimport { useWriteStore } from '../stores/write-store'\r\nimport { useAuthStore } from '@/hooks/use-auth'\r\n\r\nexport function usePublish() {\r\n\tconst { loading, setLoading, form, cover, images, mode, originalSlug } = useWriteStore()\r\n\tconst { isAuth, setPrivateKey } = useAuthStore()\r\n\r\n\tconst onChoosePrivateKey = useCallback(\r\n\t\tasync (file: File) => {\r\n\t\t\tconst pem = await readFileAsText(file)\r\n\t\t\tsetPrivateKey(pem)\r\n\t\t},\r\n\t\t[setPrivateKey]\r\n\t)\r\n\r\n\tconst onPublish = useCallback(async () => {\r\n\t\ttry {\r\n\t\t\tsetLoading(true)\r\n\t\t\tawait pushBlog({\r\n\t\t\t\tform,\r\n\t\t\t\tcover,\r\n\t\t\t\timages,\r\n\t\t\t\tmode,\r\n\t\t\t\toriginalSlug\r\n\t\t\t})\r\n\r\n\t\t\tconst successMsg = mode === 'edit' ? '更新成功' : '发布成功'\r\n\t\t\ttoast.success(successMsg)\r\n\t\t} catch (err: any) {\r\n\t\t\tconsole.error(err)\r\n\t\t\ttoast.error(err?.message || '操作失败')\r\n\t\t} finally {\r\n\t\t\tsetLoading(false)\r\n\t\t}\r\n\t}, [form, cover, images, mode, originalSlug, setLoading])\r\n\r\n\tconst onDelete = useCallback(async () => {\r\n\t\tconst targetSlug = originalSlug || form.slug\r\n\t\tif (!targetSlug) {\r\n\t\t\ttoast.error('缺少 slug，无法删除')\r\n\t\t\treturn\r\n\t\t}\r\n\t\ttry {\r\n\t\t\tsetLoading(true)\r\n\t\t\tawait deleteBlog(targetSlug)\r\n\t\t} catch (err: any) {\r\n\t\t\tconsole.error(err)\r\n\t\t\ttoast.error(err?.message || '删除失败')\r\n\t\t} finally {\r\n\t\t\tsetLoading(false)\r\n\t\t}\r\n\t}, [form.slug, originalSlug, setLoading])\r\n\r\n\treturn {\r\n\t\tisAuth,\r\n\t\tloading,\r\n\t\tonChoosePrivateKey,\r\n\t\tonPublish,\r\n\t\tonDelete\r\n\t}\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AAEO,SAAS;IACf,MAAM,EAAE,OAAO,EAAE,UAAU,EAAE,IAAI,EAAE,KAAK,EAAE,MAAM,EAAE,IAAI,EAAE,YAAY,EAAE,GAAG,IAAA,gKAAa;IACtF,MAAM,EAAE,MAAM,EAAE,aAAa,EAAE,GAAG,IAAA,2IAAY;IAE9C,MAAM,qBAAqB,IAAA,mUAAW,EACrC,OAAO;QACN,MAAM,MAAM,MAAM,IAAA,6IAAc,EAAC;QACjC,cAAc;IACf,GACA;QAAC;KAAc;IAGhB,MAAM,YAAY,IAAA,mUAAW,EAAC;QAC7B,IAAI;YACH,WAAW;YACX,MAAM,IAAA,2JAAQ,EAAC;gBACd;gBACA;gBACA;gBACA;gBACA;YACD;YAEA,MAAM,aAAa,SAAS,SAAS,SAAS;YAC9C,iRAAK,CAAC,OAAO,CAAC;QACf,EAAE,OAAO,KAAU;YAClB,QAAQ,KAAK,CAAC;YACd,iRAAK,CAAC,KAAK,CAAC,KAAK,WAAW;QAC7B,SAAU;YACT,WAAW;QACZ;IACD,GAAG;QAAC;QAAM;QAAO;QAAQ;QAAM;QAAc;KAAW;IAExD,MAAM,WAAW,IAAA,mUAAW,EAAC;QAC5B,MAAM,aAAa,gBAAgB,KAAK,IAAI;QAC5C,IAAI,CAAC,YAAY;YAChB,iRAAK,CAAC,KAAK,CAAC;YACZ;QACD;QACA,IAAI;YACH,WAAW;YACX,MAAM,IAAA,+JAAU,EAAC;QAClB,EAAE,OAAO,KAAU;YAClB,QAAQ,KAAK,CAAC;YACd,iRAAK,CAAC,KAAK,CAAC,KAAK,WAAW;QAC7B,SAAU;YACT,WAAW;QACZ;IACD,GAAG;QAAC,KAAK,IAAI;QAAE;QAAc;KAAW;IAExC,OAAO;QACN;QACA;QACA;QACA;QACA;IACD;AACD","debugId":null}},
    {"offset": {"line": 1887, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/components/actions.tsx"],"sourcesContent":["import { motion } from 'motion/react'\r\nimport { useRef } from 'react'\r\nimport { toast } from 'sonner'\r\nimport { useWriteStore } from '../stores/write-store'\r\nimport { usePreviewStore } from '../stores/preview-store'\r\nimport { usePublish } from '../hooks/use-publish'\r\n\r\nexport function WriteActions() {\r\n\tconst { loading, mode, form } = useWriteStore()\r\n\tconst { openPreview } = usePreviewStore()\r\n\tconst { isAuth, onChoosePrivateKey, onPublish, onDelete } = usePublish()\r\n\tconst keyInputRef = useRef<HTMLInputElement>(null)\r\n\r\n\tconst handleImportOrPublish = () => {\r\n\t\tif (!isAuth) {\r\n\t\t\tkeyInputRef.current?.click()\r\n\t\t} else {\r\n\t\t\tonPublish()\r\n\t\t}\r\n\t}\r\n\r\n\tconst buttonText = isAuth ? (mode === 'edit' ? '更新' : '发布') : '导入密钥'\r\n\r\n\tconst handleDelete = () => {\r\n\t\tif (!isAuth) {\r\n\t\t\ttoast.info('请先导入密钥')\r\n\t\t\treturn\r\n\t\t}\r\n\t\tconst confirmMsg = form?.title ? `确定删除《${form.title}》吗？该操作不可恢复。` : '确定删除当前文章吗？该操作不可恢复。'\r\n\t\tif (window.confirm(confirmMsg)) {\r\n\t\t\tonDelete()\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<input\r\n\t\t\t\tref={keyInputRef}\r\n\t\t\t\ttype='file'\r\n\t\t\t\taccept='.pem'\r\n\t\t\t\tclassName='hidden'\r\n\t\t\t\tonChange={async e => {\r\n\t\t\t\t\tconst f = e.target.files?.[0]\r\n\t\t\t\t\tif (f) await onChoosePrivateKey(f)\r\n\t\t\t\t\tif (e.currentTarget) e.currentTarget.value = ''\r\n\t\t\t\t}}\r\n\t\t\t/>\r\n\r\n\t\t\t<ul className='absolute top-4 right-6 flex items-center gap-2'>\r\n\t\t\t\t{mode === 'edit' && (\r\n\t\t\t\t\t<>\r\n\t\t\t\t\t\t<motion.div initial={{ opacity: 0, scale: 0.6 }} animate={{ opacity: 1, scale: 1 }} className='flex items-center gap-2'>\r\n\t\t\t\t\t\t\t<div className='rounded-lg border bg-blue-50 px-4 py-2 text-sm text-blue-700'>编辑模式</div>\r\n\t\t\t\t\t\t</motion.div>\r\n\t\t\t\t\t\t<motion.button\r\n\t\t\t\t\t\t\tinitial={{ opacity: 0, scale: 0.6 }}\r\n\t\t\t\t\t\t\tanimate={{ opacity: 1, scale: 1 }}\r\n\t\t\t\t\t\t\twhileHover={{ scale: 1.05 }}\r\n\t\t\t\t\t\t\twhileTap={{ scale: 0.95 }}\r\n\t\t\t\t\t\t\tclassName='rounded-xl border border-red-200 bg-red-50 px-4 py-2 text-sm text-red-600 transition-colors hover:bg-red-100'\r\n\t\t\t\t\t\t\tdisabled={loading}\r\n\t\t\t\t\t\t\tonClick={handleDelete}>\r\n\t\t\t\t\t\t\t删除\r\n\t\t\t\t\t\t</motion.button>\r\n\t\t\t\t\t</>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t<motion.button\r\n\t\t\t\t\tinitial={{ opacity: 0, scale: 0.6 }}\r\n\t\t\t\t\tanimate={{ opacity: 1, scale: 1 }}\r\n\t\t\t\t\twhileHover={{ scale: 1.05 }}\r\n\t\t\t\t\twhileTap={{ scale: 0.95 }}\r\n\t\t\t\t\tclassName='rounded-xl border bg-white/60 px-6 py-2 text-sm'\r\n\t\t\t\t\tdisabled={loading}\r\n\t\t\t\t\tonClick={openPreview}>\r\n\t\t\t\t\t预览\r\n\t\t\t\t</motion.button>\r\n\t\t\t\t<motion.button\r\n\t\t\t\t\tinitial={{ opacity: 0, scale: 0.6 }}\r\n\t\t\t\t\tanimate={{ opacity: 1, scale: 1 }}\r\n\t\t\t\t\twhileHover={{ scale: 1.05 }}\r\n\t\t\t\t\twhileTap={{ scale: 0.95 }}\r\n\t\t\t\t\tclassName='brand-btn px-6'\r\n\t\t\t\t\tdisabled={loading}\r\n\t\t\t\t\tonClick={handleImportOrPublish}>\r\n\t\t\t\t\t{buttonText}\r\n\t\t\t\t</motion.button>\r\n\t\t\t</ul>\r\n\t\t</>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;;;;;;AAEO,SAAS;IACf,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG,IAAA,gKAAa;IAC7C,MAAM,EAAE,WAAW,EAAE,GAAG,IAAA,oKAAe;IACvC,MAAM,EAAE,MAAM,EAAE,kBAAkB,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,IAAA,4JAAU;IACtE,MAAM,cAAc,IAAA,8TAAM,EAAmB;IAE7C,MAAM,wBAAwB;QAC7B,IAAI,CAAC,QAAQ;YACZ,YAAY,OAAO,EAAE;QACtB,OAAO;YACN;QACD;IACD;IAEA,MAAM,aAAa,SAAU,SAAS,SAAS,OAAO,OAAQ;IAE9D,MAAM,eAAe;QACpB,IAAI,CAAC,QAAQ;YACZ,iRAAK,CAAC,IAAI,CAAC;YACX;QACD;QACA,MAAM,aAAa,MAAM,QAAQ,CAAC,KAAK,EAAE,KAAK,KAAK,CAAC,WAAW,CAAC,GAAG;QACnE,IAAI,OAAO,OAAO,CAAC,aAAa;YAC/B;QACD;IACD;IAEA,qBACC;;0BACC,6VAAC;gBACA,KAAK;gBACL,MAAK;gBACL,QAAO;gBACP,WAAU;gBACV,UAAU,OAAM;oBACf,MAAM,IAAI,EAAE,MAAM,CAAC,KAAK,EAAE,CAAC,EAAE;oBAC7B,IAAI,GAAG,MAAM,mBAAmB;oBAChC,IAAI,EAAE,aAAa,EAAE,EAAE,aAAa,CAAC,KAAK,GAAG;gBAC9C;;;;;;0BAGD,6VAAC;gBAAG,WAAU;;oBACZ,SAAS,wBACT;;0CACC,6VAAC,0SAAM,CAAC,GAAG;gCAAC,SAAS;oCAAE,SAAS;oCAAG,OAAO;gCAAI;gCAAG,SAAS;oCAAE,SAAS;oCAAG,OAAO;gCAAE;gCAAG,WAAU;0CAC7F,cAAA,6VAAC;oCAAI,WAAU;8CAA+D;;;;;;;;;;;0CAE/E,6VAAC,0SAAM,CAAC,MAAM;gCACb,SAAS;oCAAE,SAAS;oCAAG,OAAO;gCAAI;gCAClC,SAAS;oCAAE,SAAS;oCAAG,OAAO;gCAAE;gCAChC,YAAY;oCAAE,OAAO;gCAAK;gCAC1B,UAAU;oCAAE,OAAO;gCAAK;gCACxB,WAAU;gCACV,UAAU;gCACV,SAAS;0CAAc;;;;;;;;kCAM1B,6VAAC,0SAAM,CAAC,MAAM;wBACb,SAAS;4BAAE,SAAS;4BAAG,OAAO;wBAAI;wBAClC,SAAS;4BAAE,SAAS;4BAAG,OAAO;wBAAE;wBAChC,YAAY;4BAAE,OAAO;wBAAK;wBAC1B,UAAU;4BAAE,OAAO;wBAAK;wBACxB,WAAU;wBACV,UAAU;wBACV,SAAS;kCAAa;;;;;;kCAGvB,6VAAC,0SAAM,CAAC,MAAM;wBACb,SAAS;4BAAE,SAAS;4BAAG,OAAO;wBAAI;wBAClC,SAAS;4BAAE,SAAS;4BAAG,OAAO;wBAAE;wBAChC,YAAY;4BAAE,OAAO;wBAAK;wBAC1B,UAAU;4BAAE,OAAO;wBAAK;wBACxB,WAAU;wBACV,UAAU;wBACV,SAAS;kCACR;;;;;;;;;;;;;;AAKN","debugId":null}},
    {"offset": {"line": 2072, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/lib/markdown-renderer.ts"],"sourcesContent":["import { marked } from 'marked'\r\nimport type { Tokens } from 'marked'\r\nimport { codeToHtml } from 'shiki'\r\n\r\nexport type TocItem = { id: string; text: string; level: number }\r\n\r\nexport interface MarkdownRenderResult {\r\n\thtml: string\r\n\ttoc: TocItem[]\r\n}\r\n\r\nexport function slugify(text: string): string {\r\n\treturn text\r\n\t\t.toLowerCase()\r\n\t\t.replace(/[^a-z0-9\\u4e00-\\u9fa5\\s-]/g, '')\r\n\t\t.trim()\r\n\t\t.replace(/\\s+/g, '-')\r\n}\r\n\r\nexport async function renderMarkdown(markdown: string): Promise<MarkdownRenderResult> {\r\n\t// Parse TOC from markdown\r\n\tconst toc: TocItem[] = []\r\n\tfor (const line of markdown.split('\\n')) {\r\n\t\tconst m = /^(#{1,3})\\s+(.+)$/.exec(line.trim())\r\n\t\tif (m) {\r\n\t\t\tconst level = m[1].length\r\n\t\t\tconst text = m[2].trim()\r\n\t\t\tconst id = slugify(text)\r\n\t\t\ttoc.push({ id, text, level })\r\n\t\t}\r\n\t}\r\n\r\n\t// Pre-process code blocks with Shiki\r\n\tconst codeBlockMap = new Map<string, { html: string; original: string }>()\r\n\tconst tokens = marked.lexer(markdown)\r\n\r\n\tfor (const token of tokens) {\r\n\t\tif (token.type === 'code') {\r\n\t\t\tconst codeToken = token as Tokens.Code\r\n\t\t\tconst originalCode = codeToken.text\r\n\t\t\ttry {\r\n\t\t\t\tconst html = await codeToHtml(originalCode, {\r\n\t\t\t\t\tlang: codeToken.lang || 'text',\r\n\t\t\t\t\ttheme: 'one-light'\r\n\t\t\t\t})\r\n\t\t\t\tconst key = `__SHIKI_CODE_${codeBlockMap.size}__`\r\n\t\t\t\tcodeBlockMap.set(key, { html, original: originalCode })\r\n\t\t\t\tcodeToken.text = key\r\n\t\t\t} catch {\r\n\t\t\t\t// Keep original if highlighting fails\r\n\t\t\t\tconst key = `__SHIKI_CODE_${codeBlockMap.size}__`\r\n\t\t\t\tcodeBlockMap.set(key, { html: '', original: originalCode })\r\n\t\t\t\tcodeToken.text = key\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\t// Render HTML with heading ids\r\n\tconst renderer = new marked.Renderer()\r\n\r\n\trenderer.heading = (token: Tokens.Heading) => {\r\n\t\tconst id = slugify(token.text || '')\r\n\t\treturn `<h${token.depth} id=\"${id}\">${token.text}</h${token.depth}>`\r\n\t}\r\n\r\n\trenderer.code = (token: Tokens.Code) => {\r\n\t\t// Check if this code block was pre-processed\r\n\t\tconst codeData = codeBlockMap.get(token.text)\r\n\t\tif (codeData) {\r\n\t\t\t// Add data-code attribute with original code for copy functionality\r\n\t\t\t// Escape HTML entities for attribute value\r\n\t\t\tconst escapedCode = codeData.original\r\n\t\t\t\t.replace(/&/g, '&amp;')\r\n\t\t\t\t.replace(/\"/g, '&quot;')\r\n\t\t\t\t.replace(/'/g, '&#39;')\r\n\t\t\t\t.replace(/</g, '&lt;')\r\n\t\t\t\t.replace(/>/g, '&gt;')\r\n\t\t\tif (codeData.html) {\r\n\t\t\t\t// Shiki highlighted code\r\n\t\t\t\treturn `<pre data-code=\"${escapedCode}\">${codeData.html}</pre>`\r\n\t\t\t}\r\n\t\t\t// Fallback for failed highlighting\r\n\t\t\treturn `<pre data-code=\"${escapedCode}\"><code>${codeData.original}</code></pre>`\r\n\t\t}\r\n\t\t// Fallback to default (inline code, not code block)\r\n\t\treturn `<code>${token.text}</code>`\r\n\t}\r\n\r\n\trenderer.listitem = (token: Tokens.ListItem) => {\r\n\t\t// Render inline markdown inside list items (e.g. links, emphasis)\r\n\t\tconst inner = token.tokens ? (marked.parser(token.tokens) as string) : token.text\r\n\r\n\t\tif (token.task) {\r\n\t\t\tconst checkbox = token.checked ? '<input type=\"checkbox\" checked disabled />' : '<input type=\"checkbox\" disabled />'\r\n\t\t\treturn `<li class=\"task-list-item\">${checkbox} ${inner}</li>\\n`\r\n\t\t}\r\n\r\n\t\treturn `<li>${inner}</li>\\n`\r\n\t}\r\n\r\n\tmarked.use({\r\n\t\trenderer\r\n\t})\r\n\tconst html = (marked.parser(tokens) as string) || ''\r\n\r\n\treturn { html, toc }\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2180, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/components/dialog-modal.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useState, type ReactNode } from 'react'\r\nimport { createPortal } from 'react-dom'\r\nimport { AnimatePresence, motion } from 'motion/react'\r\nimport { cn } from '@/lib/utils'\r\n\r\ninterface DialogModalProps {\r\n\topen: boolean\r\n\tonClose: () => void\r\n\tchildren: ReactNode\r\n\tclassName?: string\r\n\toverlayClassName?: string\r\n\tdisableCloseOnOverlay?: boolean\r\n\tlockScroll?: boolean\r\n\tcloseOnEsc?: boolean\r\n}\r\n\r\nexport function DialogModal({ open, onClose, children, className, disableCloseOnOverlay = false, lockScroll = true, closeOnEsc = true }: DialogModalProps) {\r\n\tconst [mounted, setMounted] = useState(false)\r\n\r\n\tuseEffect(() => {\r\n\t\tsetMounted(true)\r\n\t}, [])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!lockScroll || !open) return\r\n\t\tconst previous = document.body.style.overflow\r\n\t\tdocument.body.style.overflow = 'hidden'\r\n\t\treturn () => {\r\n\t\t\tdocument.body.style.overflow = previous\r\n\t\t}\r\n\t}, [lockScroll, open])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (!closeOnEsc || !open) return\r\n\t\tconst handler = (event: KeyboardEvent) => {\r\n\t\t\tif (event.key === 'Escape') {\r\n\t\t\t\tonClose()\r\n\t\t\t}\r\n\t\t}\r\n\t\twindow.addEventListener('keydown', handler)\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener('keydown', handler)\r\n\t\t}\r\n\t}, [closeOnEsc, onClose, open])\r\n\r\n\tif (!mounted) return null\r\n\r\n\treturn createPortal(\r\n\t\t<AnimatePresence>\r\n\t\t\t{open && (\r\n\t\t\t\t<motion.div\r\n\t\t\t\t\tinitial={{ opacity: 0 }}\r\n\t\t\t\t\tanimate={{ opacity: 1 }}\r\n\t\t\t\t\texit={{ opacity: 0 }}\r\n\t\t\t\t\tclassName={'fixed inset-0 z-50 flex items-center justify-center bg-card p-4 backdrop-blur-xl'}\r\n\t\t\t\t\tonClick={disableCloseOnOverlay ? undefined : onClose}>\r\n\t\t\t\t\t<motion.div\r\n\t\t\t\t\t\tinitial={{ opacity: 0, scale: 0.8, y: 20 }}\r\n\t\t\t\t\t\tanimate={{ opacity: 1, scale: 1, y: 0 }}\r\n\t\t\t\t\t\texit={{ opacity: 0, scale: 0.8, y: 20 }}\r\n\t\t\t\t\t\tclassName={cn('static', className)}\r\n\t\t\t\t\t\tonClick={e => e.stopPropagation()}>\r\n\t\t\t\t\t\t{children}\r\n\t\t\t\t\t</motion.div>\r\n\t\t\t\t</motion.div>\r\n\t\t\t)}\r\n\t\t</AnimatePresence>,\r\n\t\tdocument.body\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAAA;AACA;AALA;;;;;;AAkBO,SAAS,YAAY,EAAE,IAAI,EAAE,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,wBAAwB,KAAK,EAAE,aAAa,IAAI,EAAE,aAAa,IAAI,EAAoB;IACxJ,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gUAAQ,EAAC;IAEvC,IAAA,iUAAS,EAAC;QACT,WAAW;IACZ,GAAG,EAAE;IAEL,IAAA,iUAAS,EAAC;QACT,IAAI,CAAC,cAAc,CAAC,MAAM;QAC1B,MAAM,WAAW,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ;QAC7C,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QAC/B,OAAO;YACN,SAAS,IAAI,CAAC,KAAK,CAAC,QAAQ,GAAG;QAChC;IACD,GAAG;QAAC;QAAY;KAAK;IAErB,IAAA,iUAAS,EAAC;QACT,IAAI,CAAC,cAAc,CAAC,MAAM;QAC1B,MAAM,UAAU,CAAC;YAChB,IAAI,MAAM,GAAG,KAAK,UAAU;gBAC3B;YACD;QACD;QACA,OAAO,gBAAgB,CAAC,WAAW;QACnC,OAAO;YACN,OAAO,mBAAmB,CAAC,WAAW;QACvC;IACD,GAAG;QAAC;QAAY;QAAS;KAAK;IAE9B,IAAI,CAAC,SAAS,OAAO;IAErB,qBAAO,IAAA,2UAAY,gBAClB,6VAAC,kTAAe;kBACd,sBACA,6VAAC,0SAAM,CAAC,GAAG;YACV,SAAS;gBAAE,SAAS;YAAE;YACtB,SAAS;gBAAE,SAAS;YAAE;YACtB,MAAM;gBAAE,SAAS;YAAE;YACnB,WAAW;YACX,SAAS,wBAAwB,YAAY;sBAC7C,cAAA,6VAAC,0SAAM,CAAC,GAAG;gBACV,SAAS;oBAAE,SAAS;oBAAG,OAAO;oBAAK,GAAG;gBAAG;gBACzC,SAAS;oBAAE,SAAS;oBAAG,OAAO;oBAAG,GAAG;gBAAE;gBACtC,MAAM;oBAAE,SAAS;oBAAG,OAAO;oBAAK,GAAG;gBAAG;gBACtC,WAAW,IAAA,yHAAE,EAAC,UAAU;gBACxB,SAAS,CAAA,IAAK,EAAE,eAAe;0BAC9B;;;;;;;;;;;;;;;cAKL,SAAS,IAAI;AAEf","debugId":null}},
    {"offset": {"line": 2281, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/components/markdown-image.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { DialogModal } from '@/components/dialog-modal'\r\n\r\ntype MarkdownImageProps = {\r\n\tsrc: string\r\n\talt?: string\r\n\ttitle?: string\r\n}\r\n\r\nexport function MarkdownImage({ src, alt = '', title = '' }: MarkdownImageProps) {\r\n\tconst [display, setDisplay] = useState(false)\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<img src={src} alt={alt} title={title} loading='lazy' onClick={() => setDisplay(true)} className='cursor-pointer transition-opacity hover:opacity-80' />\r\n\t\t\t<DialogModal open={display} onClose={() => setDisplay(false)} className='max-w-none bg-transparent p-0'>\r\n\t\t\t\t<img src={src} alt={alt} className='max-h-[90vh] max-w-full rounded-2xl object-contain' />\r\n\t\t\t</DialogModal>\r\n\t\t</>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAHA;;;;AAWO,SAAS,cAAc,EAAE,GAAG,EAAE,MAAM,EAAE,EAAE,QAAQ,EAAE,EAAsB;IAC9E,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gUAAQ,EAAC;IAEvC,qBACC;;0BACC,6VAAC;gBAAI,KAAK;gBAAK,KAAK;gBAAK,OAAO;gBAAO,SAAQ;gBAAO,SAAS,IAAM,WAAW;gBAAO,WAAU;;;;;;0BACjG,6VAAC,oJAAW;gBAAC,MAAM;gBAAS,SAAS,IAAM,WAAW;gBAAQ,WAAU;0BACvE,cAAA,6VAAC;oBAAI,KAAK;oBAAK,KAAK;oBAAK,WAAU;;;;;;;;;;;;;AAIvC","debugId":null}},
    {"offset": {"line": 2333, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/components/code-block.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useState } from 'react'\r\nimport { Copy, Check } from 'lucide-react'\r\n\r\ntype CodeBlockProps = {\r\n\tchildren: React.ReactNode\r\n\tcode: string\r\n}\r\n\r\nexport function CodeBlock({ children, code }: CodeBlockProps) {\r\n\tconst [copied, setCopied] = useState(false)\r\n\r\n\tconst handleCopy = async () => {\r\n\t\ttry {\r\n\t\t\tawait navigator.clipboard.writeText(code)\r\n\t\t\tsetCopied(true)\r\n\t\t\tsetTimeout(() => setCopied(false), 2000)\r\n\t\t} catch (error) {\r\n\t\t\tconsole.error('Failed to copy code:', error)\r\n\t\t}\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className='code-block-wrapper'>\r\n\t\t\t<button\r\n\t\t\t\ttype='button'\r\n\t\t\t\tonClick={handleCopy}\r\n\t\t\t\tclassName='code-block-copy-btn'\r\n\t\t\t\taria-label='Copy code'\r\n\t\t\t>\r\n\t\t\t\t{copied ? <Check size={16} /> : <Copy size={16} />}\r\n\t\t\t</button>\r\n\t\t\t{children}\r\n\t\t</div>\r\n\t)\r\n}\r\n\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAHA;;;;AAUO,SAAS,UAAU,EAAE,QAAQ,EAAE,IAAI,EAAkB;IAC3D,MAAM,CAAC,QAAQ,UAAU,GAAG,IAAA,gUAAQ,EAAC;IAErC,MAAM,aAAa;QAClB,IAAI;YACH,MAAM,UAAU,SAAS,CAAC,SAAS,CAAC;YACpC,UAAU;YACV,WAAW,IAAM,UAAU,QAAQ;QACpC,EAAE,OAAO,OAAO;YACf,QAAQ,KAAK,CAAC,wBAAwB;QACvC;IACD;IAEA,qBACC,6VAAC;QAAI,WAAU;;0BACd,6VAAC;gBACA,MAAK;gBACL,SAAS;gBACT,WAAU;gBACV,cAAW;0BAEV,uBAAS,6VAAC,iSAAK;oBAAC,MAAM;;;;;yCAAS,6VAAC,8RAAI;oBAAC,MAAM;;;;;;;;;;;YAE5C;;;;;;;AAGJ","debugId":null}},
    {"offset": {"line": 2396, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/hooks/use-markdown-render.tsx"],"sourcesContent":["import { useEffect, useState, type ReactElement } from 'react'\r\nimport parse, { type HTMLReactParserOptions, Element, type DOMNode } from 'html-react-parser'\r\nimport { renderMarkdown, type TocItem } from '@/lib/markdown-renderer'\r\nimport { MarkdownImage } from '@/components/markdown-image'\r\nimport { CodeBlock } from '@/components/code-block'\r\n\r\ntype MarkdownRenderResult = {\r\n\tcontent: ReactElement | null\r\n\ttoc: TocItem[]\r\n\tloading: boolean\r\n}\r\n\r\nexport function useMarkdownRender(markdown: string): MarkdownRenderResult {\r\n\tconst [content, setContent] = useState<ReactElement | null>(null)\r\n\tconst [toc, setToc] = useState<TocItem[]>([])\r\n\tconst [loading, setLoading] = useState<boolean>(true)\r\n\r\n\tuseEffect(() => {\r\n\t\tlet cancelled = false\r\n\r\n\t\tasync function render() {\r\n\t\t\tsetLoading(true)\r\n\t\t\ttry {\r\n\t\t\t\tconst { html, toc } = await renderMarkdown(markdown)\r\n\t\t\t\tif (!cancelled) {\r\n\t\t\t\t\t// Extract pre elements and replace with placeholders before parsing\r\n\t\t\t\t\tconst codeBlocks: Array<{ placeholder: string; code: string; preHtml: string }> = []\r\n\t\t\t\t\tlet processedHtml = html.replace(/<pre\\s+data-code=\"([^\"]*)\"([^>]*)>([\\s\\S]*?)<\\/pre>/g, (match, codeAttr, attrs, content) => {\r\n\t\t\t\t\t\tconst placeholder = `__CODE_BLOCK_${codeBlocks.length}__`\r\n\t\t\t\t\t\t// Decode HTML entities in code attribute\r\n\t\t\t\t\t\tconst code = codeAttr\r\n\t\t\t\t\t\t\t.replace(/&quot;/g, '\"')\r\n\t\t\t\t\t\t\t.replace(/&#39;/g, \"'\")\r\n\t\t\t\t\t\t\t.replace(/&lt;/g, '<')\r\n\t\t\t\t\t\t\t.replace(/&gt;/g, '>')\r\n\t\t\t\t\t\t\t.replace(/&amp;/g, '&')\r\n\t\t\t\t\t\tcodeBlocks.push({\r\n\t\t\t\t\t\t\tplaceholder,\r\n\t\t\t\t\t\t\tcode,\r\n\t\t\t\t\t\t\tpreHtml: `${content}`\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\treturn placeholder\r\n\t\t\t\t\t})\r\n\r\n\t\t\t\t\t// Parse HTML and replace img elements and code block placeholders\r\n\t\t\t\t\tconst options: HTMLReactParserOptions = {\r\n\t\t\t\t\t\treplace(domNode: DOMNode) {\r\n\t\t\t\t\t\t\tif (domNode instanceof Element && domNode.name === 'img') {\r\n\t\t\t\t\t\t\t\tconst { src, alt, title } = domNode.attribs\r\n\t\t\t\t\t\t\t\treturn <MarkdownImage src={src} alt={alt} title={title} />\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t// Handle code block placeholders in text nodes\r\n\t\t\t\t\t\t\tif (domNode.type === 'text' && domNode.data) {\r\n\t\t\t\t\t\t\t\tconst text = domNode.data\r\n\t\t\t\t\t\t\t\tfor (const block of codeBlocks) {\r\n\t\t\t\t\t\t\t\t\tif (text.includes(block.placeholder)) {\r\n\t\t\t\t\t\t\t\t\t\tconst parts = text.split(block.placeholder)\r\n\t\t\t\t\t\t\t\t\t\tconst preElement = parse(block.preHtml) as ReactElement\r\n\t\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{parts[0] && <>{parts[0]}</>}\r\n\t\t\t\t\t\t\t\t\t\t\t\t<CodeBlock code={block.code}>{preElement}</CodeBlock>\r\n\t\t\t\t\t\t\t\t\t\t\t\t{parts[1] && <>{parts[1]}</>}\r\n\t\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tconst reactContent = parse(processedHtml, options) as ReactElement\r\n\t\t\t\t\tsetContent(reactContent)\r\n\t\t\t\t\tsetToc(toc)\r\n\t\t\t\t}\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('Markdown render error:', error)\r\n\t\t\t\tif (!cancelled) {\r\n\t\t\t\t\tsetContent(null)\r\n\t\t\t\t\tsetToc([])\r\n\t\t\t\t}\r\n\t\t\t} finally {\r\n\t\t\t\tif (!cancelled) {\r\n\t\t\t\t\tsetLoading(false)\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\trender()\r\n\r\n\t\treturn () => {\r\n\t\t\tcancelled = true\r\n\t\t}\r\n\t}, [markdown])\r\n\r\n\treturn { content, toc, loading }\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AAAA;AACA;AACA;AACA;;;;;;;;;;;AAQO,SAAS,kBAAkB,QAAgB;IACjD,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gUAAQ,EAAsB;IAC5D,MAAM,CAAC,KAAK,OAAO,GAAG,IAAA,gUAAQ,EAAY,EAAE;IAC5C,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,gUAAQ,EAAU;IAEhD,IAAA,iUAAS,EAAC;QACT,IAAI,YAAY;QAEhB,eAAe;YACd,WAAW;YACX,IAAI;gBACH,MAAM,EAAE,IAAI,EAAE,GAAG,EAAE,GAAG,MAAM,IAAA,oJAAc,EAAC;gBAC3C,IAAI,CAAC,WAAW;oBACf,oEAAoE;oBACpE,MAAM,aAA4E,EAAE;oBACpF,IAAI,gBAAgB,KAAK,OAAO,CAAC,wDAAwD,CAAC,OAAO,UAAU,OAAO;wBACjH,MAAM,cAAc,CAAC,aAAa,EAAE,WAAW,MAAM,CAAC,EAAE,CAAC;wBACzD,yCAAyC;wBACzC,MAAM,OAAO,SACX,OAAO,CAAC,WAAW,KACnB,OAAO,CAAC,UAAU,KAClB,OAAO,CAAC,SAAS,KACjB,OAAO,CAAC,SAAS,KACjB,OAAO,CAAC,UAAU;wBACpB,WAAW,IAAI,CAAC;4BACf;4BACA;4BACA,SAAS,GAAG,SAAS;wBACtB;wBACA,OAAO;oBACR;oBAEA,kEAAkE;oBAClE,MAAM,UAAkC;wBACvC,SAAQ,OAAgB;4BACvB,IAAI,mBAAmB,+RAAO,IAAI,QAAQ,IAAI,KAAK,OAAO;gCACzD,MAAM,EAAE,GAAG,EAAE,GAAG,EAAE,KAAK,EAAE,GAAG,QAAQ,OAAO;gCAC3C,qBAAO,6VAAC,wJAAa;oCAAC,KAAK;oCAAK,KAAK;oCAAK,OAAO;;;;;;4BAClD;4BACA,+CAA+C;4BAC/C,IAAI,QAAQ,IAAI,KAAK,UAAU,QAAQ,IAAI,EAAE;gCAC5C,MAAM,OAAO,QAAQ,IAAI;gCACzB,KAAK,MAAM,SAAS,WAAY;oCAC/B,IAAI,KAAK,QAAQ,CAAC,MAAM,WAAW,GAAG;wCACrC,MAAM,QAAQ,KAAK,KAAK,CAAC,MAAM,WAAW;wCAC1C,MAAM,aAAa,IAAA,gTAAK,EAAC,MAAM,OAAO;wCACtC,qBACC;;gDACE,KAAK,CAAC,EAAE,kBAAI;8DAAG,KAAK,CAAC,EAAE;;8DACxB,6VAAC,gJAAS;oDAAC,MAAM,MAAM,IAAI;8DAAG;;;;;;gDAC7B,KAAK,CAAC,EAAE,kBAAI;8DAAG,KAAK,CAAC,EAAE;;;;oCAG3B;gCACD;4BACD;wBACD;oBACD;oBACA,MAAM,eAAe,IAAA,gTAAK,EAAC,eAAe;oBAC1C,WAAW;oBACX,OAAO;gBACR;YACD,EAAE,OAAO,OAAO;gBACf,QAAQ,KAAK,CAAC,0BAA0B;gBACxC,IAAI,CAAC,WAAW;oBACf,WAAW;oBACX,OAAO,EAAE;gBACV;YACD,SAAU;gBACT,IAAI,CAAC,WAAW;oBACf,WAAW;gBACZ;YACD;QACD;QAEA;QAEA,OAAO;YACN,YAAY;QACb;IACD,GAAG;QAAC;KAAS;IAEb,OAAO;QAAE;QAAS;QAAK;IAAQ;AAChC","debugId":null}},
    {"offset": {"line": 2520, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/components/like-button.tsx"],"sourcesContent":["import { useCallback, useEffect, useState } from 'react'\r\nimport useSWR from 'swr'\r\nimport { motion, AnimatePresence } from 'motion/react'\r\nimport { Heart } from 'lucide-react'\r\nimport clsx from 'clsx'\r\nimport { cn } from '@/lib/utils'\r\nimport { toast } from 'sonner'\r\n\r\ntype LikeButtonProps = {\r\n\tslug?: string\r\n\tclassName?: string\r\n\tdelay?: number\r\n}\r\n\r\nconst ENDPOINT = 'https://blog-liker.yysuni1001.workers.dev/api/like'\r\n\r\nexport default function LikeButton({ slug = 'yysuni', delay, className }: LikeButtonProps) {\r\n\tconst [liked, setLiked] = useState(false)\r\n\tconst [show, setShow] = useState(false)\r\n\tconst [justLiked, setJustLiked] = useState(false)\r\n\tconst [particles, setParticles] = useState<Array<{ id: number; x: number; y: number }>>([])\r\n\r\n\tuseEffect(() => {\r\n\t\tsetTimeout(() => {\r\n\t\t\tsetShow(true)\r\n\t\t}, delay || 1000)\r\n\t}, [])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (justLiked) {\r\n\t\t\tconst timer = setTimeout(() => setJustLiked(false), 600)\r\n\t\t\treturn () => clearTimeout(timer)\r\n\t\t}\r\n\t}, [justLiked])\r\n\r\n\tconst fetcher = useCallback(async (url: string): Promise<number | null> => {\r\n\t\tconst res = await fetch(url, { method: 'GET', cache: 'no-store' })\r\n\t\tif (!res.ok) return null\r\n\t\tconst data = await res.json().catch(() => ({}))\r\n\t\treturn typeof data?.count === 'number' ? data.count : null\r\n\t}, [])\r\n\r\n\tconst { data: fetchedCount, mutate } = useSWR(slug ? `${ENDPOINT}?slug=${encodeURIComponent(slug)}` : null, fetcher, {\r\n\t\trevalidateOnFocus: false,\r\n\t\tdedupingInterval: 1000 * 10\r\n\t})\r\n\r\n\tconst handleLike = useCallback(async () => {\r\n\t\tif (!slug) return\r\n\t\tsetLiked(true)\r\n\t\tsetJustLiked(true)\r\n\r\n\t\t// Create particle effects\r\n\t\tconst newParticles = Array.from({ length: 6 }, (_, i) => ({\r\n\t\t\tid: Date.now() + i,\r\n\t\t\tx: Math.random() * 60 - 30,\r\n\t\t\ty: Math.random() * 60 - 30\r\n\t\t}))\r\n\t\tsetParticles(newParticles)\r\n\r\n\t\t// Clear particles after animation\r\n\t\tsetTimeout(() => setParticles([]), 1000)\r\n\r\n\t\ttry {\r\n\t\t\tconst url = `${ENDPOINT}?slug=${encodeURIComponent(slug)}`\r\n\t\t\tconst res = await fetch(url, { method: 'POST' })\r\n\t\t\tconst data = await res.json().catch(() => ({}))\r\n\t\t\tif (data.reason == 'rate_limited') toast('谢谢啦😘，今天已经不能再点赞啦💕')\r\n\t\t\tconst value = typeof data?.count === 'number' ? data.count : (fetchedCount ?? 0) + 1\r\n\t\t\tawait mutate(value, { revalidate: false })\r\n\t\t} catch {\r\n\t\t\t// ignore\r\n\t\t}\r\n\t}, [slug, fetchedCount, mutate])\r\n\r\n\tconst count = typeof fetchedCount === 'number' ? fetchedCount : null\r\n\r\n\tif (show)\r\n\t\treturn (\r\n\t\t\t<motion.button\r\n\t\t\t\tinitial={{ opacity: 0, scale: 0.6 }}\r\n\t\t\t\tanimate={{ opacity: 1, scale: 1 }}\r\n\t\t\t\twhileHover={{ scale: 1.05 }}\r\n\t\t\t\twhileTap={{ scale: 0.95 }}\r\n\t\t\t\taria-label='Like this post'\r\n\t\t\t\tonClick={handleLike}\r\n\t\t\t\tclassName={clsx('card heartbeat-container relative overflow-visible rounded-full p-3', className)}>\r\n\t\t\t\t<AnimatePresence>\r\n\t\t\t\t\t{particles.map(particle => (\r\n\t\t\t\t\t\t<motion.div\r\n\t\t\t\t\t\t\tkey={particle.id}\r\n\t\t\t\t\t\t\tclassName='pointer-events-none absolute inset-0 flex items-center justify-center'\r\n\t\t\t\t\t\t\tinitial={{ opacity: 1, scale: 0, x: 0, y: 0 }}\r\n\t\t\t\t\t\t\tanimate={{\r\n\t\t\t\t\t\t\t\topacity: [1, 1, 0],\r\n\t\t\t\t\t\t\t\tscale: [0, 1.2, 0.8],\r\n\t\t\t\t\t\t\t\tx: particle.x,\r\n\t\t\t\t\t\t\t\ty: particle.y\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\texit={{ opacity: 0 }}\r\n\t\t\t\t\t\t\ttransition={{ duration: 0.8, ease: 'easeOut' }}>\r\n\t\t\t\t\t\t\t<Heart className='fill-rose-400 text-rose-400' size={12} />\r\n\t\t\t\t\t\t</motion.div>\r\n\t\t\t\t\t))}\r\n\t\t\t\t</AnimatePresence>\r\n\r\n\t\t\t\t{typeof count === 'number' && (\r\n\t\t\t\t\t<motion.span\r\n\t\t\t\t\t\tinitial={{ scale: 0.4 }}\r\n\t\t\t\t\t\tanimate={{ scale: 1 }}\r\n\t\t\t\t\t\tclassName={cn(\r\n\t\t\t\t\t\t\t'absolute -top-2 left-9 min-w-6 rounded-full px-1.5 py-1 text-center text-xs text-white tabular-nums',\r\n\t\t\t\t\t\t\tliked ? 'bg-rose-400' : 'bg-gray-300'\r\n\t\t\t\t\t\t)}>\r\n\t\t\t\t\t\t{count}\r\n\t\t\t\t\t</motion.span>\r\n\t\t\t\t)}\r\n\t\t\t\t<motion.div animate={justLiked ? { scale: [1, 1.4, 1], rotate: [0, -10, 10, 0] } : {}} transition={{ duration: 0.6, ease: 'easeOut' }}>\r\n\t\t\t\t\t<Heart className={clsx('heartbeat', liked ? 'fill-rose-400 text-rose-400' : 'fill-rose-200 text-rose-200')} size={28} />\r\n\t\t\t\t</motion.div>\r\n\t\t\t</motion.button>\r\n\t\t)\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 2731, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/components/blog-toc.tsx"],"sourcesContent":["'use client'\r\n\r\nimport clsx from 'clsx'\r\nimport { motion } from 'motion/react'\r\nimport { useEffect, useMemo, useState } from 'react'\r\n\r\ntype TocItem = {\r\n\tid: string\r\n\ttext: string\r\n\tlevel: number\r\n}\r\n\r\ntype BlogTocProps = {\r\n\ttoc: TocItem[]\r\n\tdelay?: number\r\n}\r\n\r\nexport function BlogToc({ toc, delay = 0 }: BlogTocProps) {\r\n\tconst [activeIds, setActiveIds] = useState<Set<string>>(new Set())\r\n\tconst minActiveId = useMemo(() => {\r\n\t\treturn Array.from(activeIds).sort((a, b) => toc.findIndex(item => item.id === a) - toc.findIndex(item => item.id === b))[0]\r\n\t}, [activeIds, toc])\r\n\r\n\tuseEffect(() => {\r\n\t\tif (toc.length === 0) return\r\n\r\n\t\tconst observers = new Map<string, IntersectionObserver>()\r\n\r\n\t\t// Create observers for each heading\r\n\t\ttoc.forEach(item => {\r\n\t\t\tconst element = document.getElementById(item.id)\r\n\t\t\tif (!element) return\r\n\r\n\t\t\tconst observer = new IntersectionObserver(\r\n\t\t\t\tentries => {\r\n\t\t\t\t\tentries.forEach(entry => {\r\n\t\t\t\t\t\tsetActiveIds(prev => {\r\n\t\t\t\t\t\t\tconst newSet = new Set(prev)\r\n\t\t\t\t\t\t\tif (entry.isIntersecting) newSet.add(entry.target.id)\r\n\t\t\t\t\t\t\telse newSet.delete(entry.target.id)\r\n\r\n\t\t\t\t\t\t\treturn newSet\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t})\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\trootMargin: '-100px 0px -100px 0px',\r\n\t\t\t\t\tthreshold: 0\r\n\t\t\t\t}\r\n\t\t\t)\r\n\r\n\t\t\tobserver.observe(element)\r\n\t\t\tobservers.set(item.id, observer)\r\n\t\t})\r\n\r\n\t\treturn () => {\r\n\t\t\tobservers.forEach(observer => observer.disconnect())\r\n\t\t}\r\n\t}, [toc])\r\n\r\n\treturn (\r\n\t\t<motion.div\r\n\t\t\tinitial={{ opacity: 0, scale: 0.8 }}\r\n\t\t\tanimate={{ opacity: 1, scale: 1 }}\r\n\t\t\ttransition={{ delay }}\r\n\t\t\tclassName='bg-card w-full rounded-xl border p-3 text-sm'>\r\n\t\t\t<h2 className='text-secondary mb-2 font-medium'>目录</h2>\r\n\t\t\t<div className='relative max-h-[300px] space-y-2 overflow-auto'>\r\n\t\t\t\t{toc.length === 0 && <div className='text-secondary'>暂无</div>}\r\n\t\t\t\t{toc.map(item => (\r\n\t\t\t\t\t<a\r\n\t\t\t\t\t\tkey={item.id + item.level}\r\n\t\t\t\t\t\thref={`#${item.id}`}\r\n\t\t\t\t\t\tclassName={clsx('hover:text-brand relative block pl-3 transition-colors', item.id === minActiveId && 'text-brand')}\r\n\t\t\t\t\t\tstyle={{ paddingLeft: (item.level - 1) * 8 }}>\r\n\t\t\t\t\t\t{item.text}\r\n\t\t\t\t\t</a>\r\n\t\t\t\t))}\r\n\t\t\t</div>\r\n\t\t</motion.div>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AAJA;;;;;AAiBO,SAAS,QAAQ,EAAE,GAAG,EAAE,QAAQ,CAAC,EAAgB;IACvD,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,gUAAQ,EAAc,IAAI;IAC5D,MAAM,cAAc,IAAA,+TAAO,EAAC;QAC3B,OAAO,MAAM,IAAI,CAAC,WAAW,IAAI,CAAC,CAAC,GAAG,IAAM,IAAI,SAAS,CAAC,CAAA,OAAQ,KAAK,EAAE,KAAK,KAAK,IAAI,SAAS,CAAC,CAAA,OAAQ,KAAK,EAAE,KAAK,GAAG,CAAC,EAAE;IAC5H,GAAG;QAAC;QAAW;KAAI;IAEnB,IAAA,iUAAS,EAAC;QACT,IAAI,IAAI,MAAM,KAAK,GAAG;QAEtB,MAAM,YAAY,IAAI;QAEtB,oCAAoC;QACpC,IAAI,OAAO,CAAC,CAAA;YACX,MAAM,UAAU,SAAS,cAAc,CAAC,KAAK,EAAE;YAC/C,IAAI,CAAC,SAAS;YAEd,MAAM,WAAW,IAAI,qBACpB,CAAA;gBACC,QAAQ,OAAO,CAAC,CAAA;oBACf,aAAa,CAAA;wBACZ,MAAM,SAAS,IAAI,IAAI;wBACvB,IAAI,MAAM,cAAc,EAAE,OAAO,GAAG,CAAC,MAAM,MAAM,CAAC,EAAE;6BAC/C,OAAO,MAAM,CAAC,MAAM,MAAM,CAAC,EAAE;wBAElC,OAAO;oBACR;gBACD;YACD,GACA;gBACC,YAAY;gBACZ,WAAW;YACZ;YAGD,SAAS,OAAO,CAAC;YACjB,UAAU,GAAG,CAAC,KAAK,EAAE,EAAE;QACxB;QAEA,OAAO;YACN,UAAU,OAAO,CAAC,CAAA,WAAY,SAAS,UAAU;QAClD;IACD,GAAG;QAAC;KAAI;IAER,qBACC,6VAAC,0SAAM,CAAC,GAAG;QACV,SAAS;YAAE,SAAS;YAAG,OAAO;QAAI;QAClC,SAAS;YAAE,SAAS;YAAG,OAAO;QAAE;QAChC,YAAY;YAAE;QAAM;QACpB,WAAU;;0BACV,6VAAC;gBAAG,WAAU;0BAAkC;;;;;;0BAChD,6VAAC;gBAAI,WAAU;;oBACb,IAAI,MAAM,KAAK,mBAAK,6VAAC;wBAAI,WAAU;kCAAiB;;;;;;oBACpD,IAAI,GAAG,CAAC,CAAA,qBACR,6VAAC;4BAEA,MAAM,CAAC,CAAC,EAAE,KAAK,EAAE,EAAE;4BACnB,WAAW,IAAA,iMAAI,EAAC,0DAA0D,KAAK,EAAE,KAAK,eAAe;4BACrG,OAAO;gCAAE,aAAa,CAAC,KAAK,KAAK,GAAG,CAAC,IAAI;4BAAE;sCAC1C,KAAK,IAAI;2BAJL,KAAK,EAAE,GAAG,KAAK,KAAK;;;;;;;;;;;;;;;;;AAU/B","debugId":null}},
    {"offset": {"line": 2843, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/components/blog-sidebar.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useEffect, useState } from 'react'\r\nimport { motion, useScroll, useSpring, useTransform } from 'motion/react'\r\nimport { ANIMATION_DELAY, INIT_DELAY } from '@/consts'\r\nimport LikeButton from '@/components/like-button'\r\nimport { BlogToc } from '@/components/blog-toc'\r\nimport { ScrollTopButton } from '@/components/scroll-top-button'\r\n\r\ntype TocItem = {\r\n\tid: string\r\n\ttext: string\r\n\tlevel: number\r\n}\r\n\r\ntype BlogSidebarProps = {\r\n\tcover?: string\r\n\tsummary?: string\r\n\ttoc: TocItem[]\r\n\tslug?: string\r\n}\r\nconst offset = 72\r\n\r\nexport function BlogSidebar({ cover, summary, toc, slug }: BlogSidebarProps) {\r\n\tconst [maxOffset, setMaxOffset] = useState(0)\r\n\tconst { scrollY } = useScroll()\r\n\r\n\tuseEffect(() => {\r\n\t\tif (typeof window === 'undefined') {\r\n\t\t\treturn\r\n\t\t}\r\n\r\n\t\tconst updateMaxOffset = () => {\r\n\t\t\tconst maxScrollable = document.documentElement.scrollHeight - window.innerHeight\r\n\r\n\t\t\tconst nextMaxOffset = Math.max(0, maxScrollable - offset)\r\n\r\n\t\t\tsetMaxOffset(nextMaxOffset)\r\n\t\t}\r\n\r\n\t\tconst timer = setTimeout(() => {\r\n\t\t\tupdateMaxOffset()\r\n\t\t}, 5000)\r\n\r\n\t\tupdateMaxOffset()\r\n\t\twindow.addEventListener('resize', updateMaxOffset)\r\n\r\n\t\treturn () => {\r\n\t\t\twindow.removeEventListener('resize', updateMaxOffset)\r\n\t\t\tclearTimeout(timer)\r\n\t\t}\r\n\t}, [])\r\n\r\n\tconst adjustedScrollY = useTransform(scrollY, value => {\r\n\t\tconst adjusted = Math.max(0, value - offset)\r\n\t\treturn Math.min(adjusted, maxOffset)\r\n\t})\r\n\tconst sidebarY = useSpring(adjustedScrollY, {\r\n\t\tstiffness: 100,\r\n\t\tdamping: 15,\r\n\t\tmass: 0.6,\r\n\t\trestDelta: 0.5\r\n\t})\r\n\r\n\treturn (\r\n\t\t<motion.div className='relative flex w-[200px] shrink-0 flex-col items-start gap-4 self-start max-sm:hidden' style={{ y: sidebarY }}>\r\n\t\t\t{cover && (\r\n\t\t\t\t<motion.div\r\n\t\t\t\t\tinitial={{ opacity: 0, scale: 0.8 }}\r\n\t\t\t\t\tanimate={{ opacity: 1, scale: 1 }}\r\n\t\t\t\t\ttransition={{ delay: INIT_DELAY + ANIMATION_DELAY * 1 }}\r\n\t\t\t\t\tclassName='bg-card w-full rounded-xl p-3'>\r\n\t\t\t\t\t<img src={cover} alt='cover' className='h-auto w-full rounded-xl border object-cover' />\r\n\t\t\t\t</motion.div>\r\n\t\t\t)}\r\n\r\n\t\t\t{summary && (\r\n\t\t\t\t<motion.div\r\n\t\t\t\t\tinitial={{ opacity: 0, scale: 0.8 }}\r\n\t\t\t\t\tanimate={{ opacity: 1, scale: 1 }}\r\n\t\t\t\t\ttransition={{ delay: INIT_DELAY + ANIMATION_DELAY * 2 }}\r\n\t\t\t\t\tclassName='bg-card w-full rounded-xl border p-3 text-sm'>\r\n\t\t\t\t\t<h2 className='text-secondary mb-2 font-medium'>摘要</h2>\r\n\t\t\t\t\t<div className='text-secondary cursor-text'>{summary}</div>\r\n\t\t\t\t</motion.div>\r\n\t\t\t)}\r\n\r\n\t\t\t<BlogToc toc={toc} delay={INIT_DELAY + ANIMATION_DELAY * 3} />\r\n\r\n\t\t\t<LikeButton slug={slug} delay={(INIT_DELAY + ANIMATION_DELAY * 4) * 1000} />\r\n\r\n\t\t\t<ScrollTopButton delay={INIT_DELAY + ANIMATION_DELAY * 5} />\r\n\t\t</motion.div>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAPA;;;;;;;;AAqBA,MAAM,SAAS;AAER,SAAS,YAAY,EAAE,KAAK,EAAE,OAAO,EAAE,GAAG,EAAE,IAAI,EAAoB;IAC1E,MAAM,CAAC,WAAW,aAAa,GAAG,IAAA,gUAAQ,EAAC;IAC3C,MAAM,EAAE,OAAO,EAAE,GAAG,IAAA,4RAAS;IAE7B,IAAA,iUAAS,EAAC;QACT,wCAAmC;YAClC;QACD;;;QAEA,MAAM;QAQN,MAAM;IAWP,GAAG,EAAE;IAEL,MAAM,kBAAkB,IAAA,kSAAY,EAAC,SAAS,CAAA;QAC7C,MAAM,WAAW,KAAK,GAAG,CAAC,GAAG,QAAQ;QACrC,OAAO,KAAK,GAAG,CAAC,UAAU;IAC3B;IACA,MAAM,WAAW,IAAA,4RAAS,EAAC,iBAAiB;QAC3C,WAAW;QACX,SAAS;QACT,MAAM;QACN,WAAW;IACZ;IAEA,qBACC,6VAAC,0SAAM,CAAC,GAAG;QAAC,WAAU;QAAuF,OAAO;YAAE,GAAG;QAAS;;YAChI,uBACA,6VAAC,0SAAM,CAAC,GAAG;gBACV,SAAS;oBAAE,SAAS;oBAAG,OAAO;gBAAI;gBAClC,SAAS;oBAAE,SAAS;oBAAG,OAAO;gBAAE;gBAChC,YAAY;oBAAE,OAAO,2HAAU,GAAG,gIAAe,GAAG;gBAAE;gBACtD,WAAU;0BACV,cAAA,6VAAC;oBAAI,KAAK;oBAAO,KAAI;oBAAQ,WAAU;;;;;;;;;;;YAIxC,yBACA,6VAAC,0SAAM,CAAC,GAAG;gBACV,SAAS;oBAAE,SAAS;oBAAG,OAAO;gBAAI;gBAClC,SAAS;oBAAE,SAAS;oBAAG,OAAO;gBAAE;gBAChC,YAAY;oBAAE,OAAO,2HAAU,GAAG,gIAAe,GAAG;gBAAE;gBACtD,WAAU;;kCACV,6VAAC;wBAAG,WAAU;kCAAkC;;;;;;kCAChD,6VAAC;wBAAI,WAAU;kCAA8B;;;;;;;;;;;;0BAI/C,6VAAC,4IAAO;gBAAC,KAAK;gBAAK,OAAO,2HAAU,GAAG,gIAAe,GAAG;;;;;;0BAEzD,6VAAC,+IAAU;gBAAC,MAAM;gBAAM,OAAO,CAAC,2HAAU,GAAG,gIAAe,GAAG,CAAC,IAAI;;;;;;0BAEpE,6VAAC,gKAAe;gBAAC,OAAO,2HAAU,GAAG,gIAAe,GAAG;;;;;;;;;;;;AAG1D","debugId":null}},
    {"offset": {"line": 2993, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/components/blog-preview.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { motion } from 'motion/react'\r\nimport { INIT_DELAY } from '@/consts'\r\nimport { useMarkdownRender } from '@/hooks/use-markdown-render'\r\nimport { useSize } from '@/hooks/use-size'\r\nimport { BlogSidebar } from '@/components/blog-sidebar'\r\n\r\ntype BlogPreviewProps = {\r\n\tmarkdown: string\r\n\ttitle: string\r\n\ttags: string[]\r\n\tdate: string\r\n\tsummary?: string\r\n\tcover?: string\r\n\tslug?: string\r\n}\r\n\r\nexport function BlogPreview({ markdown, title, tags, date, summary, cover, slug }: BlogPreviewProps) {\r\n\tconst { maxSM: isMobile } = useSize()\r\n\tconst { content, toc, loading } = useMarkdownRender(markdown)\r\n\r\n\tif (loading) {\r\n\t\treturn <div className='text-secondary flex h-full items-center justify-center text-sm'>渲染中...</div>\r\n\t}\r\n\r\n\treturn (\r\n\t\t<div className='mx-auto flex max-w-[1140px] justify-center gap-6 px-6 pt-28 pb-12 max-sm:px-0'>\r\n\t\t\t<motion.article\r\n\t\t\t\tinitial={{ opacity: 0 }}\r\n\t\t\t\tanimate={{ opacity: 1 }}\r\n\t\t\t\ttransition={{ delay: INIT_DELAY }}\r\n\t\t\t\tclassName='card bg-article static flex-1 overflow-auto rounded-xl p-8'>\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<div className='text-center text-2xl font-semibold'>{title}</div>\r\n\r\n\t\t\t\t\t<div className='text-secondary mt-4 flex flex-wrap items-center justify-center gap-3 px-8 text-center text-sm'>\r\n\t\t\t\t\t\t{tags.map(t => (\r\n\t\t\t\t\t\t\t<span key={t}>#{t}</span>\r\n\t\t\t\t\t\t))}\r\n\t\t\t\t\t</div>\r\n\r\n\t\t\t\t\t<div className='text-secondary mt-3 text-center text-sm'>{date}</div>\r\n\t\t\t\t\t<div className='prose mt-6 max-w-none cursor-text'>{content}</div>\r\n\t\t\t\t</div>\r\n\t\t\t</motion.article>\r\n\r\n\t\t\t{!isMobile && <BlogSidebar cover={cover} summary={summary} toc={toc} slug={slug} />}\r\n\t\t</div>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;;;;;AANA;;;;;;;AAkBO,SAAS,YAAY,EAAE,QAAQ,EAAE,KAAK,EAAE,IAAI,EAAE,IAAI,EAAE,OAAO,EAAE,KAAK,EAAE,IAAI,EAAoB;IAClG,MAAM,EAAE,OAAO,QAAQ,EAAE,GAAG,IAAA,sIAAO;IACnC,MAAM,EAAE,OAAO,EAAE,GAAG,EAAE,OAAO,EAAE,GAAG,IAAA,+JAAiB,EAAC;IAEpD,IAAI,SAAS;QACZ,qBAAO,6VAAC;YAAI,WAAU;sBAAiE;;;;;;IACxF;IAEA,qBACC,6VAAC;QAAI,WAAU;;0BACd,6VAAC,0SAAM,CAAC,OAAO;gBACd,SAAS;oBAAE,SAAS;gBAAE;gBACtB,SAAS;oBAAE,SAAS;gBAAE;gBACtB,YAAY;oBAAE,OAAO,2HAAU;gBAAC;gBAChC,WAAU;0BACV,cAAA,6VAAC;;sCACA,6VAAC;4BAAI,WAAU;sCAAsC;;;;;;sCAErD,6VAAC;4BAAI,WAAU;sCACb,KAAK,GAAG,CAAC,CAAA,kBACT,6VAAC;;wCAAa;wCAAE;;mCAAL;;;;;;;;;;sCAIb,6VAAC;4BAAI,WAAU;sCAA2C;;;;;;sCAC1D,6VAAC;4BAAI,WAAU;sCAAqC;;;;;;;;;;;;;;;;;YAIrD,CAAC,0BAAY,6VAAC,oJAAW;gBAAC,OAAO;gBAAO,SAAS;gBAAS,KAAK;gBAAK,MAAM;;;;;;;;;;;;AAG9E","debugId":null}},
    {"offset": {"line": 3117, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/hooks/use-write-data.ts"],"sourcesContent":["import { useMemo } from 'react'\r\nimport dayjs from 'dayjs'\r\nimport { useWriteStore } from '../stores/write-store'\r\n\r\nexport function useWriteData() {\r\n\tconst { form, images } = useWriteStore()\r\n\r\n\t// Replace local-image placeholders with preview URLs\r\n\tconst processedMarkdown = useMemo(() => {\r\n\t\tlet mdForPreview = form.md\r\n\t\tfor (const img of images) {\r\n\t\t\tif (img.type === 'file') {\r\n\t\t\t\tconst placeholder = `local-image:${img.id}`\r\n\t\t\t\tmdForPreview = mdForPreview.split(`(${placeholder})`).join(`(${img.previewUrl})`)\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn mdForPreview\r\n\t}, [form.md, images])\r\n\r\n\tconst title = form.title || 'Untitled'\r\n\tconst date = dayjs(form.date).format('YYYY年 M月 D日')\r\n\r\n\treturn {\r\n\t\tmarkdown: processedMarkdown,\r\n\t\ttitle,\r\n\t\tdate\r\n\t}\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,SAAS;IACf,MAAM,EAAE,IAAI,EAAE,MAAM,EAAE,GAAG,IAAA,gKAAa;IAEtC,qDAAqD;IACrD,MAAM,oBAAoB,IAAA,+TAAO,EAAC;QACjC,IAAI,eAAe,KAAK,EAAE;QAC1B,KAAK,MAAM,OAAO,OAAQ;YACzB,IAAI,IAAI,IAAI,KAAK,QAAQ;gBACxB,MAAM,cAAc,CAAC,YAAY,EAAE,IAAI,EAAE,EAAE;gBAC3C,eAAe,aAAa,KAAK,CAAC,CAAC,CAAC,EAAE,YAAY,CAAC,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,EAAE,IAAI,UAAU,CAAC,CAAC,CAAC;YACjF;QACD;QACA,OAAO;IACR,GAAG;QAAC,KAAK,EAAE;QAAE;KAAO;IAEpB,MAAM,QAAQ,KAAK,KAAK,IAAI;IAC5B,MAAM,OAAO,IAAA,oMAAK,EAAC,KAAK,IAAI,EAAE,MAAM,CAAC;IAErC,OAAO;QACN,UAAU;QACV;QACA;IACD;AACD","debugId":null}},
    {"offset": {"line": 3157, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/components/preview.tsx"],"sourcesContent":["import { motion } from 'motion/react'\r\nimport { BlogPreview } from '@/components/blog-preview'\r\nimport { useWriteData } from '../hooks/use-write-data'\r\nimport type { PublishForm } from '../types'\r\n\r\ntype WritePreviewProps = {\r\n\tform: PublishForm\r\n\tcoverPreviewUrl: string | null\r\n\tonClose: () => void\r\n\tslug?: string\r\n}\r\n\r\nexport function WritePreview({ form, coverPreviewUrl, onClose, slug }: WritePreviewProps) {\r\n\tconst previewData = useWriteData()\r\n\treturn (\r\n\t\t<div>\r\n\t\t\t<div onClick={e => e.stopPropagation()}>\r\n\t\t\t\t<BlogPreview\r\n\t\t\t\t\tmarkdown={previewData.markdown}\r\n\t\t\t\t\ttitle={previewData.title}\r\n\t\t\t\t\ttags={form.tags}\r\n\t\t\t\t\tdate={previewData.date}\r\n\t\t\t\t\tsummary={form.summary}\r\n\t\t\t\t\tcover={coverPreviewUrl || undefined}\r\n\t\t\t\t\tslug={slug}\r\n\t\t\t\t/>\r\n\t\t\t</div>\r\n\t\t\t<motion.button\r\n\t\t\t\tinitial={{ opacity: 0, scale: 0.6 }}\r\n\t\t\t\tanimate={{ opacity: 1, scale: 1 }}\r\n\t\t\t\twhileHover={{ scale: 1.05 }}\r\n\t\t\t\twhileTap={{ scale: 0.95 }}\r\n\t\t\t\tclassName='absolute top-4 right-6 rounded-xl border bg-white/60 px-6 py-2 text-sm'\r\n\t\t\t\tonClick={onClose}>\r\n\t\t\t\t关闭预览\r\n\t\t\t</motion.button>\r\n\t\t</div>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAAA;AACA;AACA;;;;;;;;;AAUO,SAAS,aAAa,EAAE,IAAI,EAAE,eAAe,EAAE,OAAO,EAAE,IAAI,EAAqB;IACvF,MAAM,cAAc,IAAA,oKAAY;IAChC,qBACC,6VAAC;;0BACA,6VAAC;gBAAI,SAAS,CAAA,IAAK,EAAE,eAAe;0BACnC,cAAA,6VAAC,oJAAW;oBACX,UAAU,YAAY,QAAQ;oBAC9B,OAAO,YAAY,KAAK;oBACxB,MAAM,KAAK,IAAI;oBACf,MAAM,YAAY,IAAI;oBACtB,SAAS,KAAK,OAAO;oBACrB,OAAO,mBAAmB;oBAC1B,MAAM;;;;;;;;;;;0BAGR,6VAAC,0SAAM,CAAC,MAAM;gBACb,SAAS;oBAAE,SAAS;oBAAG,OAAO;gBAAI;gBAClC,SAAS;oBAAE,SAAS;oBAAG,OAAO;gBAAE;gBAChC,YAAY;oBAAE,OAAO;gBAAK;gBAC1B,UAAU;oBAAE,OAAO;gBAAK;gBACxB,WAAU;gBACV,SAAS;0BAAS;;;;;;;;;;;;AAKtB","debugId":null}},
    {"offset": {"line": 3234, "column": 0}, "map": {"version":3,"sources":["file:///E:/qbb/github/blog-public/src/app/write/page.tsx"],"sourcesContent":["'use client'\r\n\r\nimport { useWriteStore } from './stores/write-store'\r\nimport { usePreviewStore } from './stores/preview-store'\r\nimport { WriteEditor } from './components/editor'\r\nimport { WriteSidebar } from './components/sidebar'\r\nimport { WriteActions } from './components/actions'\r\nimport { WritePreview } from './components/preview'\r\nimport { useEffect } from 'react'\r\n\r\nexport default function WritePage() {\r\n\tconst { form, cover, reset } = useWriteStore()\r\n\tuseEffect(() => reset(), [])\r\n\tconst { isPreview, closePreview } = usePreviewStore()\r\n\r\n\tconst coverPreviewUrl = cover ? (cover.type === 'url' ? cover.url : cover.previewUrl) : null\r\n\r\n\treturn isPreview ? (\r\n\t\t<WritePreview form={form} coverPreviewUrl={coverPreviewUrl} onClose={closePreview} />\r\n\t) : (\r\n\t\t<>\r\n\t\t\t<div className='flex h-full justify-center gap-6 px-6 pt-24 pb-12'>\r\n\t\t\t\t<WriteEditor />\r\n\t\t\t\t<WriteSidebar />\r\n\t\t\t</div>\r\n\r\n\t\t\t<WriteActions />\r\n\t\t</>\r\n\t)\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;AARA;;;;;;;;;AAUe,SAAS;IACvB,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,KAAK,EAAE,GAAG,IAAA,gKAAa;IAC5C,IAAA,iUAAS,EAAC,IAAM,SAAS,EAAE;IAC3B,MAAM,EAAE,SAAS,EAAE,YAAY,EAAE,GAAG,IAAA,oKAAe;IAEnD,MAAM,kBAAkB,QAAS,MAAM,IAAI,KAAK,QAAQ,MAAM,GAAG,GAAG,MAAM,UAAU,GAAI;IAExF,OAAO,0BACN,6VAAC,6JAAY;QAAC,MAAM;QAAM,iBAAiB;QAAiB,SAAS;;;;;6BAErE;;0BACC,6VAAC;gBAAI,WAAU;;kCACd,6VAAC,2JAAW;;;;;kCACZ,6VAAC,6JAAY;;;;;;;;;;;0BAGd,6VAAC,6JAAY;;;;;;;AAGhB","debugId":null}}]
}