(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,16393,e=>{e.v([{id:"1764336067650-188e7e4bf33f88",uploadedAt:"2025-11-28T13:21:07.650Z",description:"我自己第一张图片，我自己的头像",images:["/images/pictures/b346636da687740b.webp"]},{id:"1764396655400-4c7115746f45f",uploadedAt:"2025-11-29T06:10:55.400Z",description:"IOS 26 时候，专门生成的壁纸",images:["/images/pictures/25e9f3a783d6002d.webp","/images/pictures/900c05fc5ffbd0cd.webp","/images/pictures/818e2f72bfcd58c4.webp","/images/pictures/e87a7e59c7a06eea.webp","/images/pictures/6c11232a0c6b6dad.webp"]}])},89909,e=>{"use strict";var t=e.i(58190),a=e.i(35311),s=e.i(7281),l=e.i(95403),r=e.i(16393),i=e.i(52434);function o(e){let a,l,r,o,n,c,d,m,h,u,x,g,b,f=(0,i.c)(34),{picture:p,onDelete:y,isEditMode:w}=e;if(f[0]!==w||f[1]!==y||f[2]!==p.id||f[3]!==p.image||f[4]!==p.images){u=Symbol.for("react.early_return_sentinel");e:{if(0===(l=p.images&&p.images.length>0?p.images:p.image?[p.image]:[]).length){u=null;break e}a=s.motion.div,f[15]===Symbol.for("react.memo_cache_sentinel")?(c={opacity:0,scale:.9},d={opacity:1,scale:1},f[15]=c,f[16]=d):(c=f[15],d=f[16]),m="card relative flex flex-col gap-3",f[17]!==w||f[18]!==y?(h=w&&(0,t.jsx)("button",{onClick:y,className:"absolute top-3 right-3 rounded-lg px-2 py-1.5 text-xs text-red-400 transition-colors hover:text-red-600",children:"删除"}),f[17]=w,f[18]=y,f[19]=h):h=f[19],r="relative flex h-56 items-center justify-center overflow-visible rounded-xl",o=1===l.length&&(0,t.jsx)("div",{className:"flex max-h-48 max-w-full items-center justify-center rounded-xl border-4 border-white bg-white shadow-xl",children:(0,t.jsx)("img",{src:l[0],alt:p.id,className:"max-h-48 max-w-full rounded-lg object-contain"})}),n=l.length>1&&l.slice(0,3).map((e,a)=>(0,t.jsx)("div",{className:`absolute flex max-h-48 max-w-full items-center justify-center overflow-hidden rounded-xl border-4 border-white bg-white shadow-xl transition-transform ${0===a?"-left-4 -translate-y-2 -rotate-6":1===a?"z-20 rotate-1":"right-0 translate-y-2 rotate-6"}`,children:(0,t.jsx)("img",{src:e,alt:`${p.id}-${a}`,className:"max-h-48 max-w-full rounded-lg object-contain"})},a))}f[0]=w,f[1]=y,f[2]=p.id,f[3]=p.image,f[4]=p.images,f[5]=a,f[6]=l,f[7]=r,f[8]=o,f[9]=n,f[10]=c,f[11]=d,f[12]=m,f[13]=h,f[14]=u}else a=f[5],l=f[6],r=f[7],o=f[8],n=f[9],c=f[10],d=f[11],m=f[12],h=f[13],u=f[14];return u!==Symbol.for("react.early_return_sentinel")?u:(f[20]!==l.length?(x=l.length>3&&(0,t.jsxs)("div",{className:"absolute right-4 -bottom-2 rounded-full bg-black/70 px-3 py-1 text-xs text-white shadow-lg",children:["共 ",l.length," 张"]}),f[20]=l.length,f[21]=x):x=f[21],f[22]!==r||f[23]!==o||f[24]!==n||f[25]!==x?(g=(0,t.jsxs)("div",{className:r,children:[o,n,x]}),f[22]=r,f[23]=o,f[24]=n,f[25]=x,f[26]=g):g=f[26],f[27]!==a||f[28]!==g||f[29]!==c||f[30]!==d||f[31]!==m||f[32]!==h?(b=(0,t.jsxs)(a,{initial:c,whileInView:d,className:m,children:[h,g]}),f[27]=a,f[28]=g,f[29]=c,f[30]=d,f[31]=m,f[32]=h,f[33]=b):b=f[33],b)}var n=e.i(52186),c=e.i(72412);function d(e){let s,r,o,d,u,x,g,b,f,p,y,w,N,j,v,C,O=(0,i.c)(33),{onClose:I,onSubmit:_}=e,[T,G]=(0,a.useState)("");O[0]===Symbol.for("react.memo_cache_sentinel")?(s=[],O[0]=s):s=O[0];let[S,R]=(0,a.useState)(s),U=(0,a.useRef)(null);O[1]===Symbol.for("react.memo_cache_sentinel")?(r=e=>{let t=Array.from(e.target.files||[]);if(0===t.length)return;let a=[];for(let e of t){if(!e.type.startsWith("image/"))return void l.toast.error("请选择图片文件");let t=URL.createObjectURL(e);a.push({type:"file",file:e,previewUrl:t})}R(a)},O[1]=r):r=O[1];let k=r;O[2]!==T||O[3]!==S||O[4]!==I||O[5]!==_?(o=()=>{0===S.length?l.toast.error("请至少选择一张图片"):(_({images:S,description:T}),R([]),G(""),I())},O[2]=T,O[3]=S,O[4]=I,O[5]=_,O[6]=o):o=O[6];let B=o;O[7]!==S||O[8]!==I?(d=()=>{S.forEach(h),R([]),G(""),I()},O[7]=S,O[8]=I,O[9]=d):d=O[9];let H=d;return O[10]===Symbol.for("react.memo_cache_sentinel")?(u=(0,t.jsx)("h2",{className:"text-xl font-bold",children:"上传图片"}),x=(0,t.jsx)("label",{className:"text-secondary mb-2 block text-sm font-medium",children:"选择图片（可多选）"}),g=(0,t.jsx)("input",{ref:U,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:k}),O[10]=u,O[11]=x,O[12]=g):(u=O[10],x=O[11],g=O[12]),O[13]!==S?(b=(0,t.jsxs)("div",{children:[x,g,0===S.length?(0,t.jsx)("div",{onClick:()=>U.current?.click(),className:"flex h-32 cursor-pointer items-center justify-center rounded-xl border border-dashed border-gray-300 bg-gray-50 transition-colors hover:bg-secondary/10",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(n.Plus,{className:"mx-auto mb-1 h-8 w-8 text-gray-500"}),(0,t.jsx)("p",{className:"text-secondary text-xs",children:"点击选择图片"})]})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"relative flex h-40 items-center justify-center overflow-visible rounded-xl bg-linear-to-br from-gray-50 to-gray-100",children:[S.slice(0,3).map(m),S.length>3&&(0,t.jsxs)("div",{className:"absolute right-4 -bottom-2 rounded-full bg-black/70 px-3 py-1 text-xs text-white shadow-lg",children:["共 ",S.length," 张"]})]}),(0,t.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,t.jsxs)("span",{className:"text-secondary text-xs",children:["已选择 ",S.length," 张图片"]}),(0,t.jsx)("button",{type:"button",onClick:()=>U.current?.click(),className:"rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-xs text-gray-700 transition-colors hover:bg-gray-50",children:"继续添加"})]})]})]}),O[13]=S,O[14]=b):b=O[14],O[15]===Symbol.for("react.memo_cache_sentinel")?(f=(0,t.jsx)("label",{className:"text-secondary mb-2 block text-sm font-medium",children:"描述（可选，应用于本次所有图片）"}),O[15]=f):f=O[15],O[16]===Symbol.for("react.memo_cache_sentinel")?(p=e=>G(e.target.value),O[16]=p):p=O[16],O[17]!==T?(y=(0,t.jsxs)("div",{children:[f,(0,t.jsx)("textarea",{value:T,onChange:p,placeholder:"这组图片的说明...",className:"w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 text-sm focus:outline-none",rows:3})]}),O[17]=T,O[18]=y):y=O[18],O[19]!==H?(w=(0,t.jsx)("button",{type:"button",onClick:H,className:"flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm transition-colors hover:bg-gray-50",children:"取消"}),O[19]=H,O[20]=w):w=O[20],O[21]!==B?(N=(0,t.jsx)("button",{type:"button",onClick:B,className:"brand-btn flex-1 justify-center px-4",children:"确认上传"}),O[21]=B,O[22]=N):N=O[22],O[23]!==w||O[24]!==N?(j=(0,t.jsxs)("div",{className:"mt-4 flex gap-3",children:[w,N]}),O[23]=w,O[24]=N,O[25]=j):j=O[25],O[26]!==y||O[27]!==j||O[28]!==b?(v=(0,t.jsxs)("div",{className:"space-y-4",children:[u,b,y,j]}),O[26]=y,O[27]=j,O[28]=b,O[29]=v):v=O[29],O[30]!==H||O[31]!==v?(C=(0,t.jsx)(c.DialogModal,{open:!0,onClose:H,className:"card w-md max-sm:w-full",children:v}),O[30]=H,O[31]=v,O[32]=C):C=O[32],C}function m(e,a){return"file"===e.type?(0,t.jsx)("div",{className:`absolute h-32 w-44 overflow-hidden rounded-xl border-4 border-white bg-white shadow-xl transition-transform ${0===a?"-left-4 -translate-y-2 -rotate-6":1===a?"z-20 rotate-1":"right-0 translate-y-2 rotate-6"}`,children:(0,t.jsx)("img",{src:e.previewUrl,alt:`preview-${a}`,className:"h-full w-full object-cover"})},a):null}function h(e){"file"===e.type&&URL.revokeObjectURL(e.previewUrl)}var u=e.i(37572),x=e.i(97005),g=e.i(86909),b=e.i(63580),f=e.i(75157);async function p(e){let{pictures:t,imageItems:a}=e,s=await (0,g.getAuthToken)();l.toast.info("正在获取分支信息...");let r=(await (0,u.getRef)(s,b.GITHUB_CONFIG.OWNER,b.GITHUB_CONFIG.REPO,`heads/${b.GITHUB_CONFIG.BRANCH}`)).sha,i=`更新图床列表`;l.toast.info("正在准备文件...");let o=[],n=new Set,c=[...t];if(a&&a.size>0){for(let[e,t]of(l.toast.info("正在上传图片..."),a.entries()))if("file"===t.type){let a=t.hash||await (0,x.hashFileSHA256)(t.file),l=(0,f.getFileExt)(t.file.name),r=`${a}${l}`,i=`/images/pictures/${r}`;if(!n.has(a)){let e=`public/images/pictures/${r}`,l=await (0,x.fileToBase64NoPrefix)(t.file),i=await (0,u.createBlob)(s,b.GITHUB_CONFIG.OWNER,b.GITHUB_CONFIG.REPO,l,"base64");o.push({path:e,mode:"100644",type:"blob",sha:i.sha}),n.add(a)}let[d,m]=e.split("::"),h=Number(m)||0;c=c.map(e=>{if(e.id!==d)return e;let t=(e.images&&e.images.length>0?e.images:e.image?[e.image]:[]).map((e,t)=>t===h?i:e);return{...e,image:void 0,images:t}})}}let d=JSON.stringify(c,null,"	"),m=await (0,u.createBlob)(s,b.GITHUB_CONFIG.OWNER,b.GITHUB_CONFIG.REPO,(0,u.toBase64Utf8)(d),"base64");o.push({path:"src/app/pictures/list.json",mode:"100644",type:"blob",sha:m.sha}),l.toast.info("正在创建文件树...");let h=await (0,u.createTree)(s,b.GITHUB_CONFIG.OWNER,b.GITHUB_CONFIG.REPO,o,r);l.toast.info("正在创建提交...");let p=await (0,u.createCommit)(s,b.GITHUB_CONFIG.OWNER,b.GITHUB_CONFIG.REPO,i,h.sha,[r]);l.toast.info("正在更新分支..."),await (0,u.updateRef)(s,b.GITHUB_CONFIG.OWNER,b.GITHUB_CONFIG.REPO,`heads/${b.GITHUB_CONFIG.BRANCH}`,p.sha),l.toast.success("发布成功！")}var y=e.i(71436),w=e.i(98788);function N(){let[e,i]=(0,a.useState)(r.default),[n,c]=(0,a.useState)(r.default),[m,h]=(0,a.useState)(!1),[u,x]=(0,a.useState)(!1),[g,b]=(0,a.useState)(!1),[f,N]=(0,a.useState)(new Map),j=(0,a.useRef)(null),v=(0,w.useRouter)(),{isAuth:C,setPrivateKey:O}=(0,y.useAuthStore)(),I=async e=>{try{let t=await e.text();O(t),await _()}catch(e){console.error("Failed to read private key:",e),l.toast.error("读取密钥文件失败")}},_=async()=>{x(!0);try{await p({pictures:e,imageItems:f}),c(e),N(new Map),h(!1),l.toast.success("保存成功！")}catch(e){console.error("Failed to save:",e),l.toast.error(`保存失败: ${e?.message||"未知错误"}`)}finally{x(!1)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("input",{ref:j,type:"file",accept:".pem",className:"hidden",onChange:async e=>{let t=e.target.files?.[0];t&&await I(t),e.currentTarget&&(e.currentTarget.value="")}}),(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center px-6 pt-32 pb-12",children:[(0,t.jsx)("div",{className:"grid w-full max-w-[1200px] grid-cols-3 gap-6 max-lg:grid-cols-2 max-sm:grid-cols-1",children:e.map(e=>(0,t.jsx)(o,{picture:e,isEditMode:m,onDelete:()=>{confirm("确定要删除这一组图片吗？")&&(i(t=>t.filter(t=>t.id!==e.id)),N(t=>{let a=new Map(t);for(let t of a.keys())t.startsWith(`${e.id}::`)&&a.delete(t);return a}))}},e.id))}),0===e.length&&(0,t.jsx)("div",{className:"mt-16 text-center text-sm text-gray-500",children:"还没有上传图片，点击右上角「编辑」后即可开始上传。"})]}),(0,t.jsx)(s.motion.div,{initial:{opacity:0,scale:.6},animate:{opacity:1,scale:1},className:"absolute top-4 right-6 flex gap-3 max-sm:hidden",children:m?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>v.push("/image-toolbox"),className:"rounded-xl border bg-blue-50 px-4 py-2 text-sm text-blue-700",children:"压缩工具"}),(0,t.jsx)(s.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{i(n),N(new Map),h(!1)},disabled:u,className:"rounded-xl border bg-white/60 px-6 py-2 text-sm",children:"取消"}),(0,t.jsx)(s.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>b(!0),className:"rounded-xl border bg-white/60 px-6 py-2 text-sm",children:"上传"}),(0,t.jsx)(s.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{C?_():j.current?.click()},disabled:u,className:"brand-btn px-6",children:u?"保存中...":C?"保存":"导入密钥"})]}):(0,t.jsx)(s.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>h(!0),className:"rounded-xl border bg-white/60 px-6 py-2 text-sm backdrop-blur-sm transition-colors hover:bg-white/80",children:"编辑"})}),g&&(0,t.jsx)(d,{onClose:()=>b(!1),onSubmit:({images:e,description:t})=>{let a=new Date().toISOString();if(0===e.length)return void l.toast.error("请至少选择一张图片");let s=`${Date.now()}-${Math.random().toString(16).slice(2)}`,r={id:s,uploadedAt:a,description:t.trim()||void 0,images:e.map(e=>"url"===e.type?e.url:e.previewUrl)},o=new Map(f);e.forEach((e,t)=>{"file"===e.type&&o.set(`${s}::${t}`,e)}),i(e=>[...e,r]),N(o),b(!1)}})]})}e.s(["default",()=>N],89909)}]);