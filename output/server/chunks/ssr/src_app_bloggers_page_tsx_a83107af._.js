module.exports=[34775,a=>{"use strict";var b=a.i(90053),c=a.i(17396),d=a.i(94693),e=a.i(56916),f=a.i(12465),g=a.i(57066),h=a.i(68114),i=a.i(76774),j=a.i(79220),k=a.i(73528);function l({currentAvatar:a,onClose:d,onSubmit:f}){let[g,h]=(0,c.useState)(a||""),[i,l]=(0,c.useState)(null),m=(0,c.useRef)(null),n=()=>{i&&URL.revokeObjectURL(i.previewUrl),l(null),h(a||""),d()};return(0,b.jsxs)(k.DialogModal,{open:!0,onClose:n,className:"card w-md",children:[(0,b.jsx)("h2",{className:"mb-4 text-xl font-bold",children:"选择头像"}),(0,b.jsxs)("form",{onSubmit:b=>{if(b.preventDefault(),i)f({type:"file",file:i.file,previewUrl:i.previewUrl});else{if(!g.trim())return void e.toast.error("请上传图片或输入 URL");f({type:"url",url:g.trim()})}l(null),h(a||""),d()},className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-secondary mb-2 block text-sm font-medium",children:"上传图片"}),(0,b.jsx)("input",{ref:m,type:"file",accept:"image/*",className:"hidden",onChange:a=>{let b=a.target.files?.[0];if(!b)return;if(!b.type.startsWith("image/"))return void e.toast.error("请选择图片文件");let c=URL.createObjectURL(b);l({file:b,previewUrl:c}),h("")}}),(0,b.jsx)("div",{onClick:()=>m.current?.click(),className:"mx-auto flex h-32 w-32 cursor-pointer items-center justify-center rounded-full border border-gray-300 bg-secondary/10 transition-colors hover:bg-gray-200",children:i?(0,b.jsx)("img",{src:i.previewUrl,alt:"preview",className:"h-full w-full rounded-lg object-cover"}):(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(j.Plus,{className:"text-secondary mx-auto mb-1 h-8 w-8"}),(0,b.jsx)("p",{className:"text-secondary text-xs",children:"点击上传图片"})]})})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,b.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,b.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,b.jsx)("span",{className:"text-secondary rounded-lg bg-white px-4 py-1",children:"或"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-secondary mb-2 block text-sm font-medium",children:"图片 URL"}),(0,b.jsx)("input",{type:"url",value:g,onChange:a=>{h(a.target.value),i&&(URL.revokeObjectURL(i.previewUrl),l(null))},placeholder:"https://example.com/avatar.png",className:"focus:ring-brand w-full rounded-lg border border-gray-300 bg-gray-200 px-4 py-2 focus:ring-2 focus:outline-none"})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,b.jsx)("button",{type:"submit",className:"brand-btn flex-1 justify-center rounded-lg px-6 py-2.5",children:"确认"}),(0,b.jsx)("button",{type:"button",onClick:n,className:"flex-1 rounded-lg border border-gray-300 bg-white px-6 py-2.5 transition-colors hover:bg-gray-50",children:"取消"})]})]})]})}function m({blogger:a,isEditMode:e=!1,onUpdate:j,onDelete:k}){let[m,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(!1),{maxSM:q}=(0,g.useSize)(),[r,s]=(0,c.useState)(a),[t,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(null),x=(b,c)=>{let d={...r,[b]:c};s(d),j?.(d,a,v||void 0)},y=e&&o;return(0,b.jsxs)(d.motion.div,{initial:{opacity:0,scale:.6},...q?{animate:{opacity:1,scale:1}}:{whileInView:{opacity:1,scale:1}},className:"card relative block overflow-hidden",children:[e&&(0,b.jsx)("div",{className:"absolute top-3 right-3 z-10 flex gap-2",children:o?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{onClick:()=>{s(a),p(!1),w(null)},className:"rounded-lg px-2 py-1.5 text-xs text-gray-400 transition-colors hover:text-gray-600",children:"取消"}),(0,b.jsx)("button",{onClick:()=>p(!1),className:"rounded-lg px-2 py-1.5 text-xs text-blue-400 transition-colors hover:text-blue-600",children:"完成"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{onClick:()=>p(!0),className:"rounded-lg px-2 py-1.5 text-xs text-blue-400 transition-colors hover:text-blue-600",children:"编辑"}),(0,b.jsx)("button",{onClick:k,className:"rounded-lg px-2 py-1.5 text-xs text-red-400 transition-colors hover:text-red-600",children:"删除"})]})}),(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"mb-4 flex items-center gap-4",children:[(0,b.jsxs)("div",{className:"group relative",children:[(0,b.jsx)("img",{src:r.avatar,alt:r.name,className:(0,h.cn)("h-16 w-16 rounded-full object-cover",y&&"cursor-pointer"),onClick:()=>y&&u(!0)}),y&&(0,b.jsx)("div",{className:"ev pointer-events-none absolute inset-0 flex items-center justify-center rounded-full bg-black/40 opacity-0 transition-opacity group-hover:opacity-100",children:(0,b.jsx)("span",{className:"text-xs text-white",children:"更换"})})]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{contentEditable:y,suppressContentEditableWarning:!0,onBlur:a=>x("name",a.currentTarget.textContent||""),className:(0,h.cn)("group-hover:text-brand text-lg font-bold transition-colors focus:outline-none",y&&"cursor-text"),children:r.name}),y?(0,b.jsx)("div",{contentEditable:!0,suppressContentEditableWarning:!0,onBlur:a=>x("url",a.currentTarget.textContent||""),className:"text-secondary mt-1 block max-w-[200px] cursor-text truncate text-xs focus:outline-none",children:r.url}):(0,b.jsx)("a",{href:r.url,target:"_blank",rel:"noopener noreferrer",className:"text-secondary hover:text-brand mt-1 block max-w-[200px] truncate text-xs hover:underline",children:r.url})]})]}),y?(0,b.jsx)(i.default,{stars:r.stars,editable:!0,onChange:a=>x("stars",a)}):(0,b.jsx)(f.default,{stars:r.stars}),(0,b.jsx)("p",{contentEditable:y,suppressContentEditableWarning:!0,onBlur:a=>x("description",a.currentTarget.textContent||""),onClick:a=>{y||(a.preventDefault(),n(!m))},className:(0,h.cn)("mt-3 text-sm leading-relaxed text-gray-600 transition-all duration-300 focus:outline-none",y?"cursor-text":"cursor-pointer",!y&&(m?"line-clamp-none":"line-clamp-3")),children:r.description})]}),y&&t&&(0,b.jsx)(l,{currentAvatar:r.avatar,onClose:()=>u(!1),onSubmit:b=>{w(b);let c="url"===b.type?b.url:b.previewUrl,d={...r,avatar:c};s(d),j?.(d,a,b)}})]})}function n({bloggers:a,isEditMode:d=!1,onUpdate:e,onDelete:f}){let[g,h]=(0,c.useState)(""),i=a.filter(a=>a.name.toLowerCase().includes(g.toLowerCase())||a.description.toLowerCase().includes(g.toLowerCase()));return(0,b.jsxs)("div",{className:"mx-auto w-full max-w-7xl px-6 pt-24 pb-12",children:[(0,b.jsx)("div",{className:"mb-8",children:(0,b.jsx)("input",{type:"text",placeholder:"搜索博主...",value:g,onChange:a=>h(a.target.value),className:"focus:ring-brand mx-auto block w-full max-w-md rounded-lg border border-gray-300 px-4 py-2 focus:ring-2 focus:outline-none"})}),(0,b.jsx)("div",{className:"grid grid-cols-1 gap-8 md:grid-cols-2 lg:grid-cols-3",children:i.map(a=>(0,b.jsx)(m,{blogger:a,isEditMode:d,onUpdate:e,onDelete:()=>f?.(a)},a.url))}),0===i.length&&(0,b.jsx)("div",{className:"mt-12 text-center text-gray-500",children:(0,b.jsx)("p",{children:"没有找到相关博主"})})]})}function o({blogger:a,onClose:d,onSave:f}){let[g,h]=(0,c.useState)({name:"",avatar:"",url:"",description:"",stars:3}),[i,m]=(0,c.useState)(!1);return(0,c.useEffect)(()=>{a?h(a):h({name:"",avatar:"",url:"",description:"",stars:3})},[a]),(0,b.jsxs)(k.DialogModal,{open:!0,onClose:d,className:"card w-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"mb-4 flex items-center gap-4",children:[(0,b.jsx)("div",{className:"group relative cursor-pointer",onClick:()=>m(!0),children:g.avatar?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("img",{src:g.avatar,alt:g.name,className:"h-16 w-16 rounded-full object-cover"}),(0,b.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center rounded-full bg-black/40 opacity-0 transition-opacity group-hover:opacity-100",children:(0,b.jsx)("span",{className:"text-xs text-white",children:"更换"})})]}):(0,b.jsx)("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-gray-200",children:(0,b.jsx)(j.Plus,{className:"h-6 w-6 text-gray-500"})})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("input",{type:"text",value:g.name,onChange:a=>h({...g,name:a.target.value}),placeholder:"博主名称",className:"w-full text-lg font-bold focus:outline-none"}),(0,b.jsx)("input",{type:"url",value:g.url,onChange:a=>h({...g,url:a.target.value}),placeholder:"https://example.com",className:"text-secondary mt-1 w-full truncate text-xs focus:outline-none"})]})]}),(0,b.jsx)("div",{className:"flex items-center gap-0.5",children:[1,2,3,4,5].map(a=>(0,b.jsx)("div",{onClick:()=>h({...g,stars:a}),className:"cursor-pointer",children:(0,b.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",className:a<=g.stars?"fill-yellow-400":"fill-gray-300",children:(0,b.jsx)("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"})})},a))}),(0,b.jsx)("textarea",{value:g.description,onChange:a=>h({...g,description:a.target.value}),placeholder:"博主介绍...",className:"mt-3 w-full resize-none text-sm leading-relaxed focus:outline-none",rows:4})]}),(0,b.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,b.jsx)("button",{onClick:d,className:"flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm transition-colors hover:bg-gray-50",children:"取消"}),(0,b.jsx)("button",{onClick:()=>{g.name.trim()&&g.avatar.trim()&&g.url.trim()&&g.description.trim()?(f(g),d(),e.toast.success(a?"更新成功":"添加成功")):e.toast.error("请填写所有必填项")},className:"brand-btn flex-1 justify-center px-4",children:a?"保存":"添加"})]}),i&&(0,b.jsx)(l,{currentAvatar:g.avatar,onClose:()=>m(!1),onSubmit:a=>{let b="url"===a.type?a.url:a.previewUrl;h({...g,avatar:b})}})]})}var p=a.i(7565),q=a.i(91434),r=a.i(63672),s=a.i(76139);async function t(a){let{bloggers:b,avatarItems:c}=a,d=await (0,r.getAuthToken)();e.toast.info("正在获取分支信息...");let f=(await (0,p.getRef)(d,s.GITHUB_CONFIG.OWNER,s.GITHUB_CONFIG.REPO,`heads/${s.GITHUB_CONFIG.BRANCH}`)).sha,g=`更新博主列表`;e.toast.info("正在准备文件...");let i=[],j=new Set,k=[...b];if(c&&c.size>0){for(let[a,b]of(e.toast.info("正在上传头像..."),c.entries()))if("file"===b.type){let c=b.hash||await (0,q.hashFileSHA256)(b.file),e=(0,h.getFileExt)(b.file.name),f=`${c}${e}`,g=`/images/blogger/${f}`;if(!j.has(c)){let a=`public/images/blogger/${f}`,e=await (0,q.fileToBase64NoPrefix)(b.file),g=await (0,p.createBlob)(d,s.GITHUB_CONFIG.OWNER,s.GITHUB_CONFIG.REPO,e,"base64");i.push({path:a,mode:"100644",type:"blob",sha:g.sha}),j.add(c)}k=k.map(b=>b.url===a?{...b,avatar:g}:b)}}let l=JSON.stringify(k,null,"	"),m=await (0,p.createBlob)(d,s.GITHUB_CONFIG.OWNER,s.GITHUB_CONFIG.REPO,(0,p.toBase64Utf8)(l),"base64");i.push({path:"src/app/bloggers/list.json",mode:"100644",type:"blob",sha:m.sha}),e.toast.info("正在创建文件树...");let n=await (0,p.createTree)(d,s.GITHUB_CONFIG.OWNER,s.GITHUB_CONFIG.REPO,i,f);e.toast.info("正在创建提交...");let o=await (0,p.createCommit)(d,s.GITHUB_CONFIG.OWNER,s.GITHUB_CONFIG.REPO,g,n.sha,[f]);e.toast.info("正在更新分支..."),await (0,p.updateRef)(d,s.GITHUB_CONFIG.OWNER,s.GITHUB_CONFIG.REPO,`heads/${s.GITHUB_CONFIG.BRANCH}`,o.sha),e.toast.success("发布成功！")}var u=a.i(47507),v=a.i(40038);function w(){let[a,f]=(0,c.useState)(v.default),[g,h]=(0,c.useState)(v.default),[i,j]=(0,c.useState)(!1),[k,l]=(0,c.useState)(!1),[m,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(!1),[s,w]=(0,c.useState)(new Map),x=(0,c.useRef)(null),{isAuth:y,setPrivateKey:z}=(0,u.useAuthStore)(),A=async a=>{try{let b=await a.text();z(b),await B()}catch(a){console.error("Failed to read private key:",a),e.toast.error("读取密钥文件失败")}},B=async()=>{l(!0);try{await t({bloggers:a,avatarItems:s}),h(a),w(new Map),j(!1),e.toast.success("保存成功！")}catch(a){console.error("Failed to save:",a),e.toast.error(`保存失败: ${a?.message||"未知错误"}`)}finally{l(!1)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("input",{ref:x,type:"file",accept:".pem",className:"hidden",onChange:async a=>{let b=a.target.files?.[0];b&&await A(b),a.currentTarget&&(a.currentTarget.value="")}}),(0,b.jsx)(n,{bloggers:a,isEditMode:i,onUpdate:(a,b,c)=>{f(c=>c.map(c=>c.url===b.url?a:c)),c&&w(b=>{let d=new Map(b);return d.set(a.url,c),d})},onDelete:b=>{confirm(`确定要删除 ${b.name} 吗？`)&&f(a.filter(a=>a.url!==b.url))}}),(0,b.jsx)(d.motion.div,{initial:{opacity:0,scale:.6},animate:{opacity:1,scale:1},className:"absolute top-4 right-6 flex gap-3 max-sm:hidden",children:i?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{f(g),w(new Map),j(!1)},disabled:k,className:"rounded-xl border bg-white/60 px-6 py-2 text-sm",children:"取消"}),(0,b.jsx)(d.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{p(null),r(!0)},className:"rounded-xl border bg-white/60 px-6 py-2 text-sm",children:"添加"}),(0,b.jsx)(d.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{y?B():x.current?.click()},disabled:k,className:"brand-btn px-6",children:k?"保存中...":y?"保存":"导入密钥"})]}):(0,b.jsx)(d.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>j(!0),className:"rounded-xl border bg-white/60 px-6 py-2 text-sm backdrop-blur-sm transition-colors hover:bg-white/80",children:"编辑"})}),q&&(0,b.jsx)(o,{blogger:m,onClose:()=>r(!1),onSave:b=>{m?f(a.map(a=>a.url===m.url?b:a)):f([...a,b])}})]})}a.s(["default",()=>w],34775)}];

//# sourceMappingURL=src_app_bloggers_page_tsx_a83107af._.js.map