module.exports=[55723,a=>{"use strict";var b=a.i(90053),c=a.i(17396),d=a.i(30884),e=a.i(24429),f=a.i(49037),g=a.i(73635),h=a.i(47423),i=c,j=a.i(39224);function k(a,b){if("function"==typeof a)return a(b);null!=a&&(a.current=b)}class l extends i.Component{getSnapshotBeforeUpdate(a){let b=this.props.childRef.current;if(b&&a.isPresent&&!this.props.isPresent){let a=b.offsetParent,c=(0,h.isHTMLElement)(a)&&a.offsetWidth||0,d=this.props.sizeRef.current;d.height=b.offsetHeight||0,d.width=b.offsetWidth||0,d.top=b.offsetTop,d.left=b.offsetLeft,d.right=c-d.width-d.left}return null}componentDidUpdate(){}render(){return this.props.children}}function m({children:a,isPresent:d,anchorX:e,root:f}){let g=(0,i.useId)(),h=(0,i.useRef)(null),m=(0,i.useRef)({width:0,height:0,top:0,left:0,right:0}),{nonce:n}=(0,i.useContext)(j.MotionConfigContext),o=function(...a){return c.useCallback(function(...a){return b=>{let c=!1,d=a.map(a=>{let d=k(a,b);return c||"function"!=typeof d||(c=!0),d});if(c)return()=>{for(let b=0;b<d.length;b++){let c=d[b];"function"==typeof c?c():k(a[b],null)}}}}(...a),a)}(h,a?.ref);return(0,i.useInsertionEffect)(()=>{let{width:a,height:b,top:c,left:i,right:j}=m.current;if(d||!h.current||!a||!b)return;let k="left"===e?`left: ${i}`:`right: ${j}`;h.current.dataset.motionPopId=g;let l=document.createElement("style");n&&(l.nonce=n);let o=f??document.head;return o.appendChild(l),l.sheet&&l.sheet.insertRule(`
          [data-motion-pop-id="${g}"] {
            position: absolute !important;
            width: ${a}px !important;
            height: ${b}px !important;
            ${k}px !important;
            top: ${c}px !important;
          }
        `),()=>{o.contains(l)&&o.removeChild(l)}},[d]),(0,b.jsx)(l,{isPresent:d,childRef:h,sizeRef:m,children:i.cloneElement(a,{ref:o})})}let n=({children:a,initial:d,isPresent:f,onExitComplete:h,custom:i,presenceAffectsLayout:j,mode:k,anchorX:l,root:n})=>{let p=(0,e.useConstant)(o),q=(0,c.useId)(),r=!0,s=(0,c.useMemo)(()=>(r=!1,{id:q,initial:d,isPresent:f,custom:i,onExitComplete:a=>{for(let b of(p.set(a,!0),p.values()))if(!b)return;h&&h()},register:a=>(p.set(a,!1),()=>p.delete(a))}),[f,p,h]);return j&&r&&(s={...s}),(0,c.useMemo)(()=>{p.forEach((a,b)=>p.set(b,!1))},[f]),c.useEffect(()=>{f||p.size||!h||h()},[f]),"popLayout"===k&&(a=(0,b.jsx)(m,{isPresent:f,anchorX:l,root:n,children:a})),(0,b.jsx)(g.PresenceContext.Provider,{value:s,children:a})};function o(){return new Map}var p=a.i(77972);let q=a=>a.key||"";function r(a){let b=[];return c.Children.forEach(a,a=>{(0,c.isValidElement)(a)&&b.push(a)}),b}let s=({children:a,custom:g,initial:h=!0,onExitComplete:i,presenceAffectsLayout:j=!0,mode:k="sync",propagate:l=!1,anchorX:m="left",root:o})=>{let[s,t]=(0,p.usePresence)(l),u=(0,c.useMemo)(()=>r(a),[a]),v=l&&!s?[]:u.map(q),w=(0,c.useRef)(!0),x=(0,c.useRef)(u),y=(0,e.useConstant)(()=>new Map),[z,A]=(0,c.useState)(u),[B,C]=(0,c.useState)(u);(0,f.useIsomorphicLayoutEffect)(()=>{w.current=!1,x.current=u;for(let a=0;a<B.length;a++){let b=q(B[a]);v.includes(b)?y.delete(b):!0!==y.get(b)&&y.set(b,!1)}},[B,v.length,v.join("-")]);let D=[];if(u!==z){let a=[...u];for(let b=0;b<B.length;b++){let c=B[b],d=q(c);v.includes(d)||(a.splice(b,0,c),D.push(c))}return"wait"===k&&D.length&&(a=D),C(r(a)),A(u),null}let{forceRender:E}=(0,c.useContext)(d.LayoutGroupContext);return(0,b.jsx)(b.Fragment,{children:B.map(a=>{let c=q(a),d=(!l||!!s)&&(u===B||v.includes(c));return(0,b.jsx)(n,{isPresent:d,initial:(!w.current||!!h)&&void 0,custom:g,presenceAffectsLayout:j,mode:k,root:o,onExitComplete:d?void 0:()=>{if(!y.has(c))return;y.set(c,!0);let a=!0;y.forEach(b=>{b||(a=!1)}),a&&(E?.(),C(x.current),l&&t?.(),i&&i())},anchorX:m,children:a},c)})})};a.s(["AnimatePresence",()=>s],55723)},73528,a=>{"use strict";var b=a.i(90053),c=a.i(17396),d=a.i(24656),e=a.i(55723),f=a.i(94693),g=a.i(68114);function h({open:a,onClose:h,children:i,className:j,disableCloseOnOverlay:k=!1,lockScroll:l=!0,closeOnEsc:m=!0}){let[n,o]=(0,c.useState)(!1);return((0,c.useEffect)(()=>{o(!0)},[]),(0,c.useEffect)(()=>{if(!l||!a)return;let b=document.body.style.overflow;return document.body.style.overflow="hidden",()=>{document.body.style.overflow=b}},[l,a]),(0,c.useEffect)(()=>{if(!m||!a)return;let b=a=>{"Escape"===a.key&&h()};return window.addEventListener("keydown",b),()=>{window.removeEventListener("keydown",b)}},[m,h,a]),n)?(0,d.createPortal)((0,b.jsx)(e.AnimatePresence,{children:a&&(0,b.jsx)(f.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-card p-4 backdrop-blur-xl",onClick:k?void 0:h,children:(0,b.jsx)(f.motion.div,{initial:{opacity:0,scale:.8,y:20},animate:{opacity:1,scale:1,y:0},exit:{opacity:0,scale:.8,y:20},className:(0,g.cn)("static",j),onClick:a=>a.stopPropagation(),children:i})})}),document.body):null}a.s(["DialogModal",()=>h])},91434,a=>{"use strict";function b(a){return new Promise((b,c)=>{let d=new FileReader;d.onload=()=>b(String(d.result||"")),d.onerror=c,d.readAsText(a)})}function c(a){return new Promise((b,c)=>{let d=new FileReader;d.onload=()=>{b(String(d.result||"").replace(/^data:[^;]+;base64,/,""))},d.onerror=c,d.readAsDataURL(a)})}async function d(a){let b=await a.arrayBuffer(),c=new Uint8Array(await crypto.subtle.digest("SHA-256",b)),d="";for(let a=0;a<c.length;a++)d+=c[a].toString(16).padStart(2,"0");return d.slice(0,16)}a.s(["fileToBase64NoPrefix",()=>c,"hashFileSHA256",()=>d,"readFileAsText",()=>b])},79220,a=>{"use strict";let b=(0,a.i(63535).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],79220)},16393,a=>{a.v([{id:"1764336067650-188e7e4bf33f88",uploadedAt:"2025-11-28T13:21:07.650Z",description:"我自己第一张图片，我自己的头像",images:["/images/pictures/b346636da687740b.webp"]},{id:"1764396655400-4c7115746f45f",uploadedAt:"2025-11-29T06:10:55.400Z",description:"IOS 26 时候，专门生成的壁纸",images:["/images/pictures/25e9f3a783d6002d.webp","/images/pictures/900c05fc5ffbd0cd.webp","/images/pictures/818e2f72bfcd58c4.webp","/images/pictures/e87a7e59c7a06eea.webp","/images/pictures/6c11232a0c6b6dad.webp"]}])},16158,a=>{"use strict";var b=a.i(90053),c=a.i(17396),d=a.i(94693),e=a.i(56916),f=a.i(16393);function g({picture:a,onDelete:c,isEditMode:e}){let f=a.images&&a.images.length>0?a.images:a.image?[a.image]:[];return 0===f.length?null:(0,b.jsxs)(d.motion.div,{initial:{opacity:0,scale:.9},whileInView:{opacity:1,scale:1},className:"card relative flex flex-col gap-3",children:[e&&(0,b.jsx)("button",{onClick:c,className:"absolute top-3 right-3 rounded-lg px-2 py-1.5 text-xs text-red-400 transition-colors hover:text-red-600",children:"删除"}),(0,b.jsxs)("div",{className:"relative flex h-56 items-center justify-center overflow-visible rounded-xl",children:[1===f.length&&(0,b.jsx)("div",{className:"flex max-h-48 max-w-full items-center justify-center rounded-xl border-4 border-white bg-white shadow-xl",children:(0,b.jsx)("img",{src:f[0],alt:a.id,className:"max-h-48 max-w-full rounded-lg object-contain"})}),f.length>1&&f.slice(0,3).map((c,d)=>(0,b.jsx)("div",{className:`absolute flex max-h-48 max-w-full items-center justify-center overflow-hidden rounded-xl border-4 border-white bg-white shadow-xl transition-transform ${0===d?"-left-4 -translate-y-2 -rotate-6":1===d?"z-20 rotate-1":"right-0 translate-y-2 rotate-6"}`,children:(0,b.jsx)("img",{src:c,alt:`${a.id}-${d}`,className:"max-h-48 max-w-full rounded-lg object-contain"})},d)),f.length>3&&(0,b.jsxs)("div",{className:"absolute right-4 -bottom-2 rounded-full bg-black/70 px-3 py-1 text-xs text-white shadow-lg",children:["共 ",f.length," 张"]})]})]})}var h=a.i(79220),i=a.i(73528);function j({onClose:a,onSubmit:d}){let[f,g]=(0,c.useState)(""),[j,k]=(0,c.useState)([]),l=(0,c.useRef)(null),m=()=>{j.forEach(a=>{"file"===a.type&&URL.revokeObjectURL(a.previewUrl)}),k([]),g(""),a()};return(0,b.jsx)(i.DialogModal,{open:!0,onClose:m,className:"card w-md max-sm:w-full",children:(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsx)("h2",{className:"text-xl font-bold",children:"上传图片"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-secondary mb-2 block text-sm font-medium",children:"选择图片（可多选）"}),(0,b.jsx)("input",{ref:l,type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:a=>{let b=Array.from(a.target.files||[]);if(0===b.length)return;let c=[];for(let a of b){if(!a.type.startsWith("image/"))return void e.toast.error("请选择图片文件");let b=URL.createObjectURL(a);c.push({type:"file",file:a,previewUrl:b})}k(c)}}),0===j.length?(0,b.jsx)("div",{onClick:()=>l.current?.click(),className:"flex h-32 cursor-pointer items-center justify-center rounded-xl border border-dashed border-gray-300 bg-gray-50 transition-colors hover:bg-secondary/10",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(h.Plus,{className:"mx-auto mb-1 h-8 w-8 text-gray-500"}),(0,b.jsx)("p",{className:"text-secondary text-xs",children:"点击选择图片"})]})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"relative flex h-40 items-center justify-center overflow-visible rounded-xl bg-linear-to-br from-gray-50 to-gray-100",children:[j.slice(0,3).map((a,c)=>"file"===a.type?(0,b.jsx)("div",{className:`absolute h-32 w-44 overflow-hidden rounded-xl border-4 border-white bg-white shadow-xl transition-transform ${0===c?"-left-4 -translate-y-2 -rotate-6":1===c?"z-20 rotate-1":"right-0 translate-y-2 rotate-6"}`,children:(0,b.jsx)("img",{src:a.previewUrl,alt:`preview-${c}`,className:"h-full w-full object-cover"})},c):null),j.length>3&&(0,b.jsxs)("div",{className:"absolute right-4 -bottom-2 rounded-full bg-black/70 px-3 py-1 text-xs text-white shadow-lg",children:["共 ",j.length," 张"]})]}),(0,b.jsxs)("div",{className:"mt-3 flex items-center justify-between",children:[(0,b.jsxs)("span",{className:"text-secondary text-xs",children:["已选择 ",j.length," 张图片"]}),(0,b.jsx)("button",{type:"button",onClick:()=>l.current?.click(),className:"rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-xs text-gray-700 transition-colors hover:bg-gray-50",children:"继续添加"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-secondary mb-2 block text-sm font-medium",children:"描述（可选，应用于本次所有图片）"}),(0,b.jsx)("textarea",{value:f,onChange:a=>g(a.target.value),placeholder:"这组图片的说明...",className:"w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 text-sm focus:outline-none",rows:3})]}),(0,b.jsxs)("div",{className:"mt-4 flex gap-3",children:[(0,b.jsx)("button",{type:"button",onClick:m,className:"flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm transition-colors hover:bg-gray-50",children:"取消"}),(0,b.jsx)("button",{type:"button",onClick:()=>{0===j.length?e.toast.error("请至少选择一张图片"):(d({images:j,description:f}),k([]),g(""),a())},className:"brand-btn flex-1 justify-center px-4",children:"确认上传"})]})]})})}var k=a.i(7565),l=a.i(91434),m=a.i(63672),n=a.i(76139),o=a.i(68114);async function p(a){let{pictures:b,imageItems:c}=a,d=await (0,m.getAuthToken)();e.toast.info("正在获取分支信息...");let f=(await (0,k.getRef)(d,n.GITHUB_CONFIG.OWNER,n.GITHUB_CONFIG.REPO,`heads/${n.GITHUB_CONFIG.BRANCH}`)).sha,g=`更新图床列表`;e.toast.info("正在准备文件...");let h=[],i=new Set,j=[...b];if(c&&c.size>0){for(let[a,b]of(e.toast.info("正在上传图片..."),c.entries()))if("file"===b.type){let c=b.hash||await (0,l.hashFileSHA256)(b.file),e=(0,o.getFileExt)(b.file.name),f=`${c}${e}`,g=`/images/pictures/${f}`;if(!i.has(c)){let a=`public/images/pictures/${f}`,e=await (0,l.fileToBase64NoPrefix)(b.file),g=await (0,k.createBlob)(d,n.GITHUB_CONFIG.OWNER,n.GITHUB_CONFIG.REPO,e,"base64");h.push({path:a,mode:"100644",type:"blob",sha:g.sha}),i.add(c)}let[m,p]=a.split("::"),q=Number(p)||0;j=j.map(a=>{if(a.id!==m)return a;let b=(a.images&&a.images.length>0?a.images:a.image?[a.image]:[]).map((a,b)=>b===q?g:a);return{...a,image:void 0,images:b}})}}let p=JSON.stringify(j,null,"	"),q=await (0,k.createBlob)(d,n.GITHUB_CONFIG.OWNER,n.GITHUB_CONFIG.REPO,(0,k.toBase64Utf8)(p),"base64");h.push({path:"src/app/pictures/list.json",mode:"100644",type:"blob",sha:q.sha}),e.toast.info("正在创建文件树...");let r=await (0,k.createTree)(d,n.GITHUB_CONFIG.OWNER,n.GITHUB_CONFIG.REPO,h,f);e.toast.info("正在创建提交...");let s=await (0,k.createCommit)(d,n.GITHUB_CONFIG.OWNER,n.GITHUB_CONFIG.REPO,g,r.sha,[f]);e.toast.info("正在更新分支..."),await (0,k.updateRef)(d,n.GITHUB_CONFIG.OWNER,n.GITHUB_CONFIG.REPO,`heads/${n.GITHUB_CONFIG.BRANCH}`,s.sha),e.toast.success("发布成功！")}var q=a.i(47507),r=a.i(45763);function s(){let[a,h]=(0,c.useState)(f.default),[i,k]=(0,c.useState)(f.default),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)(!1),[s,t]=(0,c.useState)(!1),[u,v]=(0,c.useState)(new Map),w=(0,c.useRef)(null),x=(0,r.useRouter)(),{isAuth:y,setPrivateKey:z}=(0,q.useAuthStore)(),A=async a=>{try{let b=await a.text();z(b),await B()}catch(a){console.error("Failed to read private key:",a),e.toast.error("读取密钥文件失败")}},B=async()=>{o(!0);try{await p({pictures:a,imageItems:u}),k(a),v(new Map),m(!1),e.toast.success("保存成功！")}catch(a){console.error("Failed to save:",a),e.toast.error(`保存失败: ${a?.message||"未知错误"}`)}finally{o(!1)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("input",{ref:w,type:"file",accept:".pem",className:"hidden",onChange:async a=>{let b=a.target.files?.[0];b&&await A(b),a.currentTarget&&(a.currentTarget.value="")}}),(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center px-6 pt-32 pb-12",children:[(0,b.jsx)("div",{className:"grid w-full max-w-[1200px] grid-cols-3 gap-6 max-lg:grid-cols-2 max-sm:grid-cols-1",children:a.map(a=>(0,b.jsx)(g,{picture:a,isEditMode:l,onDelete:()=>{confirm("确定要删除这一组图片吗？")&&(h(b=>b.filter(b=>b.id!==a.id)),v(b=>{let c=new Map(b);for(let b of c.keys())b.startsWith(`${a.id}::`)&&c.delete(b);return c}))}},a.id))}),0===a.length&&(0,b.jsx)("div",{className:"mt-16 text-center text-sm text-gray-500",children:"还没有上传图片，点击右上角「编辑」后即可开始上传。"})]}),(0,b.jsx)(d.motion.div,{initial:{opacity:0,scale:.6},animate:{opacity:1,scale:1},className:"absolute top-4 right-6 flex gap-3 max-sm:hidden",children:l?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>x.push("/image-toolbox"),className:"rounded-xl border bg-blue-50 px-4 py-2 text-sm text-blue-700",children:"压缩工具"}),(0,b.jsx)(d.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{h(i),v(new Map),m(!1)},disabled:n,className:"rounded-xl border bg-white/60 px-6 py-2 text-sm",children:"取消"}),(0,b.jsx)(d.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>t(!0),className:"rounded-xl border bg-white/60 px-6 py-2 text-sm",children:"上传"}),(0,b.jsx)(d.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{y?B():w.current?.click()},disabled:n,className:"brand-btn px-6",children:n?"保存中...":y?"保存":"导入密钥"})]}):(0,b.jsx)(d.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>m(!0),className:"rounded-xl border bg-white/60 px-6 py-2 text-sm backdrop-blur-sm transition-colors hover:bg-white/80",children:"编辑"})}),s&&(0,b.jsx)(j,{onClose:()=>t(!1),onSubmit:({images:a,description:b})=>{let c=new Date().toISOString();if(0===a.length)return void e.toast.error("请至少选择一张图片");let d=`${Date.now()}-${Math.random().toString(16).slice(2)}`,f={id:d,uploadedAt:c,description:b.trim()||void 0,images:a.map(a=>"url"===a.type?a.url:a.previewUrl)},g=new Map(u);a.forEach((a,b)=>{"file"===a.type&&g.set(`${d}::${b}`,a)}),h(a=>[...a,f]),v(g),t(!1)}})]})}a.s(["default",()=>s],16158)}];

//# sourceMappingURL=_6fd9f6b4._.js.map