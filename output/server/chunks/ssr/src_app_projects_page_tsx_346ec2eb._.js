module.exports=[53524,a=>{"use strict";var b=a.i(90053),c=a.i(17396),d=a.i(94693),e=a.i(56916),f=a.i(29896),g=a.i(68114),h=a.i(57066),i=a.i(79220),j=a.i(73528);function k({currentImage:a,onClose:d,onSubmit:f}){let[g,h]=(0,c.useState)(a||""),[k,l]=(0,c.useState)(null),m=(0,c.useRef)(null),n=()=>{k&&URL.revokeObjectURL(k.previewUrl),l(null),h(a||""),d()};return(0,b.jsxs)(j.DialogModal,{open:!0,onClose:n,className:"card w-md",children:[(0,b.jsx)("h2",{className:"mb-4 text-xl font-bold",children:"选择图片"}),(0,b.jsxs)("form",{onSubmit:b=>{if(b.preventDefault(),k)f({type:"file",file:k.file,previewUrl:k.previewUrl});else{if(!g.trim())return void e.toast.error("请上传图片或输入 URL");f({type:"url",url:g.trim()})}l(null),h(a||""),d()},className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-secondary mb-2 block text-sm font-medium",children:"上传图片"}),(0,b.jsx)("input",{ref:m,type:"file",accept:"image/*",className:"hidden",onChange:a=>{let b=a.target.files?.[0];if(!b)return;if(!b.type.startsWith("image/"))return void e.toast.error("请选择图片文件");let c=URL.createObjectURL(b);l({file:b,previewUrl:c}),h("")}}),(0,b.jsx)("div",{onClick:()=>m.current?.click(),className:"mx-auto flex h-32 w-32 cursor-pointer items-center justify-center rounded-xl border border-gray-300 bg-secondary/10 transition-colors hover:bg-gray-200",children:k?(0,b.jsx)("img",{src:k.previewUrl,alt:"preview",className:"h-full w-full rounded-xl object-cover"}):(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)(i.Plus,{className:"text-secondary mx-auto mb-1 h-8 w-8"}),(0,b.jsx)("p",{className:"text-secondary text-xs",children:"点击上传图片"})]})})]}),(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,b.jsx)("div",{className:"w-full border-t border-gray-300"})}),(0,b.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,b.jsx)("span",{className:"text-secondary rounded-lg bg-white px-4 py-1",children:"或"})})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-secondary mb-2 block text-sm font-medium",children:"图片 URL"}),(0,b.jsx)("input",{type:"url",value:g,onChange:a=>{h(a.target.value),k&&(URL.revokeObjectURL(k.previewUrl),l(null))},placeholder:"https://example.com/image.png",className:"focus:ring-brand w-full rounded-lg border border-gray-300 bg-gray-200 px-4 py-2 focus:ring-2 focus:outline-none"})]}),(0,b.jsxs)("div",{className:"flex gap-3 pt-2",children:[(0,b.jsx)("button",{type:"submit",className:"brand-btn flex-1 justify-center rounded-lg px-6 py-2.5",children:"确认"}),(0,b.jsx)("button",{type:"button",onClick:n,className:"flex-1 rounded-lg border border-gray-300 bg-white px-6 py-2.5 transition-colors hover:bg-gray-50",children:"取消"})]})]})]})}function l({project:a,isEditMode:e=!1,onUpdate:i,onDelete:j}){let[l,m]=(0,c.useState)(!1),{maxSM:n}=(0,h.useSize)(),[o,p]=(0,c.useState)(a),[q,r]=(0,c.useState)(!1),[s,t]=(0,c.useState)(null),u=(b,c)=>{let d={...o,[b]:c};p(d),i?.(d,a,s||void 0)},v=e&&l;return(0,b.jsxs)(d.motion.div,{initial:{opacity:0,scale:.9},...n?{animate:{opacity:1,scale:1}}:{whileInView:{opacity:1,scale:1}},className:"card relative flex flex-col gap-4",children:[e&&(0,b.jsx)("div",{className:"absolute top-3 right-3 z-10 flex gap-2",children:l?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{onClick:()=>{p(a),m(!1),t(null)},className:"rounded-lg px-2 py-1.5 text-xs text-gray-400 transition-colors hover:text-gray-600",children:"取消"}),(0,b.jsx)("button",{onClick:()=>m(!1),className:"rounded-lg px-2 py-1.5 text-xs text-blue-400 transition-colors hover:text-blue-600",children:"完成"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("button",{onClick:()=>m(!0),className:"rounded-lg px-2 py-1.5 text-xs text-blue-400 transition-colors hover:text-blue-600",children:"编辑"}),(0,b.jsx)("button",{onClick:j,className:"rounded-lg px-2 py-1.5 text-xs text-red-400 transition-colors hover:text-red-600",children:"删除"})]})}),(0,b.jsxs)("div",{className:"flex items-start gap-4",children:[(0,b.jsxs)("div",{className:"group relative",children:[(0,b.jsx)("img",{src:o.image,alt:o.name,className:(0,g.cn)("h-16 w-16 shrink-0 rounded-xl object-cover",v&&"cursor-pointer"),onClick:()=>v&&r(!0)}),v&&(0,b.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center rounded-xl bg-black/40 opacity-0 transition-opacity group-hover:opacity-100",children:(0,b.jsx)("span",{className:"text-xs text-white",children:"更换"})})]}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("h3",{contentEditable:v,suppressContentEditableWarning:!0,onBlur:a=>u("name",a.currentTarget.textContent||""),className:(0,g.cn)("text-lg font-semibold",v&&"cursor-text focus:outline-none"),children:o.name}),v?(0,b.jsx)("input",{type:"number",value:o.year,onChange:a=>u("year",parseInt(a.target.value)||0),className:"text-secondary w-18 rounded border border-gray-300 px-2 py-1 text-sm focus:outline-none"}):(0,b.jsx)("span",{className:"text-secondary text-sm",children:o.year})]}),(0,b.jsx)("div",{className:"mt-2 flex flex-wrap gap-2",children:v?(0,b.jsx)("input",{type:"text",value:o.tags.join(", "),onChange:a=>{u("tags",a.target.value.split(",").map(a=>a.trim()).filter(a=>a))},placeholder:"标签，用逗号分隔",className:"w-full rounded-lg border border-gray-300 bg-gray-50 px-2 py-1 text-xs focus:outline-none"}):o.tags.map(a=>(0,b.jsx)("span",{className:"text-secondary rounded-lg bg-white/50 px-2 py-1 text-xs",children:a},a))})]})]}),(0,b.jsx)("p",{contentEditable:v,suppressContentEditableWarning:!0,onBlur:a=>u("description",a.currentTarget.textContent||""),className:(0,g.cn)("text-secondary text-sm leading-relaxed",v&&"cursor-text focus:outline-none"),children:o.description}),(0,b.jsx)("div",{className:"flex flex-wrap gap-2",children:v?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("input",{type:"url",value:o.url,onChange:a=>u("url",a.target.value),placeholder:"网站 URL",className:"flex-1 rounded-lg border border-gray-300 bg-gray-50 px-3 py-1.5 text-sm focus:outline-none"}),(0,b.jsx)("input",{type:"url",value:o.github||"",onChange:a=>u("github",a.target.value||void 0),placeholder:"GitHub URL（可选）",className:"flex-1 rounded-lg border border-gray-300 bg-gray-50 px-3 py-1.5 text-sm focus:outline-none"}),(0,b.jsx)("input",{type:"url",value:o.npm||"",onChange:a=>u("npm",a.target.value||void 0),placeholder:"NPM URL（可选）",className:"flex-1 rounded-lg border border-gray-300 bg-gray-50 px-3 py-1.5 text-sm focus:outline-none"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(f.default,{href:o.url,target:"_blank",rel:"noopener noreferrer",className:"rounded-lg border bg-white/50 px-3 py-1.5 text-sm font-medium transition-colors hover:bg-white/80",children:"Website"}),o.github&&(0,b.jsx)(f.default,{href:o.github,target:"_blank",rel:"noopener noreferrer",className:"rounded-lg border bg-white/50 px-3 py-1.5 text-sm font-medium transition-colors hover:bg-white/80",children:"GitHub"}),o.npm&&(0,b.jsx)(f.default,{href:o.npm,target:"_blank",rel:"noopener noreferrer",className:"rounded-lg border bg-white/50 px-3 py-1.5 text-sm font-medium transition-colors hover:bg-white/80",children:"NPM"})]})}),v&&q&&(0,b.jsx)(k,{currentImage:o.image,onClose:()=>r(!1),onSubmit:b=>{t(b);let c="url"===b.type?b.url:b.previewUrl,d={...o,image:c};p(d),i?.(d,a,b)}})]})}function m({project:a,onClose:d,onSave:f}){let[g,h]=(0,c.useState)({name:"",year:new Date().getFullYear(),image:"",url:"",description:"",tags:[],github:void 0,npm:void 0}),[l,m]=(0,c.useState)(!1),[n,o]=(0,c.useState)("");return(0,c.useEffect)(()=>{a?(h(a),o(a.tags.join(", "))):(h({name:"",year:new Date().getFullYear(),image:"",url:"",description:"",tags:[],github:void 0,npm:void 0}),o(""))},[a]),(0,b.jsxs)(j.DialogModal,{open:!0,onClose:d,className:"card static w-md max-sm:w-full",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("div",{className:"mb-4 flex items-center gap-4",children:[(0,b.jsx)("div",{className:"group relative cursor-pointer",onClick:()=>m(!0),children:g.image?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("img",{src:g.image,alt:g.name,className:"h-16 w-16 rounded-xl object-cover"}),(0,b.jsx)("div",{className:"pointer-events-none absolute inset-0 flex items-center justify-center rounded-xl bg-black/40 opacity-0 transition-opacity group-hover:opacity-100",children:(0,b.jsx)("span",{className:"text-xs text-white",children:"更换"})})]}):(0,b.jsx)("div",{className:"flex h-16 w-16 items-center justify-center rounded-xl bg-gray-200",children:(0,b.jsx)(i.Plus,{className:"h-6 w-6 text-gray-500"})})}),(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("input",{type:"text",value:g.name,onChange:a=>h({...g,name:a.target.value}),placeholder:"项目名称",className:"w-full text-lg font-bold focus:outline-none"}),(0,b.jsxs)("div",{className:"mt-1 flex items-center gap-2",children:[(0,b.jsx)("input",{type:"number",value:g.year,onChange:a=>h({...g,year:parseInt(a.target.value)||0}),placeholder:"年份",className:"text-secondary w-20 rounded border border-gray-300 px-2 py-1 text-xs focus:outline-none"}),(0,b.jsx)("input",{type:"url",value:g.url,onChange:a=>h({...g,url:a.target.value}),placeholder:"https://example.com",className:"text-secondary flex-1 truncate text-xs focus:outline-none"})]})]})]}),(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("input",{type:"text",value:n,onChange:a=>{var b;let c;return o(b=a.target.value),c=b.split(",").map(a=>a.trim()).filter(a=>a),void h({...g,tags:c})},placeholder:"标签，用逗号分隔（如：React, Vue）",className:"w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 text-sm focus:outline-none"}),(0,b.jsx)("div",{className:"mt-2 flex flex-wrap gap-1.5",children:g.tags.map(a=>(0,b.jsx)("span",{className:"rounded-full bg-secondary/10 px-2.5 py-0.5 text-xs text-gray-600",children:a},a))})]}),(0,b.jsx)("textarea",{value:g.description,onChange:a=>h({...g,description:a.target.value}),placeholder:"项目介绍...",className:"mt-3 w-full resize-none text-sm leading-relaxed focus:outline-none",rows:4}),(0,b.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,b.jsx)("input",{type:"url",value:g.github||"",onChange:a=>h({...g,github:a.target.value||void 0}),placeholder:"GitHub URL（可选）",className:"w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 text-sm focus:outline-none"}),(0,b.jsx)("input",{type:"url",value:g.npm||"",onChange:a=>h({...g,npm:a.target.value||void 0}),placeholder:"NPM URL（可选）",className:"w-full rounded-md border border-gray-300 bg-gray-50 px-3 py-2 text-sm focus:outline-none"})]})]}),(0,b.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,b.jsx)("button",{onClick:d,className:"flex-1 rounded-lg border border-gray-300 bg-white px-4 py-2 text-sm transition-colors hover:bg-gray-50",children:"取消"}),(0,b.jsx)("button",{onClick:()=>{g.name.trim()&&g.image.trim()&&g.url.trim()&&g.description.trim()?0===g.tags.length?e.toast.error("请至少添加一个标签"):(f(g),d(),e.toast.success(a?"更新成功":"添加成功")):e.toast.error("请填写所有必填项")},className:"brand-btn flex-1 justify-center px-4",children:a?"保存":"添加"})]}),l&&(0,b.jsx)(k,{currentImage:g.image,onClose:()=>m(!1),onSubmit:a=>{let b="url"===a.type?a.url:a.previewUrl;h({...g,image:b})}})]})}var n=a.i(7565),o=a.i(91434),p=a.i(63672),q=a.i(76139);async function r(a){let{projects:b,imageItems:c}=a,d=await (0,p.getAuthToken)();e.toast.info("正在获取分支信息...");let f=(await (0,n.getRef)(d,q.GITHUB_CONFIG.OWNER,q.GITHUB_CONFIG.REPO,`heads/${q.GITHUB_CONFIG.BRANCH}`)).sha,h=`更新项目列表`;e.toast.info("正在准备文件...");let i=[],j=new Set,k=[...b];if(c&&c.size>0){for(let[a,b]of(e.toast.info("正在上传图片..."),c.entries()))if("file"===b.type){let c=b.hash||await (0,o.hashFileSHA256)(b.file),e=(0,g.getFileExt)(b.file.name),f=`${c}${e}`,h=`/images/project/${f}`;if(!j.has(c)){let a=`public/images/project/${f}`,e=await (0,o.fileToBase64NoPrefix)(b.file),g=await (0,n.createBlob)(d,q.GITHUB_CONFIG.OWNER,q.GITHUB_CONFIG.REPO,e,"base64");i.push({path:a,mode:"100644",type:"blob",sha:g.sha}),j.add(c)}k=k.map(b=>b.url===a?{...b,image:h}:b)}}let l=JSON.stringify(k,null,"	"),m=await (0,n.createBlob)(d,q.GITHUB_CONFIG.OWNER,q.GITHUB_CONFIG.REPO,(0,n.toBase64Utf8)(l),"base64");i.push({path:"src/app/projects/list.json",mode:"100644",type:"blob",sha:m.sha}),e.toast.info("正在创建文件树...");let r=await (0,n.createTree)(d,q.GITHUB_CONFIG.OWNER,q.GITHUB_CONFIG.REPO,i,f);e.toast.info("正在创建提交...");let s=await (0,n.createCommit)(d,q.GITHUB_CONFIG.OWNER,q.GITHUB_CONFIG.REPO,h,r.sha,[f]);e.toast.info("正在更新分支..."),await (0,n.updateRef)(d,q.GITHUB_CONFIG.OWNER,q.GITHUB_CONFIG.REPO,`heads/${q.GITHUB_CONFIG.BRANCH}`,s.sha),e.toast.success("发布成功！")}var s=a.i(47507),t=a.i(66752);function u(){let[a,f]=(0,c.useState)(t.default),[g,h]=(0,c.useState)(t.default),[i,j]=(0,c.useState)(!1),[k,n]=(0,c.useState)(!1),[o,p]=(0,c.useState)(null),[q,u]=(0,c.useState)(!1),[v,w]=(0,c.useState)(new Map),x=(0,c.useRef)(null),{isAuth:y,setPrivateKey:z}=(0,s.useAuthStore)(),A=(a,b,c)=>{f(c=>c.map(c=>c.url===b.url?a:c)),c&&w(b=>{let d=new Map(b);return d.set(a.url,c),d})},B=async a=>{try{let b=await a.text();z(b),await C()}catch(a){console.error("Failed to read private key:",a),e.toast.error("读取密钥文件失败")}},C=async()=>{n(!0);try{await r({projects:a,imageItems:v}),h(a),w(new Map),j(!1),e.toast.success("保存成功！")}catch(a){console.error("Failed to save:",a),e.toast.error(`保存失败: ${a?.message||"未知错误"}`)}finally{n(!1)}};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("input",{ref:x,type:"file",accept:".pem",className:"hidden",onChange:async a=>{let b=a.target.files?.[0];b&&await B(b),a.currentTarget&&(a.currentTarget.value="")}}),(0,b.jsx)("div",{className:"flex flex-col items-center justify-center px-6 pt-32 pb-12",children:(0,b.jsx)("div",{className:"grid w-full max-w-[1200px] grid-cols-2 gap-6 max-md:grid-cols-1",children:a.map((c,d)=>(0,b.jsx)(l,{project:c,isEditMode:i,onUpdate:A,onDelete:()=>{confirm(`确定要删除 ${c.name} 吗？`)&&f(a.filter(a=>a.url!==c.url))}},c.url))})}),(0,b.jsx)(d.motion.div,{initial:{opacity:0,scale:.6},animate:{opacity:1,scale:1},className:"absolute top-4 right-6 flex gap-3 max-sm:hidden",children:i?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(d.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{f(g),w(new Map),j(!1)},disabled:k,className:"rounded-xl border bg-white/60 px-6 py-2 text-sm",children:"取消"}),(0,b.jsx)(d.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{p(null),u(!0)},className:"rounded-xl border bg-white/60 px-6 py-2 text-sm",children:"添加"}),(0,b.jsx)(d.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{y?C():x.current?.click()},disabled:k,className:"brand-btn px-6",children:k?"保存中...":y?"保存":"导入密钥"})]}):(0,b.jsx)(d.motion.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>j(!0),className:"rounded-xl border bg-white/60 px-6 py-2 text-sm backdrop-blur-sm transition-colors hover:bg-white/80",children:"编辑"})}),q&&(0,b.jsx)(m,{project:o,onClose:()=>u(!1),onSave:b=>{o?f(a.map(a=>a.url===o.url?b:a)):f([...a,b])}})]})}a.s(["default",()=>u],53524)}];

//# sourceMappingURL=src_app_projects_page_tsx_346ec2eb._.js.map